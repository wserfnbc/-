/**
* ã€Žâœ¡æ¢¦å¢ƒç¼”é€ å¸ˆï¼šð™ð‡ð„ðð’ð‡ð€ðð†ð˜ðˆð - æž•ä¸Šç˜¾ - Noâ€‘Pillow.jsã€
* ã€Žâœ¡æ„¿ä½ çš„ä»£ç å¦‚æž•èˆ¬ä¸æ»‘ã€æ—  bug ç›¸ä¼´ - May your code be as smooth as a pillow and bug-freeã€
* ã€Žâœ¡ç”¨æŠ€æœ¯ç¼–ç»‡æ¢¦æƒ³ã€ä»¥ä»£ç ä¼ é€’æ¸©æŸ” - Weave dreams with technology and convey tenderness with codeã€
*/
class ZhenshangyinSmoothScroll { constructor(t) { this.options = { damping: .1, scrollMultiplier: 2, preventScrollOn: null, ...t }, this._viewerSelectors = [".zhenshangyin-image-viewer"].join(", "), this.currentScroll = this.getScrollPosition(), this.targetScroll = this.getScrollPosition(), this.isScrolling = !1, this.animationFrame = null, this.handleWheel = this.handleWheel.bind(this), this.animateScroll = this.animateScroll.bind(this), this.enable() } getScrollPosition() { return window.pageYOffset } setScrollPosition(t) { window.scrollTo(0, t) } getMaxScroll() { return document.documentElement.scrollHeight - window.innerHeight } _findScrollableAncestor(t, e) { let s = t; for (; s && s !== document.documentElement && s !== document.body;) { if (s instanceof HTMLElement) { const t = window.getComputedStyle(s).overflowY, i = s.scrollHeight > s.clientHeight; if (("auto" === t || "scroll" === t || "overlay" === t) && i) { const t = s.scrollTop <= 0, i = s.scrollTop + s.clientHeight >= s.scrollHeight - 1; if (e < 0 && !t || e > 0 && !i) return s } } s = s.parentNode } return null } handleWheel(t) { if (!(t.ctrlKey || t.shiftKey || t.metaKey || t.altKey)) if (this.options.preventScrollOn && t.target.closest(this.options.preventScrollOn)) t.preventDefault(); else if (this._viewerSelectors && t.target.closest(this._viewerSelectors)) t.preventDefault(); else if (!this._findScrollableAncestor(t.target, t.deltaY)) { if (t.preventDefault(), !this.isScrolling) { const t = this.getScrollPosition(); this.currentScroll = t, this.targetScroll = t } this.targetScroll += t.deltaY * this.options.scrollMultiplier, this.targetScroll = Math.max(0, Math.min(this.targetScroll, this.getMaxScroll())), this.isScrolling || this.startAnimation() } } lerp(t, e, s) { return (1 - s) * t + s * e } startAnimation() { this.isScrolling || (this.isScrolling = !0, this.animationFrame = requestAnimationFrame(this.animateScroll)) } animateScroll() { this.isScrolling && (this.currentScroll = this.lerp(this.currentScroll, this.targetScroll, this.options.damping), Math.abs(this.currentScroll - this.targetScroll) < .5 && (this.currentScroll = this.targetScroll, this.isScrolling = !1), this.setScrollPosition(this.currentScroll), this.isScrolling && (this.animationFrame = requestAnimationFrame(this.animateScroll))) } enable() { window.addEventListener("wheel", this.handleWheel, { passive: !1 }) } disable() { window.removeEventListener("wheel", this.handleWheel), this.animationFrame && (cancelAnimationFrame(this.animationFrame), this.animationFrame = null), this.isScrolling = !1 } destroy() { this.disable() } } class ZhenshangyinScrollAnimate { constructor(t = {}) { this.config = { threshold: t.threshold || 100, duration: t.duration || 800, delay: t.delay || 0, repeat: t.repeat || !1, easing: t.easing || "cubic-bezier(0.25, 0.1, 0.25, 1)", mobile: t.mobile || !1, distance: t.distance || 15, startOpacity: void 0 !== t.startOpacity ? t.startOpacity : 0, endOpacity: void 0 !== t.endOpacity ? t.endOpacity : 1, startScale: t.startScale || .5, endScale: t.endScale || 1, startScaleOut: t.startScaleOut || 1.5, use3D: void 0 === t.use3D || t.use3D }, this.elements = [], this.animatedElements = new WeakSet, this.elementInitialPositions = new WeakMap, this.elementOriginalTransforms = new WeakMap, this.groupParents = new WeakMap, this.groupElements = new WeakMap, this.elementOriginalStyles = new WeakMap, this.elementRows = new WeakMap, this.pendingGroupAnimations = new WeakMap, this.scrollHandler = this.debounce(this.handleScroll.bind(this), 10), "loading" === document.readyState ? document.addEventListener("DOMContentLoaded", () => this.init()) : this.init() } init() { if (!this.config.mobile && this.isMobile()) return void document.querySelectorAll("[data-zhenshangyin]").forEach(t => { t.style.visibility = "visible" }); this.elements = Array.from(document.querySelectorAll("[data-zhenshangyin]")); this.elements.filter(t => t.hasAttribute("data-group")).forEach(t => { const e = t.getAttribute("data-group"), s = Array.from(t.querySelectorAll(e)); if (s.length) { this.groupParents.set(t, !0), this.storeOriginalStyles(t), s.forEach(t => { this.storeOriginalStyles(t) }), this.storeInitialPosition(t), s.forEach(t => { this.storeInitialPosition(t) }); let e = [...s]; t.hasAttribute("data-random") && (e = this.shuffleArray([...s])), this.groupElements.set(t, e), this.pendingGroupAnimations.set(t, new Set(e)), this.setupGroupElements(t, e), s.forEach(t => { const e = this.elements.indexOf(t); e > -1 && this.elements.splice(e, 1) }) } }), this.elements.forEach(t => { this.groupParents.has(t) || (this.storeOriginalStyles(t), this.storeInitialPosition(t), this.setInitialStyles(t)) }), this.scrollHandler = this.handleScroll.bind(this), window.addEventListener("scroll", this.scrollHandler, { passive: !0 }), window.addEventListener("resize", this.scrollHandler, { passive: !0 }), requestAnimationFrame(() => { requestAnimationFrame(() => { this.handleInitialAnimation() }) }) } handleInitialAnimation() { this.elements.forEach(t => { if (!this.groupParents.has(t) && this.isElementInView(t)) { const e = t.getAttribute("data-zhenshangyin"), s = parseInt(t.getAttribute("data-delay") || this.config.delay), i = parseInt(t.getAttribute("data-duration") || this.config.duration); setTimeout(() => { this.animateElement(t, e, i) }, s) } }), this.elements.forEach(t => { if (this.groupParents.has(t) && this.isElementInView(t)) { const e = this.groupElements.get(t); if (!e || !e.length) return; const s = t.getAttribute("data-zhenshangyin"), i = parseFloat(t.getAttribute("data-next-trigger") || .2), n = parseInt(t.getAttribute("data-delay") || this.config.delay); if (t.hasAttribute("data-random")) { const a = e.filter(t => this.isElementInView(t)); if (0 === a.length) return; this.shuffleArray(a).forEach((e, a) => { const o = n + a * i * 1e3, r = parseInt(e.getAttribute("data-duration") || this.config.duration); setTimeout(() => { this.animateElement(e, s, r), this.updatePendingElements(t, e) }, o) }) } else { const e = this.elementRows.get(t) || []; let a = n; e.forEach(e => { e.some(t => this.isElementInView(t)) && (e.forEach((e, n) => { const o = a + n * i * 1e3, r = parseInt(e.getAttribute("data-duration") || this.config.duration); setTimeout(() => { this.animateElement(e, s, r), this.updatePendingElements(t, e) }, o) }), a += e.length * i * 1e3 + 100) }) } } }) } handleScroll() { this.config.repeat && (this.elements.forEach(t => { !this.groupParents.has(t) && this.animatedElements.has(t) && this.isElementCompletelyOutOfView(t) && this.resetElement(t) }), this.elements.forEach(t => { if (this.groupParents.has(t)) { const e = this.groupElements.get(t); if (!e || !e.length) return; e.forEach(e => { if (this.animatedElements.has(e) && this.isElementCompletelyOutOfView(e)) { const s = t.getAttribute("data-zhenshangyin"); this.resetElement(e, s); const i = this.pendingGroupAnimations.get(t); i ? i.add(e) : this.pendingGroupAnimations.set(t, new Set([e])) } }); const s = this.pendingGroupAnimations.get(t); s && s.size === e.length && this.animatedElements.delete(t) } })), this.elements.forEach(t => { if (!this.groupParents.has(t) && this.isElementInView(t) && !this.animatedElements.has(t)) { const e = parseInt(t.getAttribute("data-delay") || this.config.delay); setTimeout(() => { const e = t.getAttribute("data-zhenshangyin"); this.animateElement(t, e, this.config.duration) }, e) } }), this.elements.forEach(t => { if (this.groupParents.has(t)) { const e = this.groupElements.get(t); if (!e || !e.length) return; this.isElementInView(t) && (this.animatedElements.has(t) || this.animateGroupByRows(t, e)) } }) } isMobile() { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) } storeOriginalStyles(t) { this.elementOriginalStyles.set(t, t.getAttribute("style") || ""); const e = window.getComputedStyle(t).transform; this.elementOriginalTransforms.set(t, "none" === e ? "" : e) } storeInitialPosition(t) { const e = t.getBoundingClientRect(), s = window.pageYOffset || document.documentElement.scrollTop; this.elementInitialPositions.set(t, { top: e.top + s, bottom: e.bottom + s, left: e.left, right: e.right, height: e.height }) } setInitialStyles(t) { const e = t.getAttribute("data-zhenshangyin"), s = t.getAttribute("data-duration") || this.config.duration, i = t.getAttribute("data-delay") || this.config.delay; t.style.visibility = "visible", t.style.transition = "none", t.style.opacity = "0", this.config.use3D && (t.style.transform = this.getCombinedTransform(t, this.getInitialTransform(e)), t.style.willChange = "transform, opacity", t.style.backfaceVisibility = "hidden"), t.offsetHeight, t.style.transition = `all ${s}ms ${this.config.easing} ${i}ms` } setupGroupElements(t, e) { const s = t.getAttribute("data-zhenshangyin"), i = new Map; e.forEach(t => { const e = t.getBoundingClientRect(), s = Math.round(e.top); i.has(s) || i.set(s, []), i.get(s).push(t) }); const n = Array.from(i.entries()).sort(([t], [e]) => t - e).map(([t, s]) => s.sort((t, s) => e.indexOf(t) - e.indexOf(s))); this.elementRows.set(t, n), e.forEach(e => { e.style.transition = "none", e.style.opacity = "0", e.style.visibility = "visible", this.config.use3D && (e.style.transform = this.getCombinedTransform(e, this.getInitialTransform(s)), e.style.willChange = "transform, opacity", e.style.backfaceVisibility = "hidden"), e.offsetHeight; const i = t.getAttribute("data-duration") || this.config.duration, n = e.getAttribute("data-duration") || i; e.style.transition = `all ${n}ms ${this.config.easing}` }) } getCombinedTransform(t, e) { const s = this.elementOriginalTransforms.get(t) || ""; return s ? `${s} ${e}` : e } getInitialTransform(t) { const { distance: e, startScale: s, startScaleOut: i } = this.config; switch (t) { case "slideUp": return `translate3d(0, ${e}px, 0)`; case "slideDown": return `translate3d(0, -${e}px, 0)`; case "slideLeft": return `translate3d(${e}px, 0, 0)`; case "slideRight": return `translate3d(-${e}px, 0, 0)`; case "zoomIn": return `scale3d(${s}, ${s}, ${s})`; case "zoomOut": return `scale3d(${i}, ${i}, ${i})`; case "flipInX": return "rotateX(90deg)"; case "flipInY": return "rotateY(90deg)"; default: return "translate3d(0, 0, 0)" } } getFinalTransform(t) { const { endScale: e } = this.config; switch (t) { case "zoomIn": case "zoomOut": return `scale3d(${e}, ${e}, ${e})`; default: return "" } } isElementInView(t) { const e = t.getBoundingClientRect(), s = window.innerHeight, i = this.config.threshold; return e.top <= s - i && e.bottom >= i } isElementCompletelyOutOfView(t) { const e = this.elementInitialPositions.get(t); if (!e) return !0; const s = window.pageYOffset || document.documentElement.scrollTop, i = window.innerHeight || document.documentElement.clientHeight; return e.bottom < s || e.top > s + i } animateElement(t, e, s) { requestAnimationFrame(() => { t.style.opacity = this.config.endOpacity; const i = this.getFinalTransform(e); t.style.transform = i ? this.getCombinedTransform(t, i) : this.elementOriginalTransforms.get(t) || "", this.animatedElements.add(t), setTimeout(() => { this.cleanupAnimationProperties(t) }, s) }) } updatePendingElements(t, e) { const s = this.pendingGroupAnimations.get(t); s && (s.delete(e), 0 === s.size && this.animatedElements.add(t)) } animateGroupByRows(t, e) { if (!e || !e.length) return; this.pendingGroupAnimations.has(t) || (this.pendingGroupAnimations.set(t, new Set(e)), this.setupGroupElements(t, e)); const s = t.getAttribute("data-zhenshangyin"), i = parseFloat(t.getAttribute("data-next-trigger") || .2), n = parseInt(t.getAttribute("data-delay") || this.config.delay); (this.elementRows.get(t) || []).forEach(e => { const a = e.filter(t => this.isElementInView(t)); if (a.length > 0) { const o = e.findIndex(t => a.includes(t)); if (-1 === o) return;[...e.slice(o), ...e.slice(0, o)].forEach((e, a) => { const o = this.pendingGroupAnimations.get(t); if (o && o.has(e)) { const o = e.getAttribute("data-delay"), r = null !== o ? parseInt(o) : n + a * i * 1e3, h = e.getAttribute("data-duration") || this.config.duration; setTimeout(() => { this.animateElement(e, s, h), this.updatePendingElements(t, e) }, r) } }) } }) } resetElement(t, e) { const s = e || t.getAttribute("data-zhenshangyin"); t.style.transition = "none", t.style.opacity = this.config.startOpacity, t.style.transform = this.getCombinedTransform(t, this.getInitialTransform(s)), t.offsetHeight; const i = t.getAttribute("data-duration") || this.config.duration, n = t.getAttribute("data-delay") || this.config.delay; t.style.transition = `all ${i}ms ${this.config.easing} ${n}ms`, this.animatedElements.delete(t) } shuffleArray(t) { const e = [...t]; for (let t = e.length - 1; t > 0; t--) { const s = Math.floor(Math.random() * (t + 1));[e[t], e[s]] = [e[s], e[t]] } return e } cleanupAnimationProperties(t) { if (this.animatedElements.has(t)) { const e = this.elementOriginalStyles.get(t); e ? t.setAttribute("style", e) : t.removeAttribute("style"), t.style.visibility = "visible" } } debounce(t, e) { let s; return function (...i) { clearTimeout(s), s = setTimeout(() => { clearTimeout(s), t.apply(this, i) }, e) } } } class ZhenshangyinSwiper { static linkedGroups = new Map; static addToLinkedGroup(t, e) { e && (this.linkedGroups.has(e) || this.linkedGroups.set(e, []), this.linkedGroups.get(e).push(t)) } static removeFromLinkedGroup(t, e) { if (!e || !this.linkedGroups.has(e)) return; const s = this.linkedGroups.get(e), i = s.indexOf(t); i > -1 && s.splice(i, 1), 0 === s.length && this.linkedGroups.delete(e) } static notifyLinkedGroupChange(t, e, s) { if (!s || !this.linkedGroups.has(s)) return; this.linkedGroups.get(s).forEach(s => { s !== e && !0 !== s.isTransitioning && s.slideTo(t, !1) }) } constructor(t, e = {}) { if (!("string" == typeof t ? document.querySelector(t) : t)) return this.initialized = !1, this.slides = [], this.wrapper = null, this.container = null, this.options = { transforms: { enabled: !1 } }, this; const s = { scale: { enabled: !1, step: .1 }, translate: { enabled: !1, x: 0, y: 0, z: 0 }, rotate: { enabled: !1, x: 0, y: 0, z: 0 }, skew: { enabled: !1, x: 0, y: 0 }, perspective: { enabled: !1, value: 1500 }, backfaceVisibility: { enabled: !1, value: "hidden" }, opacity: { enabled: !1, step: .1 }, filter: { enabled: !1, blur: 0, brightness: 0, contrast: 0, grayscale: 0, hueRotate: 0, invert: 0, saturate: 0, sepia: 0 }, uniformSpacing: { enabled: !1, gap: 20, customSpacing: null } }; e.breakpoints && Object.keys(e.breakpoints).forEach(t => { e.breakpoints[t].transforms && (e.breakpoints[t].transforms = { ...s, ...e.breakpoints[t].transforms }) }), e.transforms = Object.assign(s, e.transforms || {}), this.originalTransforms = { ...e.transforms }, e.on = e.on || {}; const i = e.on.touchStart, n = e.on.touchMove, a = e.on.touchEnd; e.on.touchStart = (t, e, s) => { t.options.transforms && t.isTransformsEnabled() && (t._transformTouchData = { initialTransforms: t.slides.map(t => t.style.transform), touchStartIndex: t.currentIndex }), i && i.call(this, t, e, s) }, e.on.touchMove = (t, e, s) => { t.options.transforms && t.isTransformsEnabled() && t.isMoved && !t.isAnimating && t.updateTransformsDuringTouch(s), n && n.call(this, t, e, s) }, e.on.touchEnd = (t, e, s) => { t.options.transforms && t.isTransformsEnabled() && setTimeout(() => { t.updateTransforms() }, 10), a && a.call(this, t, e, s) }; const o = "string" == typeof t ? document.querySelectorAll(t) : [t]; if (1 !== o.length) { const t = Array.from(o).map(t => new ZhenshangyinSwiper(t, { ...e })); return 1 === t.length ? t[0] : t } this.container = o[0], this.container && (this.options = { autoplay: e.autoplay || !1, interval: e.interval || 3e3, speed: e.speed || 500, direction: e.direction || "horizontal", loop: void 0 === e.loop || e.loop, magnifier: void 0 !== e.magnifier && e.magnifier, fixedMagnifierSize: e.fixedMagnifierSize || 400, showSelectionBox: void 0 === e.showSelectionBox || e.showSelectionBox, selectionBoxSize: e.selectionBoxSize || 100, magnifierMargin: e.magnifierMargin || 10, zoomRatio: e.zoomRatio || 2.5, pauseOnMouseEnter: void 0 !== e.pauseOnMouseEnter && e.pauseOnMouseEnter, pausedTime: 0, lastPauseTime: 0, pagination: e.pagination || {}, navigation: { prevEl: e.navigation?.prevEl || null, nextEl: e.navigation?.nextEl || null }, mousewheel: void 0 !== e.mousewheel && e.mousewheel, keyboard: void 0 !== e.keyboard && e.keyboard, touchable: void 0 === e.touchable || e.touchable, slidesPerView: e.slidesPerView || 1, spaceBetween: e.spaceBetween || 0, slidesPerGroup: e.slidesPerGroup || 1, centeredSlides: void 0 !== e.centeredSlides && e.centeredSlides, breakpoints: e.breakpoints || {}, effect: e.effect || "slide", perspective: void 0 !== e.perspective ? e.perspective : 1500, linkedGroup: e.linkedGroup || null, clickToSlide: void 0 === e.clickToSlide || e.clickToSlide, ...e }, this.manuallyPaused = !1, this.isMouseOver = !1, this.currentIndex = 0, this.slides = [], this.autoplayTimer = null, this.resizeObserver = null, this.containerWidth = 0, this.containerHeight = 0, this.currentBreakpoint = null, this.originalOptions = { ...this.options }, this.touchStartTime = 0, this.touchEndTime = 0, this.touchStartX = 0, this.touchStartY = 0, this.touchMoveX = 0, this.touchMoveY = 0, this.touchDiffX = 0, this.touchDiffY = 0, this.touchesDirection = null, this.isTouched = !1, this.isMoved = !1, this.velocity = 0, this.allowClick = !0, this.swipeDirection = null, this.isScrolling = !1, this.touchStartTranslate = 0, this.currentTranslate = 0, this.maxTranslate = 0, this.minTranslate = 0, this.isAnimatingRAF = !1, this.rafId = null, this.latestTranslate = 0, this.init()) } init() { this.container.classList.add("zhenshangyin-component"), this.options.perspective || 0 === this.options.perspective ? this.container.style.perspective = "number" == typeof this.options.perspective ? `${this.options.perspective}px` : this.options.perspective : !1 === this.options.perspective && (this.container.style.perspective = "none"), this.container.classList.add(`zhenshangyin-${this.options.direction}`), "fade" === this.options.effect && this.container.classList.add("zhenshangyin-fade"), this.wrapper = this.container.querySelector(".zhenshangyin-wrap"), this.slides = Array.from(this.wrapper.children), this.slides.forEach(t => { t.classList.add("zhenshangyin-slide") }); try { this.wrapper.style.willChange = "transform", "fade" === this.options.effect && this.slides.forEach(t => { t.style.willChange = "opacity, transform" }), "horizontal" === this.options.direction ? this.container.style.touchAction = "pan-y pinch-zoom" : this.container.style.touchAction = "pan-x pinch-zoom" } catch (t) { } if (this.options.loop || this.options.centeredSlides || (this.currentIndex = 0, this.activeSlideIndex = 0, this.slides[0] && this.slides[0].classList.add("zhenshangyin-slide-active")), this.options.magnifier && this.initMagnifier(), this.options.loop) { for (let t = this.slides.length - 1; t >= 0; t--) { const e = this.slides[t].cloneNode(!0); this.wrapper.insertBefore(e, this.wrapper.firstChild) } for (let t = 0; t < this.slides.length; t++) { const e = this.slides[t].cloneNode(!0); this.wrapper.appendChild(e) } this.slides = Array.from(this.wrapper.children), this.currentIndex = this.slides.length / 3, this.wrapper.style.transition = "none", this.updateSlides(), this.wrapper.offsetHeight, this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s ease`, this.slides.forEach((t, e) => { t && t.classList && t.classList.toggle("zhenshangyin-slide-active", e === this.currentIndex) }) } this.options.pagination && Object.keys(this.options.pagination).length > 0 && this.createPagination(), this.createNavButtons(), this.options.mousewheel && this.bindMouseWheelEvent(), this.options.keyboard && this.bindKeyboardEvent(), this.options.touchable && this.initTouchEvents(), this.updateSlides(), this.initResizeObserver(), this.wrapper.style.transition = "none", this.updateSlides(!1), this.wrapper.offsetHeight, this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s ease`, this.options.loop && this.slides.forEach((t, e) => { t && t.classList && t.classList.toggle("zhenshangyin-slide-active", e === this.currentIndex) }), "fade" !== this.options.effect && "vertical" !== this.options.direction || this.updateContainerHeight(), this.initEventListeners(), this.checkImagesLoaded(), this.options.autoplay && setTimeout(() => { this.startAutoplay() }, 0), this.options.pauseOnMouseEnter && this.options.autoplay && (this.container.addEventListener("mouseenter", () => { this.isMouseOver = !0 }), this.container.addEventListener("mouseleave", () => { this.isMouseOver = !1 })), this.options.linkedGroup && (ZhenshangyinSwiper.addToLinkedGroup(this, this.options.linkedGroup), !1 === this.options.clickToSlide && (this.options.clickToSlide = !0)), this.isTransformsEnabled() && this.initTransformEffects(), this.allowClick = !0, this.isTouched = !1, this.isMoved = !1 } togglePlayPause() { this.manuallyPaused = !this.manuallyPaused, this.manuallyPaused ? this.stopAutoplay() : this.startAutoplay() } initResizeObserver() { if ("undefined" != typeof ResizeObserver && this.container && this.container instanceof Element) { let t; this.resizeObserver = new ResizeObserver(e => { t && window.cancelAnimationFrame(t), t = window.requestAnimationFrame(() => { for (let t of e) { const e = t.contentRect.width, s = t.contentRect.height; e === this.containerWidth && s === this.containerHeight || (this.containerWidth = e, this.containerHeight = s, this.updateLayout()) } }) }), this.resizeObserver.observe(this.container) } else window.addEventListener("resize", this.handleResize.bind(this)) } handleResize() { this.resizeTimer && clearTimeout(this.resizeTimer), this.resizeTimer = setTimeout(() => { const t = this.container.offsetWidth, e = this.container.offsetHeight; t === this.containerWidth && e === this.containerHeight || (this.containerWidth = t, this.containerHeight = e, this.updateLayout()) }, 100) } updateLayout() { if (this._isUpdating) return; this._isUpdating = !0, this.checkBreakpoint(); const t = !!this.autoplayTimer; t && this.stopAutoplay(), requestAnimationFrame(() => { this.wrapper.style.transition = "none", "fade" !== this.options.effect && "vertical" !== this.options.direction || this.updateContainerHeight(), this.updateSlides(), this.createPagination(), this.updatePaginationState(), this.updateNavigationState(), this.wrapper.offsetHeight, requestAnimationFrame(() => { this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s ease`, "fade" === this.options.effect && this.slides.forEach(t => { t.style.transition = `opacity ${this.options.speed}ms ease` }), t && this.startAutoplay(), this._isUpdating = !1 }) }) } createPagination() { const t = this.options.pagination; if (!t || "object" != typeof t) return; if (!this.options.loop && this.slides.length <= 1) return void this.hidePaginationElements(); if (t.el) { let e = "bullets"; t.type && (e = t.type); const s = "string" == typeof t.el ? document.querySelectorAll(t.el) : [t.el]; if (!s || 0 === s.length) return; return void s.forEach(s => { s && (s.classList.add(`zhenshangyin-pager-${e}`), this.createPaginationByType(e, s, t)) }) } ["bullets", "numbers", "fraction", "progressbar", "scrollbar"].forEach(e => { const s = t[e]; if (!s || !s.el) return; const i = "string" == typeof s.el ? document.querySelectorAll(s.el) : [s.el]; i && 0 !== i.length && i.forEach(t => { t && (t.classList.add(`zhenshangyin-pager-${e}`), this.createPaginationByType(e, t, s)) }) }) } createPaginationByType(t, e, s) { e.innerHTML = "", this._pagerDelegates || (this._pagerDelegates = []), this._pagerDelegatedEls || (this._pagerDelegatedEls = new WeakSet); const i = (t, e) => { if (!e) return t; switch (e) { case "padded": return t < 10 ? `0${t}` : `${t}`; case "chinese": const e = ["é›¶", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å"]; return t <= 10 ? e[t] : t < 20 ? "å" + (t % 10 == 0 ? "" : e[t % 10]) : e[Math.floor(t / 10)] + "å" + (t % 10 == 0 ? "" : e[t % 10]); case "roman": const s = { 1: "I", 4: "IV", 5: "V", 9: "IX", 10: "X", 40: "XL", 50: "L", 90: "XC", 100: "C" }; let i = ""; const n = Object.keys(s).map(Number).sort((t, e) => e - t); let a = t; for (let t of n) for (; a >= t;)i += s[t], a -= t; return i; default: return t } }, n = t => { const e = t * this.options.slidesPerGroup; this.slideTo(e), this.options.autoplay && !this.manuallyPaused && (this.stopAutoplay(), this.startAutoplay()) }; let a, o; if (this.options.loop) a = Math.ceil(this.slides.length / 3 / this.options.slidesPerGroup); else if (this.options.centeredSlides) a = Math.ceil(this.slides.length / this.options.slidesPerGroup); else if ("number" == typeof this.options.slidesPerView) a = Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1); else if ("auto" === this.options.slidesPerView) { const t = this.container.getBoundingClientRect().width, e = this.slides[0].getBoundingClientRect().width + (this.options.spaceBetween || 0), s = Math.floor(t / e); a = Math.max(1, Math.ceil((this.slides.length - s) / this.options.slidesPerGroup) + 1) } else a = Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1); switch (o = a > 1 ? 1 / a : 1, t) { case "bullets": let t; if (this.options.loop) t = Math.ceil(this.slides.length / 3 / this.options.slidesPerGroup); else if (this.options.centeredSlides) t = Math.ceil(this.slides.length / this.options.slidesPerGroup); else if ("number" == typeof this.options.slidesPerView) t = Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1); else if ("auto" === this.options.slidesPerView) { const e = this.container.getBoundingClientRect().width, s = this.slides[0].getBoundingClientRect().width + (this.options.spaceBetween || 0), i = Math.floor(e / s), n = this.slides.length - i; t = n > 0 ? Math.ceil(n / this.options.slidesPerGroup) + 1 : 1 } else t = Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1); for (let s = 0; s < t; s++) { const t = document.createElement("div"), i = document.createElement("div"); i.classList.add("zhenshangyin-pager-bullets-bullet-inner"), t.appendChild(i), t.classList.add("zhenshangyin-pager-bullets-bullet"), t.dataset.index = String(s), 0 === s && t.classList.add("active"), e.appendChild(t) } if (!this._pagerDelegatedEls.has(e)) { const t = t => { if (!1 === s.clickable) return; const i = t.target.closest(".zhenshangyin-pager-bullets-bullet"); if (!i || !e.contains(i)) return; const a = parseInt(i.dataset.index || "0", 10); n(a) }, i = t => { if (!s.hoverChange) return; const i = t.target.closest(".zhenshangyin-pager-bullets-bullet"); if (!i || !e.contains(i)) return; const a = parseInt(i.dataset.index || "0", 10); n(a) }; e.addEventListener("click", t, { passive: !0 }), e.addEventListener("mouseenter", i, { passive: !0, capture: !0 }), this._pagerDelegatedEls.add(e), this._pagerDelegates.push({ el: e, clickHandler: t, hoverHandler: i }) } break; case "numbers": let r; r = this.options.loop ? Math.ceil(this.slides.length / 3 / this.options.slidesPerGroup) : this.options.centeredSlides ? Math.ceil(this.slides.length / this.options.slidesPerGroup) : Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1); for (let t = 0; t < r; t++) { const n = document.createElement("span"); n.classList.add("zhenshangyin-pager-numbers-number"), n.dataset.index = String(t), s.names?.[t] ? n.innerHTML = s.names[t] : n.textContent = i(t + 1, s.style), 0 === t && n.classList.add("active"), e.appendChild(n) } if (!this._pagerDelegatedEls.has(e)) { const t = t => { if (!1 === s.clickable) return; const i = t.target.closest(".zhenshangyin-pager-numbers-number"); if (!i || !e.contains(i)) return; const a = parseInt(i.dataset.index || "0", 10); n(a) }, i = t => { if (!s.hoverChange) return; const i = t.target.closest(".zhenshangyin-pager-numbers-number"); if (!i || !e.contains(i)) return; const a = parseInt(i.dataset.index || "0", 10); n(a) }; e.addEventListener("click", t, { passive: !0 }), e.addEventListener("mouseenter", i, { passive: !0, capture: !0 }), this._pagerDelegatedEls.add(e), this._pagerDelegates.push({ el: e, clickHandler: t, hoverHandler: i }) } break; case "fraction": let h; if (h = this.options.loop ? Math.ceil(this.slides.length / 3 / this.options.slidesPerGroup) : this.options.centeredSlides ? Math.ceil(this.slides.length / this.options.slidesPerGroup) : Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1), "progressbar" === s.style) { e.innerHTML = `\n                        <span class="current">1</span>\n                        <span class="separator">/</span>\n                        <span class="total">${h}</span>\n                        <div class="zhenshangyin-pager-fraction-progress"></div>\n                    `; const t = e.querySelector(".zhenshangyin-pager-fraction-progress"); t && (t.style.transform = `scaleX(${o})`, t.style.transformOrigin = "left center", t.style.transition = `transform ${this.options.speed}ms ease`) } else e.innerHTML = `\n                        <span class="current">${i(1, s.style)}</span>\n                        <span class="separator">/</span>\n                        <span class="total">${i(h, s.style)}</span>\n                    `; break; case "progressbar": e.innerHTML = '<div class="zhenshangyin-pager-progressbar-progress"></div>'; const l = e.querySelector(".zhenshangyin-pager-progressbar-progress"); l && (l.style.transform = `scaleX(${o})`, l.style.transformOrigin = "left center", l.style.transition = `transform ${this.options.speed}ms ease`); break; case "scrollbar": e.innerHTML = '<div class="zhenshangyin-pager-scrollbar-thumb"></div>'; const c = e.querySelector(".zhenshangyin-pager-scrollbar-thumb"); if (c) { const t = 1 / a * 100; "horizontal" === this.options.direction ? (c.style.width = `${t}%`, c.style.height = "100%") : (c.style.width = "100%", c.style.height = `${t}%`) } } } createNavButtons() { const { prevEl: t, nextEl: e } = this.options.navigation; if (!t && !e) return; !this.options.loop && this.slides.length <= 1 ? this.hideNavigationButtons() : (t && (this.prevButtons = "string" == typeof t ? Array.from(document.querySelectorAll(t)) : [t], this.prevButtons.length && this.prevButtons.forEach(t => { t.classList.add("zhenshangyin-prev"), t.addEventListener("click", () => { this.slidePrev() }) })), e && (this.nextButtons = "string" == typeof e ? Array.from(document.querySelectorAll(e)) : [e], this.nextButtons.length && this.nextButtons.forEach(t => { t.classList.add("zhenshangyin-next"), t.addEventListener("click", () => { this.slideNext() }) })), this.updateNavigationState()) } updateNavigationState() { if (!this.options.navigation.prevEl && !this.options.navigation.nextEl) return; if (!this.options.loop && !this.options.centeredSlides && this.slides.length <= this.options.slidesPerView) return this.prevButtons && this.prevButtons.forEach(t => { t.classList.add("disabled"), t.style.pointerEvents = "none" }), void (this.nextButtons && this.nextButtons.forEach(t => { t.classList.add("disabled"), t.style.pointerEvents = "none" })); if (this.options.loop) this.prevButtons && this.prevButtons.forEach(t => { t.classList.remove("disabled"), t.style.pointerEvents = "auto" }), this.nextButtons && this.nextButtons.forEach(t => { t.classList.remove("disabled"), t.style.pointerEvents = "auto" }); else { const t = this.currentIndex <= 0; let e = !1; if (this.options.centeredSlides) e = this.currentIndex >= this.slides.length - 1; else if ("auto" === this.options.slidesPerView) { const t = this.container.getBoundingClientRect().width, s = this.slides[0].getBoundingClientRect().width + (this.options.spaceBetween || 0), i = Math.floor(t / s), n = this.slides.length - i, a = window.getComputedStyle(this.wrapper).transform, o = new DOMMatrix(a), r = Math.abs(o.m41); let h = 0; this.slides.forEach((t, e) => { const s = t.getBoundingClientRect(); h += s.width, e < this.slides.length - 1 && (h += this.options.spaceBetween || 0) }), e = r >= h - t - 1 || this.currentIndex >= n } else { const t = Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup); e = this.currentIndex >= t } this.prevButtons && this.prevButtons.forEach(e => { e.classList.toggle("disabled", t), e.style.pointerEvents = t ? "none" : "auto" }), this.nextButtons && this.nextButtons.forEach(t => { t.classList.toggle("disabled", e), t.style.pointerEvents = e ? "none" : "auto" }) } } updateSlides(t = !0) { if ("fade" === this.options.effect) { this.wrapper.style.transform = "translate3d(0, 0, 0)"; const e = t => { if (this.options.loop) { const e = this.slides.length / 3; let s = t - e; return s < 0 ? s = e - 1 : s >= e && (s = 0), s } return t }, s = e(this.currentIndex); this.slides.forEach((e, i) => { if (e.style.transition = `opacity ${this.options.speed}ms ease`, e.style.position = "absolute", e.style.left = "0", e.style.top = "0", e.style.width = "100%", e.style.opacity = "0", e.style.zIndex = "1", t && e.classList.remove("zhenshangyin-slide-active"), this.options.loop) { const n = this.slides.length / 3;[s, s + n, s + 2 * n].includes(i) && (e.style.opacity = "1", e.style.zIndex = "2", t && e.classList.add("zhenshangyin-slide-active")) } else i === this.currentIndex && (e.style.opacity = "1", e.style.zIndex = "2", t && e.classList.add("zhenshangyin-slide-active")) }); const i = this.slides[this.currentIndex]; return i && (this.wrapper.style.height = `${i.offsetHeight}px`), this.updatePaginationState(), void this.updateNavigationState() } const e = this.container.getBoundingClientRect(), s = window.getComputedStyle(this.container), i = parseFloat(s.paddingLeft) || 0, n = parseFloat(s.paddingRight) || 0, a = parseFloat(s.paddingTop) || 0, o = parseFloat(s.paddingBottom) || 0, r = "horizontal" === this.options.direction ? e.width - i - n : e.height - a - o; if ("horizontal" === this.options.direction ? (this.wrapper.style.width = "100%", this.wrapper.style.marginLeft = `-${i}px`, this.wrapper.style.paddingLeft = `${i}px`, this.wrapper.style.paddingRight = `${n}px`) : (this.wrapper.style.height = "100%", this.wrapper.style.marginTop = `-${a}px`, this.wrapper.style.paddingTop = `${a}px`, this.wrapper.style.paddingBottom = `${o}px`), "auto" === this.options.slidesPerView) { const t = this.getSlideSize(), e = t + this.options.spaceBetween; let s; if (this.slides.forEach((e, s) => { "horizontal" === this.options.direction ? (e.style.width = `${t}px`, e.style.height = "100%", e.style.marginRight = s === this.slides.length - 1 ? "0" : `${this.options.spaceBetween}px`) : (e.style.width = "100%", e.style.height = `${t}px`, e.style.marginBottom = s === this.slides.length - 1 ? "0" : `${this.options.spaceBetween}px`) }), this.options.centeredSlides) { const i = (r - t) / 2; if (this.options.loop) s = -this.currentIndex * e + i; else { const t = this.slides.length - 1; s = -Math.min(this.currentIndex, t) * e + i } } else if (this.options.loop) s = -this.currentIndex * e; else { const t = Math.max(0, this.slides.length - this.options.slidesPerView); s = -Math.min(this.currentIndex, t) * e } this.wrapper.style.transform = "horizontal" === this.options.direction ? `translate3d(${s}px, 0, 0)` : `translate3d(0, ${s}px, 0)` } else { const t = (r - this.options.spaceBetween * (Math.min(this.options.slidesPerView, this.slides.length) - 1)) / this.options.slidesPerView, e = t + this.options.spaceBetween; let s; if (this.slides.forEach((e, s) => { "horizontal" === this.options.direction ? (e.style.width = `${t}px`, e.style.height = "100%", e.style.marginRight = s === this.slides.length - 1 ? "0" : `${this.options.spaceBetween}px`) : (e.style.width = "100%", e.style.height = `${t}px`, e.style.marginBottom = s === this.slides.length - 1 ? "0" : `${this.options.spaceBetween}px`) }), this.options.centeredSlides) { const i = (r - t) / 2; if (this.options.loop) s = -this.currentIndex * e + i; else { const t = this.slides.length - 1; s = -Math.min(this.currentIndex, t) * e + i } } else if (this.options.loop) s = -this.currentIndex * e; else { const t = Math.max(0, this.slides.length - this.options.slidesPerView); s = -Math.min(this.currentIndex, t) * e } this.wrapper.style.transform = "horizontal" === this.options.direction ? `translate3d(${s}px, 0, 0)` : `translate3d(0, ${s}px, 0)` } if (t && !this.isAnimating) { this._lastActiveIndices || (this._lastActiveIndices = new Set); const t = new Set; if (this.options.loop) { const e = this.slides.length / 3, s = this.currentIndex % e; s >= 0 && s < e && t.add(this.currentIndex) } else void 0 !== this.activeSlideIndex && this.activeSlideIndex < this.slides.length && t.add(this.activeSlideIndex); this._lastActiveIndices.forEach(e => { if (!t.has(e)) { const t = this.slides[e]; t && t.classList && t.classList.remove("zhenshangyin-slide-active") } }), t.forEach(t => { if (!this._lastActiveIndices.has(t)) { const e = this.slides[t]; e && e.classList && e.classList.add("zhenshangyin-slide-active") } }), this._lastActiveIndices = t } this.isTransformsEnabled() && this.updateTransforms(), this.updatePaginationState(), this.updateNavigationState() } slideTo(t, e = !1, s = !1) { if (this.isAnimating && !e) return; this.isAnimating = !0; const i = this.options.loop ? this.slides.length / 3 : this.slides.length; this.options.loop; if ("fade" === this.options.effect) return this.currentIndex = t, this.updateSlides(!1), this.slides.forEach((t, e) => { t && t.classList && t.classList.toggle("zhenshangyin-slide-active", e === this.currentIndex) }), void setTimeout(() => { if (this.isAnimating = !1, this.options.loop) { const e = this.slides.length / 3; t < e ? (this.currentIndex = t + e, this.activeSlideIndex = t, this.wrapper.style.transition = "none", this.updateSlides(!1), this.slides.forEach((t, e) => { t && t.classList && t.classList.toggle("zhenshangyin-slide-active", e === this.currentIndex) })) : t >= 2 * e && (this.currentIndex = t - e, this.activeSlideIndex = t, this.wrapper.style.transition = "none", this.updateSlides(!1), this.slides.forEach((t, e) => { t && t.classList && t.classList.toggle("zhenshangyin-slide-active", e === this.currentIndex) })) } }, this.options.speed); const n = t => { if (this.options.loop) { const e = this.slides.length / 3; let s = t - e; return s < 0 ? s = e - 1 : s >= e && (s = 0), s } return t }; if (this.options.loop && !s) { const e = this.slides.length / 3; if (e > 1) { const s = this.currentIndex % e; let i = t % e; i < 0 && (i += e); const n = i >= s ? i - s : i + e - s, a = s >= i ? s - i : s + e - i; t = n < a ? this.currentIndex + n : a < n ? this.currentIndex - a : t > this.currentIndex ? this.currentIndex + n : this.currentIndex - a } } if (!e) { const t = this.slides[this.currentIndex]; t && Array.from(t.classList || []), n(this.currentIndex) } const a = "horizontal" === this.options.direction ? this.container.offsetWidth : this.container.offsetHeight; let o; if ("auto" === this.options.slidesPerView) { if (!this.slides[t]) return void (this.isAnimating = !1); if (this.isTransformsEnabled && this.isTransformsEnabled()) { const e = this.getSlideSize(), s = e + this.options.spaceBetween; if (this.options.centeredSlides) { o = -t * s + (a - e) / 2 } else o = -t * s } else { const e = this.slides.map(t => t.getBoundingClientRect()), s = e[t], i = "horizontal" === this.options.direction ? s.width : s.height; if (this.options.loop && this.options.centeredSlides) { const s = (a - i) / 2; let n = 0; for (let s = 0; s < t; s++)n += ("horizontal" === this.options.direction ? e[s].width : e[s].height) + this.options.spaceBetween; o = -n + s } else if (this.options.loop && !this.options.centeredSlides) { let s = 0; for (let i = 0; i < t; i++)s += ("horizontal" === this.options.direction ? e[i].width : e[i].height) + this.options.spaceBetween; o = -s } else if (!this.options.loop && this.options.centeredSlides) { const s = (a - i) / 2; let n = 0; for (let s = 0; s < t; s++)n += ("horizontal" === this.options.direction ? e[s].width : e[s].height) + this.options.spaceBetween; o = -n + s } else { let s = 0, i = 0; e.forEach((t, e) => { i += "horizontal" === this.options.direction ? t.width : t.height, e < this.slides.length - 1 && (i += this.options.spaceBetween) }); const n = "horizontal" === this.options.direction ? this.container.offsetWidth : this.container.offsetHeight; for (let i = 0; i < t; i++)s += ("horizontal" === this.options.direction ? e[i].width : e[i].height) + this.options.spaceBetween; o = t === this.slides.length - 1 ? Math.min(-s, n - i) : -s } } } else { const e = (a - this.options.spaceBetween * (Math.min(this.options.slidesPerView, this.slides.length) - 1)) / this.options.slidesPerView, s = e + this.options.spaceBetween; if (this.options.centeredSlides && this.options.loop) { const i = (a - e) / 2; this.options.slidesPerGroup, this.slides.length; let n = t * s; o = (Math.abs(t - this.currentIndex), -n + i) } else if (this.options.centeredSlides) { const i = (a - e) / 2; o = this.options.loop || 0 !== t ? this.options.loop || t !== this.slides.length - 1 ? -t * s + i : -(this.slides.length - 1) * s + i : i } else if (this.options.loop) o = -t * s; else { const e = Math.max(0, this.slides.length - this.options.slidesPerView); o = -Math.min(t, e) * s } } this.currentIndex = t, e ? (this.wrapper.style.transition = "none", this.wrapper.style.transform = "horizontal" === this.options.direction ? `translate3d(${o}px, 0, 0)` : `translate3d(0, ${o}px, 0)`) : (this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s ease`, this.updatePaginationState(), this.updateNavigationState()); const r = this.options.loop ? this.slides.length / 3 : this.slides.length; this.options.loop ? this.activeSlideIndex = t % r : this.activeSlideIndex = t; const h = this.options.loop && (t < r || t >= 2 * r), l = t; let c = null; if (h) { const e = this.slides.length / 3; t < e ? c = t + e : t >= 2 * e && (c = t - e) } if (this.slides.forEach((t, e) => { t && t.classList && e !== l && e !== c && t.classList.remove("zhenshangyin-slide-active") }), this.slides[l] && this.slides[l].classList && this.slides[l].classList.add("zhenshangyin-slide-active"), null !== c && this.slides[c] && this.slides[c].classList && this.slides[c].classList.add("zhenshangyin-slide-active"), h || this.updateSlides(!1), e || (this.wrapper.style.transform = "horizontal" === this.options.direction ? `translate3d(${o}px, 0, 0)` : `translate3d(0, ${o}px, 0)`), setTimeout(() => { if (this.isAnimating = !1, !e) { const e = this.slides[t]; e && Array.from(e.classList || []) } this.options.loop; if (this.options.loop) { const e = this.slides.length / 3; t < e ? (this.wrapper.style.opacity = "0", this.currentIndex = t + e, this.activeSlideIndex = t, this.wrapper.style.transition = "none", this.updateSlides(!1), this.wrapper.offsetHeight, this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s ease`, this.slides[t] && this.slides[t].classList && this.slides[t].classList.remove("zhenshangyin-slide-active"), requestAnimationFrame(() => { this.wrapper.style.opacity = "1" })) : t >= 2 * e && (this.wrapper.style.opacity = "0", this.currentIndex = t - e, this.activeSlideIndex = t, this.wrapper.style.transition = "none", this.updateSlides(!1), this.wrapper.offsetHeight, this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s ease`, this.slides[t] && this.slides[t].classList && this.slides[t].classList.remove("zhenshangyin-slide-active"), requestAnimationFrame(() => { this.wrapper.style.opacity = "1" })) } }, this.options.speed), this.options.linkedGroup && !e) { const t = this.options.loop ? this.currentIndex % (this.slides.length / 3) : this.currentIndex; ZhenshangyinSwiper.notifyLinkedGroupChange(t, this, this.options.linkedGroup) } } slideNext() { if (!this.isAnimating && (this.options.loop || this.options.centeredSlides || !(this.slides.length <= this.options.slidesPerView))) if (this.options.loop) if ("auto" === this.options.slidesPerView) { const t = this.currentIndex + (this.options.slidesPerGroup || 1); this.slideTo(t) } else if (this.options.centeredSlides) { const t = this.currentIndex + this.options.slidesPerGroup; if (t < this.slides.length) this.slideTo(t); else { const e = this.slides.length / 3, s = t % e; this.slideTo(e + s) } } else if ("number" != typeof this.options.slidesPerView || this.options.centeredSlides) this.slideTo(this.currentIndex + this.options.slidesPerGroup); else { const t = this.currentIndex + this.options.slidesPerGroup; if (t < this.slides.length) this.slideTo(t); else { const e = this.slides.length / 3, s = t % e; this.slideTo(e + s) } } else if ("auto" === this.options.slidesPerView) { const t = this.container.getBoundingClientRect().width, e = this.slides[0].getBoundingClientRect().width + (this.options.spaceBetween || 0), s = Math.floor(t / e), i = this.slides.length - s, n = Math.min(this.currentIndex + (this.options.slidesPerGroup || 1), i); this.slideTo(n) } else { const t = this.slides.length - 1; let e = this.currentIndex + (this.options.slidesPerGroup || 1); e = Math.min(e, t), this.slideTo(e) } } slidePrev() { if (!this.isAnimating && (this.options.loop || this.options.centeredSlides || !(this.slides.length <= this.options.slidesPerView))) if (this.options.loop) if ("auto" === this.options.slidesPerView) { const t = this.currentIndex - (this.options.slidesPerGroup || 1); this.slideTo(t) } else if (this.options.centeredSlides) { const t = this.currentIndex - this.options.slidesPerGroup; if (t >= 0) this.slideTo(t); else { const e = this.slides.length / 3, s = 2 * e + (e + t % e); this.slideTo(s) } } else if ("number" != typeof this.options.slidesPerView || this.options.centeredSlides) this.slideTo(this.currentIndex - this.options.slidesPerGroup); else { const t = this.currentIndex - this.options.slidesPerGroup; if (t >= 0) this.slideTo(t); else { const e = this.slides.length / 3, s = 2 * e + (e + t % e); this.slideTo(s) } } else if ("auto" === this.options.slidesPerView) { const t = Math.max(this.currentIndex - (this.options.slidesPerGroup || 1), 0); this.slideTo(t) } else { let t = this.currentIndex - (this.options.slidesPerGroup || 1); t = Math.max(t, 0), this.slideTo(t) } } startAutoplay() { !this.options.autoplay || this.autoplayTimer || this.manuallyPaused || (this.autoplayTimer = setInterval(() => { this.slideNext() }, this.options.interval)) } stopAutoplay() { this.autoplayTimer && (clearInterval(this.autoplayTimer), this.autoplayTimer = null) } updatePaginationState(t = null) { const e = this.options.pagination; if (!e || "object" != typeof e) return; let s, i; if (this.options.loop) i = Math.ceil(this.slides.length / 3 / this.options.slidesPerGroup); else if (this.options.centeredSlides) i = Math.ceil(this.slides.length / this.options.slidesPerGroup); else if ("auto" === this.options.slidesPerView) { const t = this.container.getBoundingClientRect().width, e = this.slides[0].getBoundingClientRect().width + (this.options.spaceBetween || 0), s = Math.floor(t / e); i = Math.max(1, Math.ceil((this.slides.length - s) / this.options.slidesPerGroup) + 1) } else i = Math.max(1, Math.ceil((this.slides.length - this.options.slidesPerView) / this.options.slidesPerGroup) + 1); if (null !== t) s = t; else if (this.options.loop) { const t = this.slides.length / 3; s = this.currentIndex % t, s = Math.floor(s / this.options.slidesPerGroup) } else s = Math.floor(this.currentIndex / this.options.slidesPerGroup); if (s = Math.max(0, Math.min(s, i - 1)), e.el) { const t = "string" == typeof e.el ? document.querySelectorAll(e.el) : [e.el]; if (!t || 0 === t.length) return; const n = e.type || "bullets"; return void t.forEach(t => { t && this.updatePaginationByType(n, t, s, i) }) } ["bullets", "numbers", "fraction", "progressbar", "scrollbar"].forEach(t => { const n = e[t]; if (!n || !n.el) return; const a = "string" == typeof n.el ? document.querySelectorAll(n.el) : [n.el]; a && 0 !== a.length && a.forEach(e => { e && this.updatePaginationByType(t, e, s, i) }) }) } updatePaginationByType(t, e, s, i) { const n = (t, e) => { if (!e) return t; switch (e) { case "padded": return t < 10 ? `0${t}` : `${t}`; case "chinese": const e = ["é›¶", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å"]; return t <= 10 ? e[t] : t < 20 ? "å" + (t % 10 == 0 ? "" : e[t % 10]) : e[Math.floor(t / 10)] + "å" + (t % 10 == 0 ? "" : e[t % 10]); case "roman": const s = { 1: "I", 4: "IV", 5: "V", 9: "IX", 10: "X", 40: "XL", 50: "L", 90: "XC", 100: "C" }; let i = ""; const n = Object.keys(s).map(Number).sort((t, e) => e - t); let a = t; for (let t of n) for (; a >= t;)i += s[t], a -= t; return i; default: return t } }, a = i > 1 ? (s + 1) / i : 1; switch (t) { case "bullets": e.querySelectorAll(".zhenshangyin-pager-bullets-bullet").forEach((t, e) => { t.classList.toggle("active", e === s) }); break; case "numbers": e.querySelectorAll(".zhenshangyin-pager-numbers-number").forEach((t, e) => { e < i ? (t.style.display = "", t.classList.toggle("active", e === s)) : t.style.display = "none" }); break; case "fraction": const t = e.querySelector(".current"), o = e.querySelector(".total"), r = this.options.pagination.fraction || this.options.pagination; if (t) if ("progressbar" === r.style) { t.textContent = s + 1; const i = e.querySelector(".zhenshangyin-pager-fraction-progress"); i && (i.style.transform = `scaleX(${a})`) } else t.textContent = n(s + 1, r.style); o && (o.textContent = n(i, r.style)); break; case "progressbar": const h = e.querySelector(".zhenshangyin-pager-progressbar-progress"); h && (h.style.transform = `scaleX(${a})`, h.style.transformOrigin = "left center", h.style.transition = `transform ${this.options.speed}ms ease`); break; case "scrollbar": const l = e.querySelector(".zhenshangyin-pager-scrollbar-thumb"); if (l) if (i > 1) { const t = 100 * s; "horizontal" === this.options.direction ? l.style.transform = `translateX(${t}%)` : l.style.transform = `translateY(${t}%)`, l.style.transition = `transform ${this.options.speed}ms ease` } else "horizontal" === this.options.direction ? l.style.transform = "translateX(0%)" : l.style.transform = "translateY(0%)" } } bindMouseWheelEvent() { let t = 0; const e = 300; let s = null, i = null; const n = (t, e) => { if (!t) return !1; if (!(t.scrollHeight > t.clientHeight)) return !1; const s = t.scrollTop <= 3, i = t.scrollTop + t.clientHeight >= t.scrollHeight - 3; return e > 0 ? !i : !s }, a = (t, e) => { let s = t; const i = this.slides && this.slides[this.currentIndex]; if (!i) return null; for (; s && s !== document.body;) { if (i.contains(s) && n(s, e)) return s; s = s.parentElement } return n(i, e) ? i : null }; this.container.addEventListener("wheel", n => { const o = Date.now(); if (!("vertical" !== this.options.direction || Math.abs(n.deltaY) > Math.abs(n.deltaX))) return; const r = a(n.target, n.deltaY); if (r) { const a = 3, h = r.scrollTop, l = h <= a, c = h >= r.scrollHeight - r.clientHeight - a; if (n.deltaY > 0 && c) return s = null, void (o - t >= e && (t = o, n.cancelable && n.preventDefault(), n.stopPropagation(), this.slideNext())); if (n.deltaY < 0 && l) return s = null, void (o - t >= e && (t = o, n.cancelable && n.preventDefault(), n.stopPropagation(), this.slidePrev())); s = null, n.stopPropagation(), i && clearTimeout(i), i = setTimeout(() => { ((t, e) => { if (!t) return; const i = t.scrollTop, n = t.scrollHeight, a = t.clientHeight; s = e > 0 && i >= n - a - 3 ? "next" : e < 0 && i <= 3 ? "prev" : null })(r, n.deltaY) }, 30) } else { if (i && (clearTimeout(i), i = null), s) { const i = s; if ("next" === i && n.deltaY > 0 || "prev" === i && n.deltaY < 0) { if (s = null, o - t >= e) return t = o, n.cancelable && n.preventDefault(), void ("next" === i ? this.slideNext() : this.slidePrev()) } else s = null } if (o - t < e) return; if (t = o, n.cancelable && n.preventDefault(), "vertical" === this.options.direction) n.deltaY > 0 ? this.slideNext() : this.slidePrev(); else { (Math.abs(n.deltaX) > 0 ? n.deltaX : n.deltaY) > 0 ? this.slideNext() : this.slidePrev() } } }, { passive: !1 }), this.container.addEventListener("scroll", t => { const e = this.slides && this.slides[this.currentIndex]; if (!e) return; let i = t.target; for (; i && i !== document.body;) { if (e.contains(i)) { if (i.scrollHeight > i.clientHeight) { const t = 3, e = i.scrollTop, n = e <= t, a = e >= i.scrollHeight - i.clientHeight - t; a && "next" !== s ? s = "next" : n && "prev" !== s ? s = "prev" : n || a || (s = null); break } } i = i.parentElement } }, { passive: !0, capture: !0 }) } bindKeyboardEvent() { document.addEventListener("keydown", t => { "horizontal" === this.options.direction ? "ArrowRight" === t.key ? (t.preventDefault(), this.slideNext()) : "ArrowLeft" === t.key && (t.preventDefault(), this.slidePrev()) : "ArrowDown" === t.key ? (t.preventDefault(), this.slideNext()) : "ArrowUp" === t.key && (t.preventDefault(), this.slidePrev()) }) } destroy() { this.stopAutoplay(); const t = this.container, e = "ontouchstart" in window || navigator.maxTouchPoints > 0, s = !!window.PointerEvent, i = !!window.navigator.msPointerEnabled, n = { start: s ? "pointerdown" : i ? "MSPointerDown" : "touchstart", move: s ? "pointermove" : i ? "MSPointerMove" : "touchmove", end: s ? "pointerup" : i ? "MSPointerUp" : "touchend", cancel: s ? "pointercancel" : i ? "MSPointerCancel" : "touchcancel" }; this.touchHandlers && (t.removeEventListener(n.start, this.touchHandlers.start, !1), t.removeEventListener(n.move, this.touchHandlers.move, !1), t.removeEventListener(n.end, this.touchHandlers.end, !1), t.removeEventListener(n.cancel, this.touchHandlers.cancel, !1), document.removeEventListener(n.end, this.touchHandlers.documentEnd, !1), document.removeEventListener(n.cancel, this.touchHandlers.documentEnd, !1), e || (t.removeEventListener("mousedown", this.touchHandlers.start, !1), document.removeEventListener("mousemove", this.touchHandlers.move, !1), document.removeEventListener("mouseup", this.touchHandlers.end, !1))), window.activeZhenshangyinSwiper === this && (window.activeZhenshangyinSwiper = null), this.slides = null, this.wrapper = null, this.container = null, this.resizeObserver && (this.resizeObserver.disconnect(), this.resizeObserver = null), window.removeEventListener("resize", this.handleResize), this.resizeTimer && (clearTimeout(this.resizeTimer), this.resizeTimer = null), this.options.linkedGroup && ZhenshangyinSwiper.removeFromLinkedGroup(this, this.options.linkedGroup), this._onVisibilityChange && (document.removeEventListener("visibilitychange", this._onVisibilityChange), this._onVisibilityChange = null), this._pagerDelegates && Array.isArray(this._pagerDelegates) && (this._pagerDelegates.forEach(({ el: t, clickHandler: e, hoverHandler: s }) => { t && e && t.removeEventListener("click", e), t && s && t.removeEventListener("mouseenter", s, { capture: !0 }) }), this._pagerDelegates = []) } checkBreakpoint() { const t = this.options.breakpoints, e = window.innerWidth, s = Object.keys(t).map(t => parseInt(t)).sort((t, e) => e - t); let i = null; for (const t of s) e <= t && (i = t); i !== this.currentBreakpoint && (this.currentBreakpoint = i, this.options = { ...this.originalOptions }, i && t[i] && (this.options = { ...this.options, ...t[i] })) } updateContainerHeight() { const t = this.slides[this.activeSlideIndex] || this.slides[0]; if (t) { const e = t.querySelector("img"); e ? e.complete && e.naturalHeight > 0 ? this.setContainerHeight(t) : e.addEventListener("load", () => this.updateLayout(), { once: !0 }) : this.setContainerHeight(t) } } setContainerHeight(t) { t.style.height = "auto"; const e = t.offsetHeight; if (e > 0) { let t = e; if ("vertical" === this.options.direction && this.options.slidesPerView > 1) { const s = (this.options.spaceBetween || 0) * (this.options.slidesPerView - 1); t = e * this.options.slidesPerView + s } this.container.style.height = `${t}px` } "fade" === this.options.effect && this.slides.forEach(t => { e > 0 && (t.style.height = `${e}px`) }) } initEventListeners() { this.container.addEventListener("click", t => { }), this.options.linkedGroup && this.options.clickToSlide && this.initClickToSlide() } checkImagesLoaded() { const t = this.container.getElementsByTagName("img"); Array.from(t).forEach(t => { t.complete || (t.onload = () => { }) }) } update() { this.updateLayout() } initMagnifier() { this.initFixedMagnifier() } initFixedMagnifier() { let t = null, e = null; try { const t = window.getComputedStyle(this.container).position; t && "static" !== t || (this.container.style.position = "relative") } catch (t) { } const s = (t, e) => { const s = window.innerWidth, i = window.innerHeight, n = this.options.magnifierMargin, a = []; s - t.right - n >= e && a.push({ position: "right", top: t.top, left: t.right + n }); t.left - n >= e && a.push({ position: "left", top: t.top, left: t.left - e - n }); i - t.bottom - n >= e && a.push({ position: "bottom", top: t.bottom + n, left: t.left + (t.width - e) / 2 }); if (t.top - n >= e && a.push({ position: "top", top: t.top - e - n, left: t.left + (t.width - e) / 2 }), 0 === a.length) return { position: "right", top: t.top, left: t.right + n }; const o = ["right", "left", "bottom", "top"]; for (const t of o) { const e = a.find(e => e.position === t); if (e) return e } return a[0] }, i = () => { if (!t) { t = document.createElement("div"), t.className = "zhenshangyin-fixed-magnifier"; const e = this.options.fixedMagnifierSize || 400; t.style.width = e + "px", t.style.height = e + "px", document.body.appendChild(t) } return t }, n = () => { t && (t.remove(), t = null), e && (e.remove(), e = null) }, a = t => { const e = t.querySelector("img"); if (e) { t.classList.add("zhenshangyin-magnifier-active"); let a = null; const o = () => { if (!a && this.options.showSelectionBox) { const e = this.options.selectionBoxSize || Math.floor(this.options.fixedMagnifierSize / this.options.zoomRatio); a = document.createElement("div"), a.className = "zhenshangyin-selection-box", a.style.width = e + "px", a.style.height = e + "px", a.style.position = "absolute", a.style.pointerEvents = "none", a.style.transform = "translate(-50%, -50%)", a.style.margin = "0", a.style.boxSizing = "border-box", t.appendChild(a) } return a }, r = () => { a && (a.remove(), a = null) }, h = n => { const a = i(), r = o(), h = t.getBoundingClientRect(), l = e.getBoundingClientRect(), c = this.container.getBoundingClientRect(); let d = n.clientX - h.left, p = n.clientY - h.top; if (r) { const t = (r.offsetWidth || this.options.selectionBoxSize || Math.floor(this.options.fixedMagnifierSize / this.options.zoomRatio)) / 2, e = Math.max(t, Math.min(h.width - t, d)), s = Math.max(t, Math.min(h.height - t, p)); r.style.left = e + "px", r.style.top = s + "px", r.style.display = "block", d = e, p = s } const u = this.options.fixedMagnifierSize || 400, g = s(c, u); a.style.top = g.top + "px", a.style.left = g.left + "px", a.style.backgroundImage = `url(${e.src})`, a.style.backgroundSize = `${l.width * this.options.zoomRatio}px ${l.height * this.options.zoomRatio}px`; const m = l.left - h.left, y = l.top - h.top, f = -(d - m) * this.options.zoomRatio + a.offsetWidth / 2, v = -(p - y) * this.options.zoomRatio + a.offsetHeight / 2; a.style.backgroundPosition = `${f}px ${v}px`, a.style.display = "block" }; t.addEventListener("mouseenter", e => { if (t.classList.contains("zhenshangyin-slide-active")) { const n = i(), a = o(), r = t.getBoundingClientRect(), h = this.container.getBoundingClientRect(); if (a) { const t = (a.offsetWidth || this.options.selectionBoxSize || Math.floor(this.options.fixedMagnifierSize / this.options.zoomRatio)) / 2; let s = (e.clientX ?? r.left + r.width / 2) - r.left, i = (e.clientY ?? r.top + r.height / 2) - r.top; const n = Math.max(t, Math.min(r.width - t, s)), o = Math.max(t, Math.min(r.height - t, i)); a.style.left = n + "px", a.style.top = o + "px", a.style.display = "block" } const l = this.options.fixedMagnifierSize || 400, c = s(h, l); n.style.top = c.top + "px", n.style.left = c.left + "px", n.style.display = "block" } }), t.addEventListener("mousemove", h), t.addEventListener("mouseleave", () => { n(), r() }), this.wrapper.addEventListener("mousedown", () => { n(), r() }) } }; if (this.slides.forEach(t => { a(t) }), this.options.loop) { new MutationObserver(t => { t.forEach(t => { t.addedNodes.forEach(t => { 1 === t.nodeType && t.classList.contains("zhenshangyin-slide") && a(t) }) }) }).observe(this.wrapper, { childList: !0, subtree: !0 }) } window.addEventListener("scroll", () => { if (t && "block" === t.style.display) { const e = this.container.getBoundingClientRect(), i = this.options.fixedMagnifierSize || 400, n = s(e, i); t.style.top = n.top + "px", t.style.left = n.left + "px" } }), window.addEventListener("resize", () => { if (t && "block" === t.style.display) { const e = this.container.getBoundingClientRect(), i = this.options.fixedMagnifierSize || 400, n = s(e, i); t.style.top = n.top + "px", t.style.left = n.left + "px" } }) } initTouchEvents() { const t = this.container, e = "ontouchstart" in window || navigator.maxTouchPoints > 0, s = !!window.PointerEvent, i = !!window.navigator.msPointerEnabled; let n = 0, a = 0, o = []; const r = t => { if (!this.options.loop && !this.options.centeredSlides && this.slides.length <= this.options.slidesPerView) return; if (this.isAnimatingRAF && (cancelAnimationFrame(this.rafId), this.isAnimatingRAF = !1), this.isAnimating) return; let s, i; t.preventDefault(), this.touchStartTime = Date.now(), this.allowClick = !0, this.isTouched = !0, this.isMoved = !1, this.isScrolling = void 0, this.touchesDirection = void 0, o = [], this._touchEndProcessed = !1, e && "touchstart" === t.type ? (s = t.targetTouches[0].pageX, i = t.targetTouches[0].pageY) : (s = t.pageX || t.clientX, i = t.pageY || t.clientY), this.touchStartX = s, this.touchStartY = i; const r = window.getComputedStyle(this.wrapper).getPropertyValue("transform"); if (r && "none" !== r) { const t = new DOMMatrix(r); this.touchStartTranslate = "horizontal" === this.options.direction ? t.m41 : t.m42 } else this.touchStartTranslate = 0; this.calculateTranslateLimits(), this.currentTranslate = this.touchStartTranslate, this.latestTranslate = this.currentTranslate, n = Date.now(), a = this.currentTranslate, window.activeZhenshangyinSwiper = this, this.options.autoplay && !this.manuallyPaused && this.stopAutoplay(), "function" == typeof u && u(), this.onTouchStart(t) }, h = t => { if (!this.isTouched || window.activeZhenshangyinSwiper !== this) return; let s, i; t.stopPropagation(), e && "touchmove" === t.type ? (s = t.targetTouches[0].pageX, i = t.targetTouches[0].pageY) : (s = t.pageX || t.clientX, i = t.pageY || t.clientY); try { const n = e && "touchmove" === t.type ? t.targetTouches[0]?.clientX : t.clientX ?? s, a = e && "touchmove" === t.type ? t.targetTouches[0]?.clientY : t.clientY ?? i, o = this.container?.getBoundingClientRect?.(); if (o && (n < o.left || n > o.right || a < o.top || a > o.bottom)) return void ("function" == typeof l && l(t)) } catch (t) { } if (this.touchMoveX = s, this.touchMoveY = i, this.touchDiffX = this.touchMoveX - this.touchStartX, this.touchDiffY = this.touchMoveY - this.touchStartY, void 0 === this.isScrolling) { const t = Math.abs(this.touchDiffX), e = Math.abs(this.touchDiffY); (t > 5 || e > 5) && (this.isScrolling = "horizontal" === this.options.direction ? e > t : t > e) } if (this.isScrolling) return void (this.isTouched = !1); t.cancelable && t.preventDefault(); let r = "horizontal" === this.options.direction ? this.touchDiffX : this.touchDiffY; if (r *= 1, this.touchesDirection = r > 0 ? "prev" : "next", !this.isMoved) { this.isMoved = !0; const t = 10; Math.abs(r) > t && (this.allowClick = !1) } const h = Date.now(), c = h - n; if (c > 0) { const t = (this.currentTranslate - a) / c; o.push(t), o.length > 5 && o.shift(), n = h, a = this.currentTranslate } let d = this.touchStartTranslate + r; if (!this.options.loop) if (d > this.maxTranslate) { const t = d - this.maxTranslate; d = this.maxTranslate + .4 * t } else if (d < this.minTranslate) { const t = this.minTranslate - d; d = this.minTranslate - .4 * t } this.currentTranslate = d, this.latestTranslate = d, this.isAnimatingRAF || (this.isAnimatingRAF = !0, this.rafId = requestAnimationFrame(this.applyTransform.bind(this))), this.onTouchMove(t) }, l = t => { if (this._touchEndProcessed) return; if (this._touchEndProcessed = !0, this.isAnimatingRAF && (cancelAnimationFrame(this.rafId), this.isAnimatingRAF = !1), !this.isTouched || window.activeZhenshangyinSwiper !== this) return "function" == typeof g && g(), void (this.allowClick = !1); const e = this.isMoved; if (this.isTouched = !1, this.isMoved = !1, "function" == typeof g && g(), !e) return this.allowClick = !0, void (this.options.autoplay && !this.manuallyPaused && this.startAutoplay()); this.allowClick = !1, window.activeZhenshangyinSwiper = null, this.touchEndTime = Date.now(); this.touchEndTime, this.touchStartTime; let s = 0; o.length > 0 && (s = o.reduce((t, e) => t + e, 0) / o.length); const i = "horizontal" === this.options.direction ? this.touchDiffX : this.touchDiffY; this.velocity = Math.abs(s), this.swipeDirection = i > 0 ? "prev" : "next"; Math.sqrt(Math.pow(this.touchDiffX, 2) + Math.pow(this.touchDiffY, 2)) <= 5 && (this.allowClick = !0), this.restoreAllowClickAfterTouch(), this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s cubic-bezier(0.25, 0.46, 0.45, 0.94)`; const n = this.currentTranslate - this.touchStartTranslate, a = Math.abs(n); const r = this.getSlideSize() + (this.options.spaceBetween || 0); let h = 0; if ((a > .15 * r || this.velocity > this.options.velocityThreshold) && (h = Math.max(1, Math.round(a / r)), this.velocity > 2 * this.options.velocityThreshold && (h = Math.min(h + 1, 3)), "prev" === this.swipeDirection && (h = -h)), 0 === h) return this.restorePosition(), this.options.autoplay && !this.manuallyPaused && this.startAutoplay(), void this.onTouchEnd(t); let l = this.currentIndex + h, c = !1; if (this.options.loop) (a > r || Math.abs(h) > 1) && (c = !0); else if (l = Math.max(0, Math.min(l, this.slides.length - 1)), this.options.slidesPerView > 1 && !this.options.centeredSlides) { const t = this.slides.length - this.options.slidesPerView; l = Math.max(0, Math.min(l, t)) } this.slideTo(l, !1, c), this.options.autoplay && !this.manuallyPaused && this.startAutoplay(), this.onTouchEnd(t) }, c = t => { window.activeZhenshangyinSwiper === this && l(t) }, d = { start: s ? "pointerdown" : i ? "MSPointerDown" : "touchstart", move: s ? "pointermove" : i ? "MSPointerMove" : "touchmove", end: s ? "pointerup" : i ? "MSPointerUp" : "touchend", cancel: s ? "pointercancel" : i ? "MSPointerCancel" : "touchcancel" }; t.addEventListener(d.start, r, !1); let p = null; const u = () => { p || (p = h.bind(this), document.addEventListener(d.move, p, { passive: !1 }), e || document.addEventListener("mousemove", p, { passive: !1 })) }, g = () => { p && (document.removeEventListener(d.move, p, { passive: !1 }), e || document.removeEventListener("mousemove", p, { passive: !1 }), p = null) }; t.addEventListener(d.end, l, !1), t.addEventListener(d.cancel, l, !1), document.addEventListener(d.end, c, !1), document.addEventListener(d.cancel, c, !1), e || t.addEventListener("mousedown", r, !1), e || t.addEventListener("mouseleave", t => { window.activeZhenshangyinSwiper === this && this.isTouched && l(t) }, !1), t.addEventListener("click", t => { if (!this.allowClick) { if ("A" === t.target.tagName ? t.target : t.target.closest("a")) { if (Math.sqrt(Math.pow(this.touchDiffX, 2) + Math.pow(this.touchDiffY, 2)) <= 5) return !0 } return t.preventDefault(), t.stopPropagation(), !1 } }, !0), document.addEventListener("click", t => { if (!1 === this.allowClick && this.container.contains(t.target)) { if ("A" === t.target.tagName ? t.target : t.target.closest("a")) { if (Math.sqrt(Math.pow(this.touchDiffX, 2) + Math.pow(this.touchDiffY, 2)) <= 5) return this.allowClick = !0, !0 } return t.preventDefault(), t.stopPropagation(), !1 } window.activeZhenshangyinSwiper !== this && (this.allowClick = !0, this.isTouched = !1, this.isMoved = !1) }, !0), this.touchHandlers = { start: r, move: h, end: l, cancel: l, documentEnd: c } } applyTransform() { if (this.wrapper) { this.wrapper.style.transition = "none"; const t = "horizontal" === this.options.direction ? `translate3d(${this.latestTranslate}px, 0, 0)` : `translate3d(0, ${this.latestTranslate}px, 0)`; this.wrapper.style.transform = t } this.isAnimatingRAF = !1 } calculateTranslateLimits() { if (this.options.loop) return this.minTranslate = -1 / 0, void (this.maxTranslate = 1 / 0); const t = "horizontal" === this.options.direction ? this.container.offsetWidth : this.container.offsetHeight; if ("auto" === this.options.slidesPerView) { let e = 0; if (this.slides.forEach((t, s) => { const i = t.getBoundingClientRect(); e += "horizontal" === this.options.direction ? i.width : i.height, s < this.slides.length - 1 && (e += this.options.spaceBetween) }), this.options.centeredSlides) { const s = this.slides[0].getBoundingClientRect(), i = (t - ("horizontal" === this.options.direction ? s.width : s.height)) / 2; this.maxTranslate = i, this.minTranslate = -(e - t + i) } else this.maxTranslate = 0, this.minTranslate = -(e - t) } else { const e = (t - this.options.spaceBetween * (Math.min(this.options.slidesPerView, this.slides.length) - 1)) / this.options.slidesPerView, s = e + this.options.spaceBetween; if (this.options.centeredSlides) { const i = (t - e) / 2, n = this.slides.length - 1; this.maxTranslate = i, this.minTranslate = -(n * s - i) } else { const t = this.slides.length - this.options.slidesPerView; this.maxTranslate = 0, this.minTranslate = -t * s } } } getSlideSize() { if ("auto" === this.options.slidesPerView) return this.slides && 0 !== this.slides.length ? "horizontal" === this.options.direction ? this.slides[0].offsetWidth : this.slides[0].offsetHeight : 0; return (("horizontal" === this.options.direction ? this.container.offsetWidth : this.container.offsetHeight) - this.options.spaceBetween * (Math.min(this.options.slidesPerView, this.slides.length) - 1)) / this.options.slidesPerView } restorePosition(t = !1) { if (t && (this.wrapper.style.transition = `transform ${this.options.speed / 1e3}s cubic-bezier(0.25, 0.46, 0.45, 0.94)`), "horizontal" === this.options.direction ? this.wrapper.style.transform = `translate3d(${this.touchStartTranslate}px, 0, 0)` : this.wrapper.style.transform = `translate3d(0, ${this.touchStartTranslate}px, 0)`, !this.options.loop && !this.options.centeredSlides) { const t = "horizontal" === this.options.direction ? this.container.offsetWidth : this.container.offsetHeight; if ("auto" === this.options.slidesPerView) { const t = this.slides.map(t => t.getBoundingClientRect()); let e = Math.abs(this.touchStartTranslate), s = 0, i = 0; for (let n = 0; n < this.slides.length; n++) { const a = "horizontal" === this.options.direction ? t[n].width : t[n].height; if (s + a / 2 > e) { i = n; break } s += a + this.options.spaceBetween } this.activeSlideIndex = i } else { const e = (t - this.options.spaceBetween * (Math.min(this.options.slidesPerView, this.slides.length) - 1)) / this.options.slidesPerView + this.options.spaceBetween, s = Math.abs(this.touchStartTranslate), i = Math.round(s / e); this.activeSlideIndex = Math.min(i, this.slides.length - 1) } this.slides.forEach((t, e) => { t && t.classList && t.classList.toggle("zhenshangyin-slide-active", e === this.activeSlideIndex) }), this.updatePaginationState(), this.updateNavigationState() } } onTouchStart(t) { this.options.on.touchStart && this.options.on.touchStart(this, t, { touchStartX: this.touchStartX, touchStartY: this.touchStartY, touchStartTranslate: this.touchStartTranslate }) } onTouchMove(t) { this.options.on.touchMove && this.options.on.touchMove(this, t, { touchStartX: this.touchStartX, touchStartY: this.touchStartY, touchMoveX: this.touchMoveX, touchMoveY: this.touchMoveY, touchDiffX: this.touchDiffX, touchDiffY: this.touchDiffY, currentTranslate: this.currentTranslate, touchStartTranslate: this.touchStartTranslate }) } onTouchEnd(t) { this.options.on.touchEnd && this.options.on.touchEnd(this, t, { velocity: this.velocity, touchStartTranslate: this.touchStartTranslate, currentTranslate: this.currentTranslate, swipeDirection: this.swipeDirection }) } initClickToSlide() { this.slides && this.slides.length && this.slides.forEach((t, e) => { t && t.addEventListener("click", t => { if (t.stopPropagation(), this.isAnimating) return void t.preventDefault(); const s = t.target; if ("A" === s.tagName || "BUTTON" === s.tagName || s.closest("a") || s.closest("button") || s.closest(".zhenshangyin-navigation") || s.closest(".zhenshangyin-pagination")) return; let i; if (this.options.loop && this.slides.length) { const t = this.slides.length / 3; let s = e % t - this.currentIndex % t; Math.abs(s) > t / 2 && (s = s > 0 ? s - t : s + t), i = this.currentIndex + s, i < 0 ? i += t : i >= this.slides.length && (i -= t) } else i = Math.min(e, this.slides.length - 1); i !== this.currentIndex && this.slideTo(i) }) }) } on(t, e) { this.options.on || (this.options.on = {}), this.options.on[t] = e } off(t) { this.options.on && this.options.on[t] && delete this.options.on[t] } isTransformsEnabled() { return this.options && this.options.transforms && (this.options.transforms.scale?.enabled || this.options.transforms.translate?.enabled || this.options.transforms.rotate?.enabled || this.options.transforms.skew?.enabled || this.options.transforms.opacity?.enabled || this.options.transforms.filter?.enabled) } initTransformEffects() { const { transforms: t } = this.options; t.perspective.enabled && t.perspective.value && (this.container.style.perspective = `${t.perspective.value}px`), this.slides.forEach((e, s) => { t.backfaceVisibility && t.backfaceVisibility.enabled && (e.style.backfaceVisibility = t.backfaceVisibility.value), this.applyTransforms(e, s) }); const e = this.slideTo; this.slideTo = (t, s = !1, i = !1) => { this.slides.forEach((t, e) => { t.style.transition = s ? "none" : `all ${this.options.speed}ms ease` }), e.call(this, t, s, i), this.updateTransforms() }, this.on("transitionStart", () => { this.updateTransforms() }), this.on("transitionEnd", () => { setTimeout(() => { this.updateTransforms() }, 10) }), this.on("slideChange", () => { this.updateTransforms() }); const s = this.updateSlides; this.updateSlides = function () { const t = "none" === this.wrapper.style.transition; t && this.options.loop && this.slides.forEach(t => { t.style.transition = "none" }), s.call(this), t && this.options.loop && (this.updateTransforms(), this.wrapper.offsetHeight, setTimeout(() => { this.slides.forEach(t => { t.style.transition = `all ${this.options.speed}ms ease` }) }, 0)) }, "auto" === this.options.slidesPerView && this.options.centeredSlides && this.fixCenteredAutoSlides(), this.forceCenter(), setTimeout(() => { this.initializeAnimations() }, 100) } updateTransformsDuringTouch(t) { const { touchStartTranslate: e, currentTranslate: s } = t, i = s - e; let n = this.getSlideSize() + this.options.spaceBetween; n <= 0 && (n = 1); const a = i / n, o = this._transformTouchData.touchStartIndex - a; if (this.slides.forEach((t, e) => { this.applyTransformsWithFractionalIndex(t, e, o) }), "auto" === this.options.slidesPerView && this.options.centeredSlides) { const t = this.container.offsetWidth, e = Math.max(0, Math.min(this.slides.length - 1, Math.floor(o))), s = Math.max(0, Math.min(this.slides.length - 1, Math.ceil(o))), i = o - e, n = this.slides[e], a = this.slides[s]; if (!n || !a) return; const r = parseFloat(window.getComputedStyle(n).width), h = r + (parseFloat(window.getComputedStyle(a).width) - r) * i, l = n.offsetLeft, c = t / 2 - (l + (a.offsetLeft - l) * i) - h / 2; this.wrapper.style.transition = "none", this.wrapper.style.transform = `translateX(${c}px)` } } scaleAt(t) { const { transforms: e } = this.options || {}; if (e && e.scale && e.scale.enabled) { const s = Math.max(0, t), i = e.scale || {}, n = "number" == typeof i.step ? i.step : 0; return Math.max(0, 1 - n * s) } return 1 } stepValue(t, e) { return t * Math.max(0, e) } computeUniformSpacingOffset(t, e) { const s = (this.options && this.options.transforms ? this.options.transforms : {}).uniformSpacing || {}, i = "number" == typeof s.gap ? s.gap : 0, n = s.customSpacing, a = this.getSlideSize ? this.getSlideSize() : 0, o = a + (this.options && this.options.spaceBetween ? this.options.spaceBetween : 0); if (n && Array.isArray(n) && n.length > 0) { const s = Math.floor(t); let i = 0; for (let t = 0; t < s; t++) { i += .5 * a * (this.scaleAt(t) + this.scaleAt(t + 1)) + (t < n.length ? n[t] : n[n.length - 1]) - o } const r = t - s; if (r > 0) { i += (.5 * a * (this.scaleAt(s) + this.scaleAt(s + 1)) + (s < n.length ? n[s] : n[n.length - 1]) - o) * r } return i * Math.sign(e || 0) } const r = Math.floor(t); let h = 0; for (let t = 0; t < r; t++) { h += .5 * a * (this.scaleAt(t) + this.scaleAt(t + 1)) + i - o } const l = t - r; if (l > 0) { h += (.5 * a * (this.scaleAt(r) + this.scaleAt(r + 1)) + i - o) * l } return h * Math.sign(e || 0) } applyTransformsWithFractionalIndex(t, e, s) { const { transforms: i } = this.options; let n, a; a = e - s, n = Math.abs(a); let o = "", r = "", h = 0, l = 0, c = 0; if (i.uniformSpacing && i.uniformSpacing.enabled && (h += this.computeUniformSpacingOffset(n, a)), i.translate.enabled && (h += this.stepValue(i.translate.x, n), l += this.stepValue(i.translate.y, n), c += this.stepValue(i.translate.z, n)), i.scale && i.scale.enabled) { c += Math.max(0, 20 - 5 * n) } if (0 === h && 0 === l && 0 === c || (o += ` translate3d(${h}px, ${l}px, ${c}px)`), i.scale.enabled) { o += ` scale(${this.scaleAt(n)})` } if (i.rotate.enabled) { o += ` rotateX(${this.stepValue(i.rotate.x, n)}deg) rotateY(${this.stepValue(i.rotate.y, n) * -Math.sign(a)}deg) rotateZ(${this.stepValue(i.rotate.z, n) * Math.sign(a)}deg)` } if (i.skew.enabled) { o += ` skew(${this.stepValue(i.skew.x, n) * Math.sign(a)}deg, ${this.stepValue(i.skew.y, n) * Math.sign(a)}deg)` } if (i.opacity.enabled) { const e = i.opacity || {}, s = "number" == typeof e.step ? e.step : 0, a = Math.max(0, Math.min(1, 1 - s * n)); t.style.opacity = a } if (i.filter.enabled) { const t = i.filter || {}; r = `blur(${(t.blur || 0) * n}px) brightness(${100 + (t.brightness || 0) * n}%) contrast(${100 + (t.contrast || 0) * n}%) grayscale(${Math.max(0, Math.min(100, (t.grayscale || 0) * n))}%) hue-rotate(${(t.hueRotate || 0) * n}deg) invert(${Math.max(0, Math.min(100, (t.invert || 0) * n))}%) saturate(${100 + (t.saturate || 0) * n}%) sepia(${Math.max(0, Math.min(100, (t.sepia || 0) * n))}%)` } const d = t.style.transition; t.style.transition = "none", t.style.transform = o, r && (t.style.filter = r), t.style.zIndex = 0 === n ? "10" : Math.max(1, 10 - n), t.classList && t.classList.toggle("zhenshangyin-slide-active", n < .5), t.offsetHeight, t.style.transition = d } applyTransforms(t, e) { const { transforms: s } = this.options; let i, n; n = e - this.currentIndex, i = Math.abs(n); let a = "", o = "", r = 0, h = 0, l = 0; if (s.uniformSpacing && s.uniformSpacing.enabled && (r += this.computeUniformSpacingOffset(Math.abs(n), n)), s.translate.enabled && (r += this.stepValue(s.translate.x, i), h += this.stepValue(s.translate.y, i), l += this.stepValue(s.translate.z, i)), s.scale && s.scale.enabled) { l += Math.max(0, 20 - 5 * i) } if (0 === r && 0 === h && 0 === l || (a += ` translate3d(${r}px, ${h}px, ${l}px)`), s.scale.enabled) { a += ` scale(${this.scaleAt(i)})` } if (s.rotate.enabled) { a += ` rotateX(${this.stepValue(s.rotate.x, i)}deg) rotateY(${this.stepValue(s.rotate.y, i) * -Math.sign(n)}deg) rotateZ(${this.stepValue(s.rotate.z, i) * Math.sign(n)}deg)` } if (s.skew.enabled) { a += ` skew(${this.stepValue(s.skew.x, i) * Math.sign(n)}deg, ${this.stepValue(s.skew.y, i) * Math.sign(n)}deg)` } if (s.opacity.enabled) { const e = s.opacity || {}, n = "number" == typeof e.step ? e.step : 0, a = Math.max(0, Math.min(1, 1 - n * i)); t.style.opacity = a } if (s.filter.enabled) { const t = s.filter || {}; o = `blur(${(t.blur || 0) * i}px) brightness(${100 + (t.brightness || 0) * i}%) contrast(${100 + (t.contrast || 0) * i}%) grayscale(${Math.max(0, Math.min(100, (t.grayscale || 0) * i))}%) hue-rotate(${(t.hueRotate || 0) * i}deg) invert(${Math.max(0, Math.min(100, (t.invert || 0) * i))}%) saturate(${100 + (t.saturate || 0) * i}%) sepia(${Math.max(0, Math.min(100, (t.sepia || 0) * i))}%)` } t.style.transform = a, o && (t.style.filter = o), t.style.zIndex = 0 === i ? "10" : Math.max(1, 10 - i) } updateTransforms() { this.slides && this.slides.forEach((t, e) => { this.applyTransforms(t, e) }) } fixCenteredAutoSlides() { if (!this.container || !this.wrapper) return; const t = this.container.offsetWidth, e = this.getSlideSize(), s = this.options.spaceBetween || 0; let i; if (i = "number" == typeof this.options.slidesPerView ? this.options.slidesPerView : Math.floor((t + s) / (e + s)), i > 1) { const n = (t - (e * i + s * (i - 1))) / 2; n > 0 ? (this.wrapper.style.paddingLeft = `${n}px`, this.wrapper.style.paddingRight = `${n}px`) : (this.wrapper.style.paddingLeft = "0px", this.wrapper.style.paddingRight = "0px") } } forceCenter() { if (this.container && this.options.centeredSlides) { this.container.classList.add("zhenshangyin-centered"); const t = this.updateSlides; this.updateSlides = () => { t.call(this); const e = this.slides[this.currentIndex]; if (!e) return; const s = this.container.offsetWidth, i = this.getSlideSize(), n = this.options.spaceBetween || 0; let a = 0; for (let t = 0; t < this.currentIndex; t++) { const e = this.slides[t]; if (!e) continue; a += ("auto" === this.options.slidesPerView ? parseFloat(window.getComputedStyle(e).width) : i) + n } const o = s / 2 - a - ("auto" === this.options.slidesPerView ? parseFloat(window.getComputedStyle(e).width) : i) / 2, r = "none" === this.wrapper.style.transition; !this.initialized || r ? this.wrapper.style.transform = `translateX(${o}px)` : requestAnimationFrame(() => { this.wrapper.style.transform = `translateX(${o}px)` }) }, this.updateSlides() } } initializeAnimations() { this.slides.forEach(t => { t.style.transition = "none" }), this.wrapper.style.transition = "none", this.wrapper.offsetHeight, this.updateTransforms(), this.forceCenter(), setTimeout(() => { this.slides.forEach(t => { t.style.transition = `all ${this.options.speed}ms ease` }), this.wrapper.style.transition = `transform ${this.options.speed}ms ease`, this.initialized = !0 }, 50), this.resizeHandler = () => { this.updateTransforms(), this.forceCenter() }, window.addEventListener("resize", this.resizeHandler) } checkBreakpoint() { const t = this.options.breakpoints, e = window.innerWidth, s = Object.keys(t).map(t => parseInt(t)).map(t => parseInt(t)).sort((t, e) => e - t); let i = null; for (const t of s) e <= t && (i = t); i !== this.currentBreakpoint && (this.currentBreakpoint = i, this.options = { ...this.originalOptions }, i && t[i] ? (this.options = { ...this.options, ...t[i] }, t[i].transforms ? this.options.transforms = { ...this.originalTransforms, ...t[i].transforms } : this.options.transforms = { ...this.originalTransforms }) : this.options.transforms = { ...this.originalTransforms }, this.updateLayout(), this.updateTransforms()) } restoreAllowClickAfterTouch() { const t = () => { this.isTouched || this.isMoved || this.isAnimating ? requestAnimationFrame(t) : this.allowClick = !0 }; requestAnimationFrame(t) } hidePaginationElements() { const t = this.options.pagination; if (!t || "object" != typeof t) return; if (t.el) { return void ("string" == typeof t.el ? document.querySelectorAll(t.el) : [t.el]).forEach(t => { t && (t.classList.add("zhenshangyin-pagination-hidden"), t.style.display = "none") }) } ["bullets", "numbers", "fraction", "progressbar", "scrollbar"].forEach(e => { const s = t[e]; if (!s || !s.el) return; ("string" == typeof s.el ? document.querySelectorAll(s.el) : [s.el]).forEach(t => { t && (t.classList.add("zhenshangyin-pagination-hidden"), t.style.display = "none") }) }) } hideNavigationButtons() { const { prevEl: t, nextEl: e } = this.options.navigation; if (t) { ("string" == typeof t ? document.querySelectorAll(t) : [t]).forEach(t => { t && (t.classList.add("zhenshangyin-navigation-hidden"), t.style.display = "none") }) } if (e) { ("string" == typeof e ? document.querySelectorAll(e) : [e]).forEach(t => { t && (t.classList.add("zhenshangyin-navigation-hidden"), t.style.display = "none") }) } } } class ZhenshangyinDatePicker { constructor(t, e = {}) { if (Array.isArray(t)) { if (this.startInput = document.querySelector(t[0]), this.endInput = document.querySelector(t[1]), !this.startInput || !this.endInput) return; this.isSeparate = !0 } else { if (this.dateInput = document.querySelector(t), !this.dateInput) return; this.isSeparate = !1 } this.type = e.type || "date", this.dateFormat = this.getDefaultFormat(e.dateFormat), this.language = e.language || "zh", this.separator = e.separator || (this.isRangeType() ? " - " : ", "), this.onSelect = e.onSelect || function () { }, this.multiSelect = e.multiSelect || !1, this.dateDelimiter = e.dateDelimiter || ",", void 0 === e.separator && (this.separator = this.isRangeType() ? " - " : this.separator), this.showTime = this.dateFormat.includes("HH") || this.dateFormat.includes("mm") || this.dateFormat.includes("ss"), this.showHours = this.dateFormat.includes("HH"), this.showMinutes = this.dateFormat.includes("mm"), this.showSeconds = this.dateFormat.includes("ss"), this.availableHours = e.availableHours || Array.from({ length: 24 }, (t, e) => e), this.availableMinutes = e.availableMinutes || Array.from({ length: 60 }, (t, e) => e), this.availableSeconds = e.availableSeconds || Array.from({ length: 60 }, (t, e) => e), this.disabledItems = new Set(e.disabledItems || []), this.disabledRanges = (e.disabledRanges || []).map(t => ({ start: t.start, end: t.end })), this.disabledWeekdays = e.disabledWeekdays || [], this.initializeState(), this.parseInputValues(), this.styleElement = null, this.uniqueClassName = `zhenshangyin-unified-${this.type}-${Math.random().toString(36).substring(2, 15)}`, this._onWindowScroll = null, this._onWindowResize = null, this._onDocClickDropdown = null, this._onDocClickDropdownStart = null, this._onDocClickDropdownEnd = null, this._onDocumentClickClose = null, this._onDocumentFocusinClose = null, this._onInputClickHandler = null, this.init() } getDefaultFormat(t) { if (t) return t; return { date: "YYYY-MM-DD", dateRange: "YYYY-MM-DD", week: "YYYY-MM-DD", month: "YYYY-MM", monthRange: "YYYY-MM", year: "YYYY", yearRange: "YYYY", time: "HH:mm:ss", timeRange: "HH:mm:ss" }[this.type] || "YYYY-MM-DD" } isRangeType() { return ["dateRange", "monthRange", "yearRange", "timeRange"].includes(this.type) } initializeState() { const t = new Date; this.currentYear = t.getFullYear(), this.currentMonth = t.getMonth(), this.selectedDate = null, this.selectedDates = new Set, this.isRangeType() && (this.startDate = null, this.endDate = null, this.startMonth = null, this.endMonth = null, this.startYear = null, this.endYear = null, this.isSelectingStart = !0, "dateRange" === this.type ? (this.startYear = this.currentYear, this.startMonth = this.currentMonth, this.endYear = this.currentYear, this.endMonth = this.currentMonth + 1, this.endMonth > 11 && (this.endMonth = 0, this.endYear++)) : "monthRange" === this.type ? this.endYear = this.currentYear + 1 : "yearRange" === this.type && (this.startPanelYear = this.currentYear, this.endPanelYear = this.currentYear + 10)), this.selectedWeek = null, this.lastSelectedMonth = null, this.lastSelectedYear = null, this.selectedYears = [], this.selectedMonths = [], this.selectedTime = { hours: this.availableHours[0] || 0, minutes: this.availableMinutes[0] || 0, seconds: this.availableSeconds[0] || 0 }, (this.isRangeType() || "time" === this.type || "timeRange" === this.type) && (this.startTime = { hours: 0, minutes: 0, seconds: 0 }, this.endTime = { hours: 0, minutes: 0, seconds: 0 }) } parseInputValues() { if (this.isSeparate && this.isRangeType()) { const t = (this.startInput?.value || "").trim(), e = (this.endInput?.value || "").trim(); "dateRange" === this.type ? (t && (this.startDate = this.parseDateFromString(t), this.startDate && (this.startYear = this.startDate.getFullYear(), this.startMonth = this.startDate.getMonth())), e && (this.endDate = this.parseDateFromString(e), this.endDate && (this.endYear = this.endDate.getFullYear(), this.endMonth = this.endDate.getMonth())), this.startDate && this.endDate && this.startYear === this.endYear && this.startMonth === this.endMonth ? (this.endMonth = this.startMonth + 1, this.endMonth > 11 && (this.endMonth = 0, this.endYear = this.startYear + 1)) : this.startDate && !this.endDate && (this.endYear = this.startYear, this.endMonth = this.startMonth + 1, this.endMonth > 11 && (this.endMonth = 0, this.endYear = this.startYear + 1))) : "monthRange" === this.type ? (t && (this.startMonth = this.parseMonthFromString(t), this.startMonth && (this.startYear = this.startMonth.getFullYear())), e && (this.endMonth = this.parseMonthFromString(e), this.endMonth && (this.endYear = this.endMonth.getFullYear()))) : "yearRange" === this.type && (t && (this.startYear = parseInt(t, 10)), e && (this.endYear = parseInt(e, 10))), this.isSelectingStart = !this.startDate && !this.startMonth && !this.startYear } else if (this.dateInput) { const t = (this.dateInput.value || "").trim(); if (!t) return; if (this.isRangeType()) { const e = t.split(this.separator); if (e.length >= 2) { const t = e[0].trim(), s = e[1].trim(); t && (this.startDate = this.parseDateFromString(t), this.startDate && (this.startYear = this.startDate.getFullYear(), this.startMonth = this.startDate.getMonth())), s && (this.endDate = this.parseDateFromString(s), this.endDate && (this.endYear = this.endDate.getFullYear(), this.endMonth = this.endDate.getMonth())), this.startDate && this.endDate && this.startYear === this.endYear && this.startMonth === this.endMonth ? (this.endMonth = this.startMonth + 1, this.endMonth > 11 && (this.endMonth = 0, this.endYear = this.startYear + 1)) : this.startDate && !this.endDate && (this.endYear = this.startYear, this.endMonth = this.startMonth + 1, this.endMonth > 11 && (this.endMonth = 0, this.endYear = this.startYear + 1)), this.startDate && this.endDate ? this.isSelectingStart = !0 : this.startDate && (this.isSelectingStart = !1) } } else if ("date" === this.type) this.selectedDate = this.parseDateFromString(t), this.selectedDate && (this.currentYear = this.selectedDate.getFullYear(), this.currentMonth = this.selectedDate.getMonth()); else if ("week" === this.type) { const e = t.split(this.separator); if (e.length >= 2) { const t = this.parseDateFromString(e[0].trim()), s = this.parseDateFromString(e[1].trim()); t && s && (this.selectedWeek = { start: t, end: s }, this.currentYear = t.getFullYear(), this.currentMonth = t.getMonth()) } } else if ("month" === this.type) if (this.multiSelect) { const e = t.split(this.dateDelimiter); this.selectedMonths = e.map(t => { const e = this.parseDateFromString(t.trim()); return e ? { year: e.getFullYear(), month: e.getMonth() + 1 } : null }).filter(Boolean) } else { const e = this.parseDateFromString(t); e && (this.selectedMonths = [{ year: e.getFullYear(), month: e.getMonth() + 1 }], this.currentYear = e.getFullYear()) } else if ("year" === this.type) if (this.multiSelect) this.selectedYears = t.split(this.dateDelimiter).map(t => parseInt(t.trim(), 10)).filter(t => !isNaN(t)); else { const e = parseInt(t, 10); isNaN(e) || (this.selectedYears = [e], this.currentYear = e) } else "time" !== this.type && "timeRange" !== this.type || this.parseTimeInputValue() } } parseDateFromString(t) { if (!t) return null; const e = [/^(\d{4})-(\d{1,2})-(\d{1,2})(?:\s+(\d{1,2}):(\d{1,2}):(\d{1,2}))?$/, /^(\d{1,2})\/(\d{1,2})\/(\d{4})(?:\s+(\d{1,2}):(\d{1,2}):(\d{1,2}))?$/, /^(\d{4})\/(\d{1,2})\/(\d{1,2})(?:\s+(\d{1,2}):(\d{1,2}):(\d{1,2}))?$/]; for (const s of e) { const e = t.match(s); if (e) { const t = parseInt(e[1], 10), s = parseInt(e[2], 10) - 1, i = parseInt(e[3], 10), n = e[4] ? parseInt(e[4], 10) : 0, a = e[5] ? parseInt(e[5], 10) : 0, o = e[6] ? parseInt(e[6], 10) : 0, r = new Date(t, s, i, n, a, o); if (!isNaN(r.getTime())) return r } } const s = new Date(t); return isNaN(s.getTime()) ? null : s } parseMonthFromString(t) { if (!t) return null; const e = t.match(/^(\d{4})-(\d{1,2})$/); if (e) { const t = parseInt(e[1], 10), s = parseInt(e[2], 10) - 1, i = new Date(t, s, 1); if (!isNaN(i.getTime())) return i } return null } init() { this._onInputClickHandler = t => { t.stopPropagation(), this.isSeparate && (this.isSelectingStart = t.currentTarget === this.startInput), this.createPicker(), this.togglePicker(), this.applyInitialStyles() }, this.isSeparate ? (this.startInput.addEventListener("click", this._onInputClickHandler), this.endInput.addEventListener("click", this._onInputClickHandler)) : this.dateInput.addEventListener("click", this._onInputClickHandler), this._onDocumentClickClose = () => { this.closePicker() }, this._onDocumentFocusinClose = t => { const e = t.target, s = this.isSeparate ? e === this.startInput || e === this.endInput : e === this.dateInput, i = this.picker && this.picker.contains(e); s || i || this.closePicker() }, document.addEventListener("click", this._onDocumentClickClose), document.addEventListener("focusin", this._onDocumentFocusinClose) } createPicker() { if (this.picker) return; this.parseInputValues(); const t = document.createElement("div"); t.className = this.getPickerClassName(), t.innerHTML = this.getPickerHTML(), document.body.appendChild(t), this.picker = t, t.addEventListener("click", t => { t.stopPropagation() }), this.setupPickerEvents() } getPickerClassName() { let t = `zhenshangyin-custom-calendar ${this.uniqueClassName}`; return this.isRangeType() && "timeRange" !== this.type && (t += " zhenshangyin-date-range-calendar", "yearRange" !== this.type && "monthRange" !== this.type || (t += " zhenshangyin-date-range-yearrange")), t } getPickerHTML() { const t = { date: () => this.createDatePickerHTML(), dateRange: () => this.createDateRangePickerHTML(), week: () => this.createWeekPickerHTML(), month: () => this.createMonthPickerHTML(), monthRange: () => this.createMonthRangePickerHTML(), year: () => this.createYearPickerHTML(), yearRange: () => this.createYearRangePickerHTML(), time: () => this.createStandaloneTimePickerHTML(), timeRange: () => this.createStandaloneTimePickerHTML() }; return (t[this.type] || t.date)() } createDatePickerHTML() { const t = this.getWeekdayNames(); let e = `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-year">${this.getNavigationIcon("prev-double")}</button>\n                <button class="zhenshangyin-prev-month">${this.getNavigationIcon("prev")}</button>\n                <span class="zhenshangyin-current-display">${this.currentYear}${"en" === this.language ? " Year " : "å¹´ "}${this.currentMonth + 1}${"en" === this.language ? " Month" : "æœˆ"}</span>\n                <button class="zhenshangyin-next-month">${this.getNavigationIcon("next")}</button>\n                <button class="zhenshangyin-next-year">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><thead><tr>${t.map(t => `<th>${t}</th>`).join("")}</tr></thead><tbody id="calendar-body"></tbody></table>\n            </div>\n        `; return this.showTime ? e += this.createTimePickerHTML() : this.multiSelect && (e += `\n            <div class="zhenshangyin-button-container">\n                <button class="zhenshangyin-confirm-btn">${"en" === this.language ? "Confirm" : "ç¡®è®¤"}</button>\n            </div>`), e } createDateRangePickerHTML() { return `\n            <div class="zhenshangyin-date-range-container">\n                <div class="zhenshangyin-date-picker-wrapper">${this.createSingleDatePickerHTML("start")}</div>\n                <div class="zhenshangyin-date-picker-wrapper">${this.createSingleDatePickerHTML("end")}</div>\n            </div>\n            ${this.showTime ? `\n            <div class="zhenshangyin-button-container">\n                <button class="zhenshangyin-confirm-btn">${"en" === this.language ? "Confirm" : "ç¡®è®¤"}</button>\n            </div>` : ""}\n        ` } createSingleDatePickerHTML(t) { const e = this.getWeekdayNames(), s = "start" === t ? this.startYear : this.endYear, i = "start" === t ? this.startMonth : this.endMonth; let n = `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-year" data-type="${t}">${this.getNavigationIcon("prev-double")}</button>\n                <button class="zhenshangyin-prev-month" data-type="${t}">${this.getNavigationIcon("prev")}</button>\n                <span class="zhenshangyin-current-display" data-type="${t}">${s}${"en" === this.language ? " Year " : "å¹´ "}${i + 1}${"en" === this.language ? " Month" : "æœˆ"}</span>\n                <button class="zhenshangyin-next-month" data-type="${t}">${this.getNavigationIcon("next")}</button>\n                <button class="zhenshangyin-next-year" data-type="${t}">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><thead><tr>${e.map(t => `<th>${t}</th>`).join("")}</tr></thead><tbody id="${t}-calendar-body"></tbody></table>\n            </div>\n        `; return this.showTime && (n += this.createRangeTimePickerHTML(t)), n } createWeekPickerHTML() { const t = this.getWeekdayNames(); return `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-year">${this.getNavigationIcon("prev-double")}</button>\n                <button class="zhenshangyin-prev-month">${this.getNavigationIcon("prev")}</button>\n                <span class="zhenshangyin-current-display">${this.currentYear}${"en" === this.language ? " Year " : "å¹´ "}${this.currentMonth + 1}${"en" === this.language ? " Month" : "æœˆ"}</span>\n                <button class="zhenshangyin-next-month">${this.getNavigationIcon("next")}</button>\n                <button class="zhenshangyin-next-year">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><thead><tr>${t.map(t => `<th>${t}</th>`).join("")}</tr></thead><tbody id="week-calendar-body"></tbody></table>\n            </div>\n        ` } createMonthPickerHTML() { const t = this.getMonthNames(); return `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-year">${this.getNavigationIcon("prev-double")}</button>\n                <span class="zhenshangyin-current-display">${this.currentYear}</span>\n                <button class="zhenshangyin-next-year">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><tbody id="month-picker-body">\n                    <tr><td>${t[0]}</td><td>${t[1]}</td><td>${t[2]}</td></tr>\n                    <tr><td>${t[3]}</td><td>${t[4]}</td><td>${t[5]}</td></tr>\n                    <tr><td>${t[6]}</td><td>${t[7]}</td><td>${t[8]}</td></tr>\n                    <tr><td>${t[9]}</td><td>${t[10]}</td><td>${t[11]}</td></tr>\n                </tbody></table>\n            </div>\n            ${this.multiSelect ? `\n            <div class="zhenshangyin-button-container">\n                <button class="zhenshangyin-confirm-btn">${"en" === this.language ? "Confirm" : "ç¡®è®¤"}</button>\n            </div>` : ""}\n        ` } createMonthRangePickerHTML() { return `\n            <div class="zhenshangyin-date-range-container">\n                <div class="zhenshangyin-month-picker-wrapper">${this.createSingleMonthPickerHTML("start")}</div>\n                <div class="zhenshangyin-month-picker-wrapper">${this.createSingleMonthPickerHTML("end")}</div>\n            </div>\n        ` } createSingleMonthPickerHTML(t) { const e = this.getMonthNames(), s = "start" === t ? this.currentYear : this.endYear; return `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-year" data-type="${t}">${this.getNavigationIcon("prev-double")}</button>\n                <span class="zhenshangyin-current-display" data-type="${t}">${s}</span>\n                <button class="zhenshangyin-next-year" data-type="${t}">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><tbody id="${t}-month-picker-body">\n                    <tr><td>${e[0]}</td><td>${e[1]}</td><td>${e[2]}</td></tr>\n                    <tr><td>${e[3]}</td><td>${e[4]}</td><td>${e[5]}</td></tr>\n                    <tr><td>${e[6]}</td><td>${e[7]}</td><td>${e[8]}</td></tr>\n                    <tr><td>${e[9]}</td><td>${e[10]}</td><td>${e[11]}</td></tr>\n                </tbody></table>\n            </div>\n        ` } createYearPickerHTML() { return `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-decade">${this.getNavigationIcon("prev-double")}</button>\n                <span class="zhenshangyin-current-display">${this.getDecadeRange()}</span>\n                <button class="zhenshangyin-next-decade">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><tbody id="year-picker-body"></tbody></table>\n            </div>\n            ${this.multiSelect ? `\n            <div class="zhenshangyin-button-container">\n                <button class="zhenshangyin-confirm-btn">${"en" === this.language ? "Confirm" : "ç¡®è®¤"}</button>\n            </div>` : ""}\n        ` } createYearRangePickerHTML() { return `\n            <div class="zhenshangyin-date-range-container">\n                <div class="zhenshangyin-year-picker-wrapper">${this.createSingleYearPickerHTML("start")}</div>\n                <div class="zhenshangyin-year-picker-wrapper">${this.createSingleYearPickerHTML("end")}</div>\n            </div>\n        ` } createSingleYearPickerHTML(t) { return `\n            <div class="zhenshangyin-custom-navigation">\n                <button class="zhenshangyin-prev-decade" data-type="${t}">${this.getNavigationIcon("prev-double")}</button>\n                <span class="zhenshangyin-current-display" data-type="${t}">${this.getDecadeRange(t)}</span>\n                <button class="zhenshangyin-next-decade" data-type="${t}">${this.getNavigationIcon("next-double")}</button>\n            </div>\n            <div class="zhenshangyin-table-container">\n                <table><tbody id="${t}-year-picker-body"></tbody></table>\n            </div>\n        ` } createTimePickerHTML(t = "") { const e = "zh" === this.language ? "æ—¶é—´" : "Time", s = "zh" === this.language ? "ç¡®è®¤" : "Confirm", i = "zh" === this.language ? "æ­¤åˆ»" : "Now", n = []; return this.showHours && n.push(`\n                <div class="zhenshangyin-time-scroll" id="hours-scroll">\n                    ${this.createPlaceholder()}\n                    ${this.availableHours.map((t, e) => `<div class="zhenshangyin-scroll-item${0 === e ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join("")}\n                    ${this.createPlaceholder()}\n                </div>\n            `), this.showMinutes && n.push(`\n                <div class="zhenshangyin-time-scroll" id="minutes-scroll">\n                    ${this.createPlaceholder()}\n                    ${this.availableMinutes.map((t, e) => `<div class="zhenshangyin-scroll-item${0 === e ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join("")}\n                    ${this.createPlaceholder()}\n                </div>\n            `), this.showSeconds && n.push(`\n                <div class="zhenshangyin-time-scroll" id="seconds-scroll">\n                    ${this.createPlaceholder()}\n                    ${this.availableSeconds.map((t, e) => `<div class="zhenshangyin-scroll-item${0 === e ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join("")}\n                    ${this.createPlaceholder()}\n                </div>\n            `), `\n            <div class="zhenshangyin-time-picker">\n                <div class="zhenshangyin-current-tame">${e}</div>\n                <div class="zhenshangyin-time-dropdown" id="zhenshangyin-time-dropdown">\n                    <div class="zhenshangyin-dropdown-label">${this.formatTime()}</div>\n                    <div class="zhenshangyin-scroll-container" style="display: none;">\n                        <div class="zhenshangyin-scroll-scroll">\n                            ${n.join("")}\n                        </div>\n                        <button class="zhenshangyin-confirm-confirm">${s}</button>\n                    </div>\n                </div>\n                <button class="zhenshangyin-current-time-btn">${i}</button>\n                <button class="zhenshangyin-confirm-btn">${s}</button>\n            </div>\n            ` } createRangeTimePickerHTML(t) { const e = "start" === t ? this.startTime : this.endTime, s = `${t}-zhenshangyin-time-dropdown`, i = `${t}-hours-scroll`, n = `${t}-minutes-scroll`, a = `${t}-seconds-scroll`; return `\n            <div class="zhenshangyin-time-picker">\n                <div class="zhenshangyin-date-label" data-type="${t}">${this.formatDateOnlyForRange(t)}</div>\n                <div class="zhenshangyin-time-dropdown" id="${s}">\n                    <div class="zhenshangyin-dropdown-label">${this.formatTime(e)}</div>\n                    <div class="zhenshangyin-scroll-container" style="display: none;">\n                        <div class="zhenshangyin-scroll-scroll">\n                            ${this.showHours ? `\n                            <div class="zhenshangyin-time-scroll" id="${i}">\n                                ${this.createPlaceholder()}\n                                ${this.availableHours.map(t => `<div class="zhenshangyin-scroll-item${t === e.hours ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join("")}\n                                ${this.createPlaceholder()}\n                            </div>` : ""}\n                            ${this.showMinutes ? `\n                            <div class="zhenshangyin-time-scroll" id="${n}">\n                                ${this.createPlaceholder()}\n                                ${this.availableMinutes.map(t => `<div class="zhenshangyin-scroll-item${t === e.minutes ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join("")}\n                                ${this.createPlaceholder()}\n                            </div>` : ""}\n                            ${this.showSeconds ? `\n                            <div class="zhenshangyin-time-scroll" id="${a}">\n                                ${this.createPlaceholder()}\n                                ${this.availableSeconds.map(t => `<div class="zhenshangyin-scroll-item${t === e.seconds ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join("")}\n                                ${this.createPlaceholder()}\n                            </div>` : ""}\n                        </div>\n                        <button class="zhenshangyin-confirm-confirm">${"en" === this.language ? "Confirm" : "ç¡®è®¤"}</button>\n                    </div>\n                </div>\n            </div>\n        ` } createPlaceholder() { return Array.from({ length: 2 }, () => '<div class="zhenshangyin-scroll-item placeholder"></div>').join("") } getNavigationIcon(t) { const e = { "prev-double": '<svg viewBox="0 0 1024 1024"><path d="M129.6 527.5L521 918.9c9.4 9.4 24.6 9.4 33.9 0 9.4-9.4 9.4-24.6 0-33.9L180.5 510.5 552 139c9.4-9.4 9.4-24.6 0-33.9-4.7-4.7-10.8-7-17-7s-12.3 2.3-17 7L129.6 493.6c-9.4 9.3-9.4 24.5 0 33.9z" fill="#AAAAAA"/><path d="M464 510.5c0 6.4 2.5 12.5 7 17l391.4 391.4c9.4 9.4 24.6 9.4 33.9 0 9.4-9.4 9.4-24.6 0-33.9L522 510.5 893.5 139c9.4-9.4 9.4-24.6 0-33.9-4.7-4.7-10.8-7-17-7s-12.3 2.3-17 7L471.1 493.6c-4.5 4.5-7.1 10.6-7.1 16.9z" fill="#AAAAAA"/></svg>', prev: '<svg viewBox="0 0 1024 1024"><path d="M129.6 527.5L521 918.9c9.4 9.4 24.6 9.4 33.9 0 9.4-9.4 9.4-24.6 0-33.9L180.5 510.5 552 139c9.4-9.4 9.4-24.6 0-33.9-4.7-4.7-10.8-7-17-7s-12.3 2.3-17 7L129.6 493.6c-9.4 9.3-9.4 24.5 0 33.9z" fill="#AAAAAA"/></svg>', next: '<svg viewBox="0 0 1024 1024"><path d="M896.4 496.5L505 105.1c-9.4-9.4-24.6-9.4-33.9 0-9.4 9.4-9.4 24.6 0 33.9l374.4 374.4L474 885c-9.4 9.4-9.4 24.6 0 33.9 4.7 4.7 10.8 7 17 7s12.3-2.3 17-7l388.5-388.5c9.3-9.3 9.3-24.5-0.1-33.9z" fill="#AAAAAA"/></svg>', "next-double": '<svg viewBox="0 0 1024 1024"><path d="M896.4 496.5L505 105.1c-9.4-9.4-24.6-9.4-33.9 0-9.4 9.4-9.4 24.6 0 33.9l374.4 374.4L474 885c-9.4 9.4-9.4 24.6 0 33.9 4.7 4.7 10.8 7 17 7s12.3-2.3 17-7l388.5-388.5c9.3-9.3 9.3-24.5-0.1-33.9z" fill="#AAAAAA"/><path d="M561.9 513.5c0-6.4-2.5-12.5-7-17L163.5 105.1c-9.4-9.4-24.6-9.4-33.9 0-9.4 9.4-9.4 24.6 0 33.9L504 513.5 132.5 885c-9.4 9.4-9.4 24.6 0 33.9 4.7 4.7 10.8 7 17 7s12.3-2.3 17-7L555 530.4c4.4-4.5 6.9-10.6 6.9-16.9z" fill="#AAAAAA"/></svg>' }; return e[t] || e.prev } getMonthNames() { return "zh" === this.language ? ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"] : ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"] } getWeekdayNames() { return "zh" === this.language ? ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"] : ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"] } getDecadeRange(t = "") { let e = this.currentYear; "yearRange" === this.type && ("start" === t ? e = this.startPanelYear : "end" === t && (e = this.endPanelYear)); const s = 10 * Math.floor(e / 10); return `${s} - ${s + 9}` } setupPickerEvents() { switch (this.type) { case "date": this.setupDatePickerEvents(); break; case "dateRange": this.setupDateRangePickerEvents(); break; case "week": this.setupWeekPickerEvents(); break; case "month": this.setupMonthPickerEvents(); break; case "monthRange": this.setupMonthRangePickerEvents(); break; case "year": this.setupYearPickerEvents(); break; case "yearRange": this.setupYearRangePickerEvents(); break; case "time": case "timeRange": this.setupTimePickerEvents() } } setupDatePickerEvents() { if (this.picker.querySelector(".zhenshangyin-prev-year").addEventListener("click", () => this.changeYear(-1)), this.picker.querySelector(".zhenshangyin-next-year").addEventListener("click", () => this.changeYear(1)), this.picker.querySelector(".zhenshangyin-prev-month").addEventListener("click", () => this.changeMonth(-1)), this.picker.querySelector(".zhenshangyin-next-month").addEventListener("click", () => this.changeMonth(1)), this.populateCalendar(), this.showTime && this.setupTimeDropdowns(), this.multiSelect && !this.showTime) { const t = this.picker.querySelector(".zhenshangyin-confirm-btn"); t && t.addEventListener("click", () => { this.updateInputValue(), this.closePicker() }) } } setupDateRangePickerEvents() { if (["start", "end"].forEach(t => { this.picker.querySelector(`.zhenshangyin-prev-year[data-type="${t}"]`).addEventListener("click", () => this.changeYear(-1, t)), this.picker.querySelector(`.zhenshangyin-next-year[data-type="${t}"]`).addEventListener("click", () => this.changeYear(1, t)), this.picker.querySelector(`.zhenshangyin-prev-month[data-type="${t}"]`).addEventListener("click", () => this.changeMonth(-1, t)), this.picker.querySelector(`.zhenshangyin-next-month[data-type="${t}"]`).addEventListener("click", () => this.changeMonth(1, t)), this.populateCalendar(t), this.showTime && this.setupRangeTimeDropdowns(t) }), this.setupRangeHoverEvents(), this.showTime) { this.updateRangeTimeLabels(); const t = this.picker.querySelector(".zhenshangyin-confirm-btn"); t && t.addEventListener("click", () => { if (!this.startDate || !this.endDate) return; const t = this.formatDateWithTime(this.startDate, this.startTime), e = this.formatDateWithTime(this.endDate, this.endTime); if (this.isSeparate && this.startInput && this.endInput) this.startInput.value = t, this.endInput.value = e, this.onSelect([t, e]); else if (this.dateInput) { const s = `${t}${this.separator}${e}`; this.dateInput.value = s, this.onSelect(s) } this.closePicker() }) } } updateRangeTimeLabels() { if (!this.picker || "dateRange" !== this.type || !this.showTime) return; const t = this.picker.querySelector('.zhenshangyin-date-label[data-type="start"]'), e = this.picker.querySelector('.zhenshangyin-date-label[data-type="end"]'); t && (t.textContent = this.formatDateOnlyForRange("start")), e && (e.textContent = this.formatDateOnlyForRange("end")) } setupWeekPickerEvents() { this.picker.querySelector(".zhenshangyin-prev-year").addEventListener("click", () => this.changeYear(-1)), this.picker.querySelector(".zhenshangyin-next-year").addEventListener("click", () => this.changeYear(1)), this.picker.querySelector(".zhenshangyin-prev-month").addEventListener("click", () => this.changeMonth(-1)), this.picker.querySelector(".zhenshangyin-next-month").addEventListener("click", () => this.changeMonth(1)), this.populateWeekCalendar() } setupMonthPickerEvents() { if (this.picker.querySelector(".zhenshangyin-prev-year").addEventListener("click", () => this.changeYear(-1)), this.picker.querySelector(".zhenshangyin-next-year").addEventListener("click", () => this.changeYear(1)), this.populateMonths(), this.multiSelect) { const t = this.picker.querySelector(".zhenshangyin-confirm-btn"); t && t.addEventListener("click", () => { this.updateInputValue(), this.closePicker() }) } } setupMonthRangePickerEvents() { ["start", "end"].forEach(t => { this.picker.querySelector(`.zhenshangyin-prev-year[data-type="${t}"]`).addEventListener("click", () => this.changeYear(-1, t)), this.picker.querySelector(`.zhenshangyin-next-year[data-type="${t}"]`).addEventListener("click", () => this.changeYear(1, t)), this.populateMonths(t) }), this.setupMonthRangeHoverEvents() } setupYearPickerEvents() { if (this.picker.querySelector(".zhenshangyin-prev-decade").addEventListener("click", () => this.changeDecade(-10)), this.picker.querySelector(".zhenshangyin-next-decade").addEventListener("click", () => this.changeDecade(10)), this.populateYears(), this.multiSelect) { const t = this.picker.querySelector(".zhenshangyin-confirm-btn"); t && t.addEventListener("click", () => { this.updateInputValue(), this.closePicker() }) } } setupYearRangePickerEvents() { ["start", "end"].forEach(t => { this.picker.querySelector(`.zhenshangyin-prev-decade[data-type="${t}"]`).addEventListener("click", () => this.changeDecade(-10, t)), this.picker.querySelector(`.zhenshangyin-next-decade[data-type="${t}"]`).addEventListener("click", () => this.changeDecade(10, t)), this.populateYears(t) }), this.setupYearRangeHoverEvents() } setupYearRangeHoverEvents() { "yearRange" === this.type && ["start", "end"].forEach(t => { const e = `${t}-year-picker-body`; this.picker.querySelectorAll(`#${e} td[data-year]`).forEach(t => { t.addEventListener("mouseenter", () => { this.startYear && !this.endYear && this.applyHoverYearRangeStyle(parseInt(t.dataset.year)) }), t.addEventListener("mouseleave", () => { this.startYear && !this.endYear && this.applyRangeStyles() }) }) }) } applyHoverYearRangeStyle(t) { this.picker.querySelectorAll("td[data-year]").forEach(e => { const s = parseInt(e.dataset.year); e.classList.remove("zhenshangyin-hover-range"), this.startYear && s >= this.startYear && s <= t && e.classList.add("zhenshangyin-hover-range") }) } setupTimePickerEvents() { this.parseTimeInputValue(), this.setupStandaloneTimeScrolls(), this.setupStandaloneTimeButtons() } parseTimeInputValue() { if (this.isSeparate && "timeRange" === this.type) { const t = (this.startInput?.value || "").trim(), e = (this.endInput?.value || "").trim(); t && this.assignTimeFromString(this.startTime, t), e && this.assignTimeFromString(this.endTime, e) } else { const t = (this.dateInput?.value || "").trim(); if (!t) return; if ("timeRange" === this.type) { const [e = "", s = ""] = t.split(this.separator); e && this.assignTimeFromString(this.startTime, e), s && this.assignTimeFromString(this.endTime, s) } else this.assignTimeFromString(this.selectedTime, t) } } assignTimeFromString(t, e) { const s = e.split(":").map(t => parseInt(t, 10)); t.hours = isNaN(s[0]) ? 0 : s[0], t.minutes = isNaN(s[1]) ? 0 : s[1], t.seconds = isNaN(s[2]) ? 0 : s[2] } createStandaloneTimePickerHTML() { return "timeRange" === this.type ? `\n            <div class="zhenshangyin-date-range-container">\n                <div class="zhenshangyin-time-picker-wrapper">${this.createStandaloneTimeContent("start")}</div>\n                <div class="zhenshangyin-time-picker-wrapper">${this.createStandaloneTimeContent("end")}</div>\n            </div>\n            <div class="zhenshangyin-button-container">\n                <button class="zhenshangyin-confirm-btn">${"en" === this.language ? "Confirm" : "ç¡®è®¤"}</button>\n            </div>` : this.createStandaloneTimeContent("single") } createStandaloneTimeContent(t) { const e = "start" === t ? this.startTime : "end" === t ? this.endTime : this.selectedTime, s = this.showHours, i = this.showMinutes, n = this.showSeconds, a = "en" === this.language ? "Now" : "æ­¤åˆ»", o = "en" === this.language ? "Confirm" : "ç¡®è®¤", r = () => Array.from({ length: 2 }, () => '<div class="zhenshangyin-scroll-item placeholder"></div>').join(""), h = (t, e, s) => `\n            <div class="zhenshangyin-time-scroll" id="${t}">\n                ${r()}\n                ${((t, e) => t.map(t => `<div class="zhenshangyin-scroll-item${t === e ? " selected" : ""}">${String(t).padStart(2, "0")}</div>`).join(""))(e, s)}\n                ${r()}\n            </div>`; return `\n            <div class="zhenshangyin-time-scroll-container">\n                ${s ? h(`${t}-hours-scroll`, this.availableHours, e.hours) : ""}\n                ${i ? h(`${t}-minutes-scroll`, this.availableMinutes, e.minutes) : ""}\n                ${n ? h(`${t}-seconds-scroll`, this.availableSeconds, e.seconds) : ""}\n            </div>\n            ${"timeRange" !== this.type ? `\n            <div class="zhenshangyin-button-container">\n                <button class="zhenshangyin-current-time-btn zhenshangyin-itm-current-time-btn">${a}</button>\n                <button class="zhenshangyin-confirm-btn">${o}</button>\n            </div>` : ""}\n        ` } setupStandaloneTimeScrolls() { "timeRange" === this.type ? ["start", "end"].forEach(t => this.setupStandaloneTimeScroll(t)) : this.setupStandaloneTimeScroll("single") } setupStandaloneTimeScroll(t) { this.showHours && this.setupStandaloneScroll(`${t}-hours-scroll`, "hours", t, 24), this.showMinutes && this.setupStandaloneScroll(`${t}-minutes-scroll`, "minutes", t, 60), this.showSeconds && this.setupStandaloneScroll(`${t}-seconds-scroll`, "seconds", t, 60) } setupStandaloneScroll(t, e, s, i) { const n = this.picker.querySelector(`#${t}`); if (!n) return; const a = n.querySelectorAll(".zhenshangyin-scroll-item:not(.placeholder)"), o = "start" === s ? this.startTime : "end" === s ? this.endTime : this.selectedTime, r = "hours" === e ? this.availableHours : "minutes" === e ? this.availableMinutes : this.availableSeconds, h = Math.max(0, r.indexOf(o[e])); let l; this.standaloneCenterScroll(n, h), n.addEventListener("scroll", () => { l && clearTimeout(l), l = setTimeout(() => { const t = this.getStandaloneIndexFromScroll(n, a.length); if (t >= 0 && t < a.length) { ("start" === s ? this.startTime : "end" === s ? this.endTime : this.selectedTime)[e] = r[t] ?? t, a.forEach((e, s) => e.classList.toggle("selected", s === t)), this.standaloneCenterScroll(n, t) } }, 100) }), a.forEach((t, i) => { t.addEventListener("click", () => { ("start" === s ? this.startTime : "end" === s ? this.endTime : this.selectedTime)[e] = r[i] ?? i, this.standaloneCenterScroll(n, i), a.forEach((t, e) => t.classList.toggle("selected", e === i)) }) }) } getStandaloneScrollMetrics(t) { const e = t.querySelector(".zhenshangyin-scroll-item:not(.placeholder)"), s = e ? e.offsetHeight : 30; return { itemHeight: s, visibleCenter: t.clientHeight / 2, topPadding: 2 * s } } standaloneCenterScroll(t, e) { const { itemHeight: s, visibleCenter: i, topPadding: n } = this.getStandaloneScrollMetrics(t), a = n + e * s - (i - s / 2); t.scrollTop = Math.max(0, Math.round(a)) } getStandaloneIndexFromScroll(t, e) { const { itemHeight: s, visibleCenter: i, topPadding: n } = this.getStandaloneScrollMetrics(t), a = (t.scrollTop + i - s / 2 - n) / s, o = Math.round(a); return Math.min(Math.max(o, 0), e - 1) } setupStandaloneTimeButtons() { if ("timeRange" !== this.type) { const t = this.picker.querySelector(".zhenshangyin-current-time-btn"); t && t.addEventListener("click", () => { const t = new Date; if (this.selectedTime.hours = t.getHours(), this.selectedTime.minutes = t.getMinutes(), this.selectedTime.seconds = t.getSeconds(), this.showHours) { const t = Math.max(0, this.availableHours.indexOf(this.selectedTime.hours)); this.standaloneCenterScroll(this.picker.querySelector("#single-hours-scroll"), t) } if (this.showMinutes) { const t = Math.max(0, this.availableMinutes.indexOf(this.selectedTime.minutes)); this.standaloneCenterScroll(this.picker.querySelector("#single-minutes-scroll"), t) } if (this.showSeconds) { const t = Math.max(0, this.availableSeconds.indexOf(this.selectedTime.seconds)); this.standaloneCenterScroll(this.picker.querySelector("#single-seconds-scroll"), t) } this.updateStandaloneTimeInputs(), this.closePicker() }) } const t = this.picker.querySelector(".zhenshangyin-confirm-btn"); t && t.addEventListener("click", () => { this.updateStandaloneTimeInputs(), this.closePicker() }) } formatTimeObject(t) { let e = this.dateFormat; return this.showHours && (e = e.replace("HH", String(t.hours).padStart(2, "0"))), this.showMinutes && (e = e.replace("mm", String(t.minutes).padStart(2, "0"))), this.showSeconds && (e = e.replace("ss", String(t.seconds).padStart(2, "0"))), e } updateStandaloneTimeInputs() { if ("timeRange" === this.type) { const t = this.formatTimeObject(this.startTime), e = this.formatTimeObject(this.endTime); this.isSeparate && this.startInput && this.endInput ? (this.startInput.value = t, this.endInput.value = e) : this.dateInput && (this.dateInput.value = `${t}${this.separator}${e}`), this.onSelect(this.isSeparate ? [t, e] : `${t}${this.separator}${e}`) } else { const t = this.formatTimeObject(this.selectedTime); this.dateInput && (this.dateInput.value = t), this.onSelect(t) } } populateCalendar(t = "") { const e = t ? `${t}-calendar-body` : "calendar-body", s = this.picker.querySelector(`#${e}`), i = "start" === t ? this.startYear : "end" === t ? this.endYear : this.currentYear, n = "start" === t ? this.startMonth : "end" === t ? this.endMonth : this.currentMonth, a = new Date(i, n, 1), o = (new Date(i, n + 1, 0), new Date(a)); o.setDate(o.getDate() - a.getDay()), s.innerHTML = ""; for (let e = 0; e < 6; e++) { const i = document.createElement("tr"); for (let s = 0; s < 7; s++) { const a = new Date(o); a.setDate(o.getDate() + 7 * e + s); const r = document.createElement("td"); r.textContent = a.getDate(), r.dataset.date = this.getDateKey(a), a.getMonth() !== n && (r.style.opacity = "0.5", r.classList.add("zhenshangyin-custom-other-month")), this.isDateDisabled(a) ? r.classList.add("zhenshangyin-custom-disabled") : r.addEventListener("click", () => this.selectDate(a, t)), this.applyDateStyles(r, a, t), i.appendChild(r) } s.appendChild(i) } } populateWeekCalendar(t = "") { const e = t ? `${t}-week-calendar-body` : "week-calendar-body", s = this.picker.querySelector(`#${e}`), i = "start" === t ? this.startYear : "end" === t ? this.endYear : this.currentYear, n = "start" === t ? this.startMonth : "end" === t ? this.endMonth : this.currentMonth, a = new Date(i, n, 1), o = (new Date(i, n + 1, 0), new Date(a)); o.setDate(o.getDate() - a.getDay()), s.innerHTML = ""; for (let e = 0; e < 6; e++) { const i = document.createElement("tr"), a = []; for (let t = 0; t < 7; t++) { const s = new Date(o); s.setDate(o.getDate() + 7 * e + t), a.push(new Date(s)); const r = document.createElement("td"); r.textContent = s.getDate(), r.dataset.date = this.getDateKey(s), s.getMonth() !== n && (r.style.opacity = "0.5", r.classList.add("zhenshangyin-custom-other-month")), i.appendChild(r) } i.addEventListener("click", () => this.selectWeek(a, t)), i.addEventListener("mouseenter", () => this.highlightWeek(i, !0)), i.addEventListener("mouseleave", () => this.highlightWeek(i, !1)), this.applyWeekStyles(i, a, t), s.appendChild(i) } } populateMonths(t = "") { const e = t ? `${t}-month-picker-body` : "month-picker-body", s = this.picker.querySelector(`#${e}`), i = "start" === t ? this.currentYear : "end" === t ? this.endYear : this.currentYear; s.querySelectorAll("td").forEach((e, n) => { const a = n + 1; if (e.classList.remove("zhenshangyin-custom-selected", "zhenshangyin-selected-range", "zhenshangyin-hover-range", "zhenshangyin-custom-disabled"), this.isMonthDisabled(i, a)) e.classList.add("zhenshangyin-custom-disabled"); else { const s = e.cloneNode(!0); e.replaceWith(s), s.dataset.year = i, s.dataset.month = n, s.addEventListener("click", () => this.selectMonth(i, a, t)) } this.applyMonthStyles(s.querySelectorAll("td")[n], i, a, t) }) } populateYears(t = "") { const e = t ? `${t}-year-picker-body` : "year-picker-body", s = this.picker.querySelector(`#${e}`); let i = this.currentYear; "yearRange" === this.type && ("start" === t ? i = this.startPanelYear : "end" === t && (i = this.endPanelYear)); const n = 10 * Math.floor(i / 10); s.innerHTML = ""; for (let e = 0; e < 4; e++) { const i = document.createElement("tr"); for (let s = 0; s < 3; s++) { const a = n + 3 * e + s, o = document.createElement("td"); o.textContent = a, o.dataset.year = a, this.isYearDisabled(a) ? o.classList.add("zhenshangyin-custom-disabled") : o.addEventListener("click", () => this.selectYear(a, t)), this.applyYearStyles(o, a, t), i.appendChild(o) } s.appendChild(i) } } selectDate(t, e = "") { if ("date" === this.type) if (this.multiSelect) { const e = this.formatDate(t); this.selectedDates.has(e) ? this.selectedDates.delete(e) : this.selectedDates.add(e), this.updateInputValue(), this.populateCalendar() } else { this.selectedDate = t, this.currentYear = t.getFullYear(), this.currentMonth = t.getMonth(), this.picker.querySelectorAll("td").forEach(t => t.classList.remove("zhenshangyin-custom-selected")); const e = Array.from(this.picker.querySelectorAll("td")).find(e => parseInt(e.textContent, 10) === t.getDate() && !e.style.opacity); e && e.classList.add("zhenshangyin-custom-selected"), this.updateInputValue(), this.showTime || this.closePicker() } else "dateRange" === this.type && (this.isSeparate ? this.startDate ? this.endDate ? (this.startDate = this.normalizeDate(t), this.endDate = null, this.isSelectingStart = !1, this.showTime && this.updateRangeTimeLabels()) : (this.endDate = this.normalizeDate(t), this.startDate > this.endDate && ([this.startDate, this.endDate] = [this.endDate, this.startDate]), this.showTime || (this.updateInputValue(), this.closePicker()), this.showTime && this.updateRangeTimeLabels()) : (this.startDate = this.normalizeDate(t), this.endDate = null, this.isSelectingStart = !1, this.showTime && this.updateRangeTimeLabels()) : this.isSelectingStart ? (this.startDate = this.normalizeDate(t), this.endDate = null, this.isSelectingStart = !1, this.showTime && this.updateRangeTimeLabels()) : (this.endDate = this.normalizeDate(t), this.startDate > this.endDate && ([this.startDate, this.endDate] = [this.endDate, this.startDate]), this.showTime || (this.updateInputValue(), this.closePicker()), this.showTime && this.updateRangeTimeLabels(), this.isSelectingStart = !0), this.applyRangeStyles()) } selectWeek(t, e = "") { this.selectedWeek = { start: t[0], end: t[6] }, this.updateInputValue(), this.closePicker() } selectMonth(t, e, s = "") { if ("month" === this.type) if (this.multiSelect) { const s = this.selectedMonths.findIndex(s => s.year === t && s.month === e); s > -1 ? this.selectedMonths.splice(s, 1) : this.selectedMonths.push({ year: t, month: e }), this.updateInputValue(), this.populateMonths() } else this.selectedMonths = [{ year: t, month: e }], this.updateInputValue(), this.closePicker(); else if ("monthRange" === this.type) { const s = new Date(t, e - 1, 1); this.isSeparate ? this.startMonth ? this.endMonth ? (this.startMonth = s, this.endMonth = null, this.isSelectingStart = !1) : (this.endMonth = s, this.startMonth > this.endMonth && ([this.startMonth, this.endMonth] = [this.endMonth, this.startMonth]), this.showTime || (this.updateInputValue(), this.closePicker())) : (this.startMonth = s, this.endMonth = null, this.isSelectingStart = !1) : this.isSelectingStart ? (this.startMonth = s, this.endMonth = null, this.isSelectingStart = !1) : (this.endMonth = s, this.startMonth > this.endMonth && ([this.startMonth, this.endMonth] = [this.endMonth, this.startMonth]), this.showTime || (this.updateInputValue(), this.closePicker()), this.isSelectingStart = !0), this.applyRangeStyles() } } selectYear(t, e = "") { if ("year" === this.type) if (this.multiSelect) { const e = this.selectedYears.indexOf(t); e > -1 ? this.selectedYears.splice(e, 1) : this.selectedYears.push(t), this.updateInputValue(), this.populateYears() } else this.selectedYears = [t], this.updateInputValue(), this.closePicker(); else "yearRange" === this.type && (this.isSeparate ? this.startYear ? this.endYear ? (this.startYear = t, this.endYear = null, this.isSelectingStart = !1) : (this.endYear = t, this.startYear > this.endYear && ([this.startYear, this.endYear] = [this.endYear, this.startYear]), this.showTime || (this.updateInputValue(), this.closePicker())) : (this.startYear = t, this.endYear = null, this.isSelectingStart = !1) : this.isSelectingStart ? (this.startYear = t, this.endYear = null, this.isSelectingStart = !1) : (this.endYear = t, this.startYear > this.endYear && ([this.startYear, this.endYear] = [this.endYear, this.startYear]), this.showTime || (this.updateInputValue(), this.closePicker()), this.isSelectingStart = !0), this.applyRangeStyles()) } setupTimeDropdowns() { const t = this.picker.querySelector("#zhenshangyin-time-dropdown"); if (!t) return; const e = t.querySelector(".zhenshangyin-scroll-container"), s = e.querySelector(".zhenshangyin-confirm-confirm"); if (t.querySelector(".zhenshangyin-dropdown-label").addEventListener("click", t => { if (t.stopPropagation(), e.style.display = "none" === e.style.display ? "block" : "none", this.showHours) { const t = e.querySelector("#hours-scroll"), s = this.availableHours.indexOf(this.selectedTime.hours); this.dropdownCenterScroll(t, s >= 0 ? s : 0) } if (this.showMinutes) { const t = e.querySelector("#minutes-scroll"), s = this.availableMinutes.indexOf(this.selectedTime.minutes); this.dropdownCenterScroll(t, s >= 0 ? s : 0) } if (this.showSeconds) { const t = e.querySelector("#seconds-scroll"), s = this.availableSeconds.indexOf(this.selectedTime.seconds); this.dropdownCenterScroll(t, s >= 0 ? s : 0) } }), s.addEventListener("click", t => { t.stopPropagation(), e.style.display = "none" }), this._onDocClickDropdown || (this._onDocClickDropdown = s => { t.contains(s.target) || (e.style.display = "none") }, document.addEventListener("click", this._onDocClickDropdown)), this.showHours) { const t = e.querySelector("#hours-scroll"); this.setupScroll(t, "hours") } if (this.showMinutes) { const t = e.querySelector("#minutes-scroll"); this.setupScroll(t, "minutes") } if (this.showSeconds) { const t = e.querySelector("#seconds-scroll"); this.setupScroll(t, "seconds") } const i = this.picker.querySelector(".zhenshangyin-current-time-btn"); i && i.addEventListener("click", () => { const e = new Date, s = e.getHours(), i = e.getMinutes(), n = e.getSeconds(), a = this.availableHours.reduce((t, e) => Math.abs(e - s) < Math.abs(t - s) ? e : t), o = this.availableMinutes.reduce((t, e) => Math.abs(e - i) < Math.abs(t - i) ? e : t), r = this.availableSeconds.reduce((t, e) => Math.abs(e - n) < Math.abs(t - n) ? e : t); this.selectedTime.hours = a, this.selectedTime.minutes = o, this.selectedTime.seconds = r, this.selectedDate = e, this.currentYear = e.getFullYear(), this.currentMonth = e.getMonth(), this.updateCalendar(); const h = new Date(this.currentYear, this.currentMonth, e.getDate()), l = this.formatDateWithTime(h, this.showTime ? this.selectedTime : null); this.dateInput && (this.dateInput.value = l), t.querySelector(".zhenshangyin-dropdown-label").textContent = this.formatTime() }); const n = this.picker.querySelector(".zhenshangyin-confirm-btn"); n && n.addEventListener("click", () => { const t = this.selectedDate ? this.selectedDate.getDate() : 1, e = new Date(this.currentYear, this.currentMonth, t), s = this.formatDateWithTime(e, this.showTime ? this.selectedTime : null); this.dateInput && (this.dateInput.value = s), this.closePicker(), this.onSelect(s) }) } setupRangeTimeDropdowns(t) { const e = this.picker.querySelector(`#${t}-zhenshangyin-time-dropdown`); if (!e) return; const s = e.querySelector(".zhenshangyin-scroll-container"), i = e.querySelector(".zhenshangyin-dropdown-label"), n = s.querySelector(`#${t}-hours-scroll`), a = s.querySelector(`#${t}-minutes-scroll`), o = s.querySelector(`#${t}-seconds-scroll`), r = s.querySelector(".zhenshangyin-confirm-confirm"), h = (t, e, s) => { if (!t) return; const i = t.querySelectorAll(".zhenshangyin-scroll-item:not(.placeholder)"), n = Math.max(0, (s || []).indexOf(e)), a = t.querySelector(".zhenshangyin-scroll-item:not(.placeholder)"), o = a ? a.offsetHeight : 30, r = t.clientHeight / 2, h = 2 * o; t.scrollTop = Math.max(0, Math.round(h + n * o - (r - o / 2))), i.forEach((t, e) => t.classList.toggle("selected", e === n)) }; i && i.addEventListener("click", e => { e.stopPropagation(), s.style.display = "none" === s.style.display ? "block" : "none"; const i = "start" === t ? this.startTime : this.endTime; this.showHours && h(n, i.hours, this.availableHours), this.showMinutes && h(a, i.minutes, this.availableMinutes), this.showSeconds && h(o, i.seconds, this.availableSeconds) }); const l = (s, i, n) => { if (!s) return; const a = s.querySelectorAll(".zhenshangyin-scroll-item:not(.placeholder)"); let o; s.addEventListener("scroll", () => { o && clearTimeout(o), o = setTimeout(() => { const o = s.querySelector(".zhenshangyin-scroll-item:not(.placeholder)"), r = o ? o.offsetHeight : 30, h = s.clientHeight / 2, l = 2 * r, c = (s.scrollTop + h - r / 2 - l) / r, d = Math.round(c), p = "start" === t ? this.startTime : this.endTime; p[i] = n && void 0 !== n[d] ? n[d] : d, a.forEach((t, e) => t.classList.toggle("selected", e === d)), e.querySelector(".zhenshangyin-dropdown-label").textContent = this.formatTime(p), s.scrollTop = Math.max(0, Math.round(l + d * r - (h - r / 2))) }, 100) }), a.forEach((a, o) => a.addEventListener("click", () => { const a = "start" === t ? this.startTime : this.endTime; a[i] = n && void 0 !== n[o] ? n[o] : o, e.querySelector(".zhenshangyin-dropdown-label").textContent = this.formatTime(a), h(s, a[i], n) })) }; l(n, "hours", this.availableHours), l(a, "minutes", this.availableMinutes), l(o, "seconds", this.availableSeconds), r && r.addEventListener("click", t => { t.stopPropagation(), s.style.display = "none" }); const c = "start" === t ? "_onDocClickDropdownStart" : "_onDocClickDropdownEnd"; this[c] || (this[c] = t => { e.contains(t.target) || (s.style.display = "none") }, document.addEventListener("click", this[c])) } setupScroll(t, e) { const s = t.querySelectorAll(".zhenshangyin-scroll-item:not(.placeholder)"); let i; const n = "hours" === e ? this.availableHours : "minutes" === e ? this.availableMinutes : this.availableSeconds; t.addEventListener("scroll", () => { i && clearTimeout(i), i = setTimeout(() => { const i = this.getDropdownIndexFromScroll(t, n.length); i >= 0 && i < n.length && (this.selectedTime[e] = n[i], s.forEach((t, e) => { t.classList.toggle("selected", e === i) }), this.picker.querySelector(".zhenshangyin-dropdown-label").textContent = this.formatTime(), this.dropdownCenterScroll(t, i)) }, 100) }), s.forEach((s, i) => { s.addEventListener("click", () => { i >= 0 && i < n.length && (this.selectedTime[e] = n[i], this.dropdownCenterScroll(t, i), this.picker.querySelector(".zhenshangyin-dropdown-label").textContent = this.formatTime()) }) }) } getDropdownScrollMetrics(t) { const e = t.querySelector(".zhenshangyin-scroll-item:not(.placeholder)"), s = e ? e.offsetHeight : 30; return { itemHeight: s, visibleCenter: t.clientHeight / 2, topPadding: 2 * s } } dropdownCenterScroll(t, e) { const { itemHeight: s, visibleCenter: i, topPadding: n } = this.getDropdownScrollMetrics(t), a = n + e * s - (i - s / 2); t.scrollTop = Math.max(0, Math.round(a)) } getDropdownIndexFromScroll(t, e) { const { itemHeight: s, visibleCenter: i, topPadding: n } = this.getDropdownScrollMetrics(t), a = (t.scrollTop + i - s / 2 - n) / s, o = Math.round(a); return Math.min(Math.max(o, 0), e - 1) } changeYear(t, e = "") { "start" === e ? this.startYear += t : "end" === e ? this.endYear += t : this.currentYear += t, this.updateCalendar(e) } changeMonth(t, e = "") { "start" === e ? (this.startMonth += t, this.startMonth < 0 ? (this.startMonth = 11, this.startYear--) : this.startMonth > 11 && (this.startMonth = 0, this.startYear++)) : "end" === e ? (this.endMonth += t, this.endMonth < 0 ? (this.endMonth = 11, this.endYear--) : this.endMonth > 11 && (this.endMonth = 0, this.endYear++)) : (this.currentMonth += t, this.currentMonth < 0 ? (this.currentMonth = 11, this.currentYear--) : this.currentMonth > 11 && (this.currentMonth = 0, this.currentYear++)), this.updateCalendar(e) } changeDecade(t, e = "") { "yearRange" === this.type ? "start" === e ? this.startPanelYear += t : "end" === e ? this.endPanelYear += t : this.currentYear += t : this.currentYear += t, this.updateCalendar(e) } updateCalendar(t = "") { const e = t ? `.zhenshangyin-current-display[data-type="${t}"]` : ".zhenshangyin-current-display", s = this.picker.querySelector(e); if ("date" === this.type || "dateRange" === this.type || "week" === this.type || "weekRange" === this.type) { const e = "start" === t ? this.startYear : "end" === t ? this.endYear : this.currentYear, i = "start" === t ? this.startMonth : "end" === t ? this.endMonth : this.currentMonth; s && (s.textContent = `${e}${"en" === this.language ? " Year " : "å¹´ "}${i + 1}${"en" === this.language ? " Month" : "æœˆ"}`), "date" === this.type || "week" === this.type ? "date" === this.type ? this.populateCalendar() : this.populateWeekCalendar() : "dateRange" === this.type ? this.populateCalendar(t) : this.populateWeekCalendar(t) } else if ("month" === this.type || "monthRange" === this.type) { const e = "start" === t ? this.currentYear : "end" === t ? this.endYear : this.currentYear; s && (s.textContent = e), "month" === this.type ? this.populateMonths() : this.populateMonths(t) } else "year" !== this.type && "yearRange" !== this.type || (s && (s.textContent = "yearRange" === this.type ? this.getDecadeRange(t) : this.getDecadeRange()), "year" === this.type ? this.populateYears() : this.populateYears(t)); this.isRangeType() && this.applyRangeStyles() } applyInitialStyles() { this.isRangeType() && this.hasSelectedRange() && this.applyRangeStyles() } hasSelectedRange() { return "dateRange" === this.type ? this.startDate && this.endDate : "monthRange" === this.type ? this.startMonth && this.endMonth : "yearRange" === this.type ? this.startYear && this.endYear : "weekRange" === this.type && (this.startDate && this.endDate) } applyDateStyles(t, e, s = "") { "date" === this.type && (this.multiSelect && this.selectedDates.has(this.formatDate(e)) || !this.multiSelect && this.selectedDate && this.isSameDate(e, this.selectedDate)) && t.classList.add("zhenshangyin-custom-selected") } applyWeekStyles(t, e, s = "") { if ("week" === this.type && this.selectedWeek && this.isSameWeek(e[0], this.selectedWeek.start)) { t.querySelectorAll("td").forEach(t => { t.classList.add("zhenshangyin-selected-range"), t.classList.add("zhenshangyin-custom-selected") }) } } applyMonthStyles(t, e, s, i = "") { if ("month" === this.type) this.multiSelect ? this.selectedMonths.some(t => t.year === e && t.month === s) && t.classList.add("zhenshangyin-custom-selected") : 1 === this.selectedMonths.length && this.selectedMonths[0].year === e && this.selectedMonths[0].month === s && t.classList.add("zhenshangyin-custom-selected"); else if ("monthRange" === this.type) { const i = new Date(e, s - 1, 1); this.startMonth && this.endMonth ? i >= this.startMonth && i <= this.endMonth && (t.classList.add("zhenshangyin-selected-range"), i.getTime() !== this.startMonth.getTime() && i.getTime() !== this.endMonth.getTime() || t.classList.add("zhenshangyin-custom-selected")) : this.startMonth && i.getTime() === this.startMonth.getTime() && t.classList.add("zhenshangyin-custom-selected") } } applyYearStyles(t, e, s = "") { "year" === this.type && (this.multiSelect ? this.selectedYears.includes(e) && t.classList.add("zhenshangyin-custom-selected") : 1 === this.selectedYears.length && this.selectedYears[0] === e && t.classList.add("zhenshangyin-custom-selected")) } applyRangeStyles() { this.picker && (this.picker.querySelectorAll("td").forEach(t => { t.classList.remove("zhenshangyin-custom-selected", "zhenshangyin-selected-range", "zhenshangyin-hover-range") }), "dateRange" === this.type && this.startDate ? this.applyDateRangeStyles() : "monthRange" === this.type && this.startMonth ? this.applyMonthRangeStyles() : "yearRange" === this.type && this.startYear ? this.applyYearRangeStyles() : "weekRange" === this.type && this.startDate && this.applyWeekRangeStyles()) } applyDateRangeStyles() { this.picker.querySelectorAll("td[data-date]").forEach(t => { const e = this.parseDateKey(t.dataset.date); this.startDate && this.endDate ? e >= this.startDate && e <= this.endDate && (t.classList.add("zhenshangyin-selected-range"), (this.isSameDate(e, this.startDate) || this.isSameDate(e, this.endDate)) && t.classList.add("zhenshangyin-custom-selected")) : this.startDate && this.isSameDate(e, this.startDate) && t.classList.add("zhenshangyin-custom-selected") }) } applyMonthRangeStyles() { this.picker.querySelectorAll("td[data-year][data-month]").forEach(t => { const e = parseInt(t.dataset.year), s = parseInt(t.dataset.month), i = new Date(e, s, 1); this.startMonth && this.endMonth ? i >= this.startMonth && i <= this.endMonth && (t.classList.add("zhenshangyin-selected-range"), i.getTime() !== this.startMonth.getTime() && i.getTime() !== this.endMonth.getTime() || t.classList.add("zhenshangyin-custom-selected")) : this.startMonth && i.getTime() === this.startMonth.getTime() && t.classList.add("zhenshangyin-custom-selected") }) } applyYearRangeStyles() { this.picker.querySelectorAll("td[data-year]").forEach(t => { const e = parseInt(t.dataset.year); this.startYear && this.endYear ? e >= this.startYear && e <= this.endYear && (t.classList.add("zhenshangyin-selected-range"), e !== this.startYear && e !== this.endYear || t.classList.add("zhenshangyin-custom-selected")) : this.startYear && e === this.startYear && t.classList.add("zhenshangyin-custom-selected") }) } applyWeekRangeStyles() { this.picker.querySelectorAll("tr").forEach(t => { const e = t.querySelectorAll("td[data-date]"); if (7 === e.length) { const t = this.parseDateKey(e[0].dataset.date), s = this.parseDateKey(e[6].dataset.date); this.startDate && this.endDate && t >= this.startDate && s <= this.endDate && e.forEach(t => { t.classList.add("zhenshangyin-selected-range"), t.classList.add("zhenshangyin-custom-selected") }) } }) } setupRangeHoverEvents() { "dateRange" === this.type && this.picker.querySelectorAll("td[data-date]").forEach(t => { t.addEventListener("mouseenter", () => { this.startDate && !this.endDate && this.applyHoverRangeStyle(this.parseDateKey(t.dataset.date)) }), t.addEventListener("mouseleave", () => { this.startDate && !this.endDate && this.applyRangeStyles() }) }) } setupMonthRangeHoverEvents() { "monthRange" === this.type && this.picker.querySelectorAll("td[data-year][data-month]").forEach(t => { t.addEventListener("mouseenter", () => { if (this.startMonth && !this.endMonth) { const e = parseInt(t.dataset.year), s = parseInt(t.dataset.month); this.applyHoverRangeStyle(new Date(e, s, 1)) } }), t.addEventListener("mouseleave", () => { this.startMonth && !this.endMonth && this.applyRangeStyles() }) }) } applyHoverRangeStyle(t) { if (this.picker.querySelectorAll("td").forEach(t => { t.classList.remove("zhenshangyin-hover-range") }), "dateRange" === this.type && this.startDate) { const [e, s] = this.startDate < t ? [this.startDate, t] : [t, this.startDate]; this.picker.querySelectorAll("td[data-date]").forEach(t => { const i = new Date(t.dataset.date); i >= e && i <= s && t.classList.add("zhenshangyin-hover-range") }) } else if ("monthRange" === this.type && this.startMonth) { const [e, s] = this.startMonth < t ? [this.startMonth, t] : [t, this.startMonth]; this.picker.querySelectorAll("td[data-year][data-month]").forEach(t => { const i = parseInt(t.dataset.year), n = parseInt(t.dataset.month), a = new Date(i, n, 1); a >= e && a <= s && t.classList.add("zhenshangyin-hover-range") }) } } highlightWeek(t, e) { t.querySelectorAll("td[data-date]").forEach(t => { e ? t.classList.add("zhenshangyin-hover-range") : t.classList.remove("zhenshangyin-hover-range") }) } centerScroll(t, e) { const s = t.querySelector(`[data-value="${e}"]`); if (s) { t.querySelectorAll(".zhenshangyin-time-item").forEach(t => t.classList.remove("zhenshangyin-time-selected")), s.classList.add("zhenshangyin-time-selected"); const e = s.offsetHeight, i = t.offsetHeight, n = s.offsetTop - i / 2 + e / 2; t.scrollTop = n } } updateInputValue() { let t = ""; switch (this.type) { case "date": this.multiSelect ? t = Array.from(this.selectedDates).join(this.dateDelimiter) : this.selectedDate && (t = this.formatDateWithTime(this.selectedDate, this.showTime ? this.selectedTime : null)); break; case "dateRange": if (this.startDate && this.endDate) { const e = this.formatDateWithTime(this.startDate, this.showTime ? this.startTime : null), s = this.formatDateWithTime(this.endDate, this.showTime ? this.endTime : null); t = `${e}${this.separator}${s}` } break; case "week": this.selectedWeek && (t = `${this.formatDate(this.selectedWeek.start)}${this.separator}${this.formatDate(this.selectedWeek.end)}`); break; case "month": if (this.multiSelect) t = this.selectedMonths.map(t => this.formatMonth(t.year, t.month)).join(this.separator); else if (this.selectedMonths.length > 0) { const e = this.selectedMonths[0]; t = this.formatMonth(e.year, e.month) } break; case "monthRange": this.startMonth && this.endMonth && (t = `${this.formatMonth(this.startMonth.getFullYear(), this.startMonth.getMonth() + 1)}${this.separator}${this.formatMonth(this.endMonth.getFullYear(), this.endMonth.getMonth() + 1)}`); break; case "year": this.multiSelect ? t = this.selectedYears.join(this.separator) : this.selectedYears.length > 0 && (t = this.selectedYears[0].toString()); break; case "yearRange": this.startYear && this.endYear && (t = `${this.startYear}${this.separator}${this.endYear}`); break; case "time": t = this.formatTime(this.selectedTime); break; case "timeRange": t = `${this.formatTime(this.startTime)}${this.separator}${this.formatTime(this.endTime)}` }if (this.isSeparate && this.isRangeType()) { const e = t.split(this.separator); 2 === e.length && (this.startInput.value = e[0].trim(), this.endInput.value = e[1].trim()) } else (this.dateInput || this.startInput).value = t; this.onSelect(t) } formatDate(t, e, s) { let i; i = 1 === arguments.length && t instanceof Date ? t : 3 === arguments.length ? new Date(t, e, s) : t instanceof Date ? t : new Date(t); let n = this.dateFormat.replace("YYYY", i.getFullYear()).replace("MM", String(i.getMonth() + 1).padStart(2, "0")).replace("DD", String(i.getDate()).padStart(2, "0")); return this.showTime && this.selectedTime && (n = n.replace("HH", String(this.selectedTime.hours).padStart(2, "0")).replace("mm", String(this.selectedTime.minutes).padStart(2, "0")).replace("ss", String(this.selectedTime.seconds).padStart(2, "0"))), n } formatDateWithTime(t, e = null) { const s = t instanceof Date ? t : new Date(t); let i = this.dateFormat; return i = i.replace("YYYY", String(s.getFullYear())), i = i.replace("MM", String(s.getMonth() + 1).padStart(2, "0")), i = i.replace("DD", String(s.getDate()).padStart(2, "0")), e ? (i.includes("HH") && (i = i.replace("HH", String(e.hours).padStart(2, "0"))), i.includes("mm") && (i = i.replace("mm", String(e.minutes).padStart(2, "0"))), i.includes("ss") && (i = i.replace("ss", String(e.seconds).padStart(2, "0")))) : (i.includes("HH") && (i = i.replace("HH", "00")), i.includes("mm") && (i = i.replace("mm", "00")), i.includes("ss") && (i = i.replace("ss", "00"))), i } formatMonth(t, e) { return this.dateFormat.replace("YYYY", t).replace("MM", String(e).padStart(2, "0")) } formatTime(t = null) { const e = t || this.selectedTime, s = []; return this.showHours && s.push(String(e.hours).padStart(2, "0")), this.showMinutes && s.push(String(e.minutes).padStart(2, "0")), this.showSeconds && s.push(String(e.seconds).padStart(2, "0")), s.join(":") } formatDateOnlyForRange(t) { const e = "start" === t ? this.startDate : this.endDate; return e ? `${e.getFullYear()}-${String(e.getMonth() + 1).padStart(2, "0")}-${String(e.getDate()).padStart(2, "0")}` : "en" === this.language ? "No date selected" : "æœªé€‰æ‹©æ—¥æœŸ" } isDateDisabled(t) { const e = this.getDateKey(t); if (this.disabledItems.has(e)) return !0; if (this.disabledWeekdays.includes(t.getDay())) return !0; for (const e of this.disabledRanges) if (/\d{4}-\d{2}-\d{2}/.test(e.start) && /\d{4}-\d{2}-\d{2}/.test(e.end)) { const s = this.parseDateKey(e.start), i = this.parseDateKey(e.end); if (t >= s && t <= i) return !0 } return !1 } isMonthDisabled(t, e) { const s = `${t}-${String(e).padStart(2, "0")}`; if (this.disabledItems.has(s)) return !0; if (this.disabledRanges && this.disabledRanges.length) { const s = 12 * t + e; for (const t of this.disabledRanges) if (/\d{4}-\d{2}$/.test(t.start) && /\d{4}-\d{2}$/.test(t.end)) { const [e, i] = t.start.split("-").map(t => parseInt(t, 10)), [n, a] = t.end.split("-").map(t => parseInt(t, 10)), o = 12 * e + (isNaN(i) ? 1 : i), r = 12 * n + (isNaN(a) ? 12 : a); if (s >= o && s <= r) return !0 } } return !1 } isYearDisabled(t) { if (this.disabledItems.has(t)) return !0; if (this.disabledRanges && this.disabledRanges.length) for (const e of this.disabledRanges) if ("number" == typeof e.start && "number" == typeof e.end && t >= e.start && t <= e.end) return !0; return !1 } isSameDate(t, e) { return t.getFullYear() === e.getFullYear() && t.getMonth() === e.getMonth() && t.getDate() === e.getDate() } isSameWeek(t, e) { const s = new Date(t); s.setDate(t.getDate() - t.getDay()); const i = new Date(e); return i.setDate(e.getDate() - e.getDay()), this.isSameDate(s, i) } normalizeDate(t) { return new Date(t.getFullYear(), t.getMonth(), t.getDate()) } getDateKey(t) { return `${t.getFullYear()}-${String(t.getMonth() + 1).padStart(2, "0")}-${String(t.getDate()).padStart(2, "0")}` } parseDateKey(t) { const [e, s, i] = t.split("-").map(t => parseInt(t, 10)); return new Date(e, s - 1, i) } togglePicker() { const t = () => { if (!this.picker) return; const t = this.isSeparate ? this.startInput : this.dateInput, e = t.getBoundingClientRect(), s = t.offsetHeight, i = window.innerHeight - e.bottom, n = e.top + window.scrollY; this.picker.classList.add("zhenshangyin-custom-show"); const a = this.picker.offsetHeight, o = this.picker.offsetWidth; i < a && n < a ? (this.picker.style.top = `${n + s}px`, this.picker.classList.add("zhenshangyin-custom-down"), this.picker.classList.remove("zhenshangyin-custom-up")) : i < a ? (this.picker.style.top = n - a + "px", this.picker.classList.add("zhenshangyin-custom-up"), this.picker.classList.remove("zhenshangyin-custom-down")) : (this.picker.style.top = `${n + s}px`, this.picker.classList.add("zhenshangyin-custom-down"), this.picker.classList.remove("zhenshangyin-custom-up")); const r = e.left, h = window.innerWidth - e.right; if ("time" === this.type || "dateRange" === this.type && this.showTime || "weekRange" === this.type && this.showTime) { let t = e.left + window.scrollX; t + o > window.innerWidth ? (t = Math.max(0, e.right + window.scrollX - o), this.picker.classList.add("zhenshangyin-custom-right")) : this.picker.classList.remove("zhenshangyin-custom-right"), this.picker.style.left = `${t}px` } else r + o <= window.innerWidth ? this.picker.style.left = `${e.left + window.scrollX}px` : h + o <= window.innerWidth ? (this.picker.style.left = e.right + window.scrollX - o + "px", this.picker.classList.add("zhenshangyin-custom-right")) : this.picker.style.left = `${e.left + window.scrollX}px` }; this._onWindowScroll = this._onWindowScroll || (() => t()), this._onWindowResize = this._onWindowResize || (() => t()), window.addEventListener("scroll", this._onWindowScroll), window.addEventListener("resize", this._onWindowResize), t() } closePicker() { this.picker && (this.picker.classList.remove("zhenshangyin-custom-show"), this.picker.classList.remove("zhenshangyin-custom-down"), this.picker.classList.remove("zhenshangyin-custom-up"), setTimeout(() => { this.picker && document.body.contains(this.picker) && (this.picker.remove(), this.picker = null), this._onWindowScroll && window.removeEventListener("scroll", this._onWindowScroll), this._onWindowResize && window.removeEventListener("resize", this._onWindowResize), this._onWindowScroll = null, this._onWindowResize = null, this._onDocClickDropdown && (document.removeEventListener("click", this._onDocClickDropdown), this._onDocClickDropdown = null), this._onDocClickDropdownStart && (document.removeEventListener("click", this._onDocClickDropdownStart), this._onDocClickDropdownStart = null), this._onDocClickDropdownEnd && (document.removeEventListener("click", this._onDocClickDropdownEnd), this._onDocClickDropdownEnd = null) }, 300)) } cleanup() { this.styleElement && document.head.contains(this.styleElement) && (document.head.removeChild(this.styleElement), this.styleElement = null), this._onInputClickHandler && (this.isSeparate ? (this.startInput && this.startInput.removeEventListener("click", this._onInputClickHandler), this.endInput && this.endInput.removeEventListener("click", this._onInputClickHandler)) : this.dateInput && this.dateInput.removeEventListener("click", this._onInputClickHandler), this._onInputClickHandler = null), this._onDocumentClickClose && (document.removeEventListener("click", this._onDocumentClickClose), this._onDocumentClickClose = null), this._onDocumentFocusinClose && (document.removeEventListener("focusin", this._onDocumentFocusinClose), this._onDocumentFocusinClose = null), this.closePicker() } } class ZhenshangyinNotification { constructor({ title: t, message: e, type: s = "info", duration: i = 2e3 }) { this.title = t, this.message = e, this.type = s, this.duration = i, this.init() } init() { this.createContainer(), this.createNotification() } createContainer() { if (!document.getElementById("zhenshangyin-notification-container")) { const t = document.createElement("div"); t.id = "zhenshangyin-notification-container", t.className = "zhenshangyin-notification-container", document.body.appendChild(t) } } createNotification() { const t = document.getElementById("zhenshangyin-notification-container"), e = document.createElement("div"); e.className = `zhenshangyin-notification ${this.type}`, e.innerHTML = `\n                            <div class="zhenshangyin-notification-title">\n                                <div class="zhenshangyin-notification-icon">${this.getIcon()}</div>\n                            <h2> ${this.title}</h2>\n                                <div class="zhenshangyin-notification-close">\n                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512l252.288-252.288a31.936 31.936 0 1 0-45.12-45.12z"></path></svg>\n                                </div>\n                            </div>\n                            <div class="zhenshangyin-notification-message">${this.message}</div>\n\n                    `, e.querySelector(".zhenshangyin-notification-close").addEventListener("click", () => { this.hideNotification(e) }), t.appendChild(e), setTimeout(() => e.classList.add("zhenshangyin-notification-show"), 50), this.duration && setTimeout(() => this.hideNotification(e), this.duration) } getIcon() { switch (this.type) { case "error": return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"></path></svg>'; case "warning": return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64m67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344M590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"></path></svg>'; case "info": return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256m0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4"></path></svg>'; case "success": return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z"></path></svg>'; default: return "" } } hideNotification(t) { t.classList.add("zhenshangyin-notification-hide"), setTimeout(() => t.remove(), 500) } } class ZhenshangyinMessage { constructor({ message: t, type: e = "info", duration: s = 2e3 }) { this.message = t, this.type = e, this.duration = s, this.init() } init() { this.createContainer(), this.createMessage() } createContainer() { if (!document.getElementById("zhenshangyin-message-container")) { const t = document.createElement("div"); t.id = "zhenshangyin-message-container", t.className = "zhenshangyin-message-container", document.body.appendChild(t) } } createMessage() { const t = document.getElementById("zhenshangyin-message-container"), e = document.createElement("div"); e.className = `zhenshangyin-message ${this.type}`, e.innerHTML = `${this.getIcon()} ${this.message}`, t.appendChild(e), setTimeout(() => e.classList.add("zhenshangyin-message-show"), 50), this.duration && setTimeout(() => this.hideMessage(e), this.duration) } getIcon() { switch (this.type) { case "error": return '<svg class="zhenshangyin-message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"></path></svg>'; case "warning": return '<svg class="zhenshangyin-message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64m67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344M590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"></path></svg>'; case "info": return '<svg class="zhenshangyin-message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256m0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4"></path></svg>'; case "success": return '<svg class="zhenshangyin-message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z"></path></svg>'; default: return "" } } hideMessage(t) { t.classList.add("zhenshangyin-message-hide"), setTimeout(() => { const e = document.getElementById("zhenshangyin-message-container"); if (e.removeChild(t), !e.hasChildNodes()) { document.body.removeChild(e); const t = document.getElementById("zhenshangyin-message-style"); t && document.head.removeChild(t) } }, 600) } } class ZhenshangyinDropdown { constructor({ container: t, data: e, customParams: s, onSelect: i, searchEnabled: n = !1, inputSearchEnabled: a = !1, defaultSelected: o = null, grouped: r = !1, multiSelect: h = !1, inputMultiSelect: l = !1, language: c = "zh", hoverEnabled: d = !1, disabled: p = !1 }) { this.container = document.querySelector(t), this.container && (this.items = e, this.customParams = s || {}, this.onSelect = i || (() => { }), this.searchEnabled = n, this.inputSearchEnabled = a, this.defaultSelected = o, this.grouped = r, this.multiSelect = h, this.inputMultiSelect = l, this.language = c, this.hoverEnabled = d, this.disabled = p, this.dropdown = null, this.selectedItems = h ? [] : null, this.init()) } init() { if (this.disabled) return this.container.disabled = !0, this.container.style.cursor = "not-allowed", void (this.container.style.backgroundColor = "#f5f5f5"); if (this.container.onclick = t => this.showDropdown(t), this.hoverEnabled && (this.container.onmouseenter = t => this.showDropdown(t), this.container.onmouseleave = () => { if (this.dropdown) { const t = () => { this.dropdown.matches(":hover") || (this.dropdown.classList.remove("zhenshangyin-dropdown-show"), this.dropdown.classList.remove("zhenshangyin-dropdown-down"), this.dropdown.classList.remove("zhenshangyin-dropdown-up"), setTimeout(() => { this.dropdown && (this.dropdown.remove(), this.dropdown = null) }, 300)) }; this.dropdown && (this.dropdown.onmouseleave = t), setTimeout(t, 100) } }), this.inputSearchEnabled && this.container.addEventListener("input", t => this.filterItems(t.target.value)), this.defaultSelected) { const t = this.grouped ? this.flattenGroupedItems(this.items) : this.items; this.multiSelect ? (this.selectedItems = t.filter(t => this.defaultSelected.includes(t.title)), this.updateInput()) : (this.selectedItems = t.find(t => t.title === this.defaultSelected), this.container.value = this.selectedItems ? this.selectedItems.title : "") } } flattenGroupedItems(t) { return t.reduce((t, e) => t.concat(e.children || []), []) } showDropdown(t) { if (this.dropdown && (this.cleanupEventListeners(), this.dropdown.remove()), this.dropdown = document.createElement("div"), this.dropdown.className = "zhenshangyin-dropdown", this.searchEnabled && !this.inputSearchEnabled) { const t = document.createElement("input"); t.type = "text", t.className = "zhenshangyin-dropdown-search", t.placeholder = "zh" === this.language ? "æœç´¢..." : "Search...", t.oninput = t => this.filterItems(t.target.value), this.dropdown.appendChild(t) } this.dropdown.style.minWidth = `${this.container.offsetWidth}px`, this.dropdown.style.width = "max-content", this.grouped ? this.items.forEach(t => this.createGroup(t)) : this.createItems(this.items); const e = () => { if (!this.dropdown) return; const t = this.container.getBoundingClientRect(), e = (this.container.offsetHeight, window.innerHeight - t.bottom), s = t.top + window.scrollY; document.body.contains(this.dropdown) || document.body.appendChild(this.dropdown); const i = this.dropdown.offsetHeight, n = this.dropdown.offsetWidth; this.dropdown.classList.add("zhenshangyin-dropdown-show"), e >= i ? (this.dropdown.classList.add("zhenshangyin-dropdown-down"), this.dropdown.classList.remove("zhenshangyin-dropdown-up"), this.dropdown.style.top = `${t.bottom + window.scrollY}px`) : s >= i ? (this.dropdown.classList.add("zhenshangyin-dropdown-up"), this.dropdown.classList.remove("zhenshangyin-dropdown-down"), this.dropdown.style.top = s - i + "px") : (this.dropdown.classList.add("zhenshangyin-dropdown-down"), this.dropdown.classList.remove("zhenshangyin-dropdown-up"), this.dropdown.style.top = `${t.bottom + window.scrollY}px`), t.left + n <= window.innerWidth ? this.dropdown.style.left = `${t.left + window.scrollX}px` : window.innerWidth - t.right >= n ? this.dropdown.style.left = t.right + window.scrollX - n + "px" : this.dropdown.style.left = `${t.left + window.scrollX}px` }; this.scrollHandler = () => { this.dropdown && document.body.contains(this.dropdown) ? e() : this.cleanupEventListeners() }, this.resizeHandler = () => { this.dropdown && document.body.contains(this.dropdown) ? e() : this.cleanupEventListeners() }, window.addEventListener("scroll", this.scrollHandler), window.addEventListener("resize", this.resizeHandler), e(), this.documentClickHandler && document.removeEventListener("click", this.documentClickHandler), this.documentClickHandler = this.removeDropdown.bind(this), document.addEventListener("click", this.documentClickHandler), this.focusinHandler && document.removeEventListener("focusin", this.focusinHandler), this.focusinHandler = t => { this.dropdown && (this.dropdown.contains(t.target) || t.target === this.container) || this.removeDropdown(t) }, document.addEventListener("focusin", this.focusinHandler) } cleanupEventListeners() { this.scrollHandler && window.removeEventListener("scroll", this.scrollHandler), this.resizeHandler && window.removeEventListener("resize", this.resizeHandler), this.documentClickHandler && document.removeEventListener("click", this.documentClickHandler), this.focusinHandler && document.removeEventListener("focusin", this.focusinHandler) } removeDropdown(t) { this.dropdown && (this.dropdown.contains(t.target) || t.target === this.container) || this.dropdown && (this.dropdown.classList.remove("zhenshangyin-dropdown-show"), this.dropdown.classList.remove("zhenshangyin-dropdown-down"), this.dropdown.classList.remove("zhenshangyin-dropdown-up"), this.cleanupEventListeners(), setTimeout(() => { this.dropdown && (this.dropdown.remove(), this.dropdown = null) }, 300)) } createGroup(t) { const e = document.createElement("div"); e.className = "zhenshangyin-dropdown-group"; const s = document.createElement("div"); s.className = "zhenshangyin-dropdown-group-title", s.textContent = t.groupTitle || ("zh" === this.language ? "åˆ†ç»„" : "Group"), e.appendChild(s), this.createItems(t.children, e), this.dropdown.appendChild(e) } createItems(t, e = this.dropdown) { t.forEach(t => { const s = document.createElement("div"); s.className = "zhenshangyin-dropdown-item", t.disabled ? s.classList.add("zhenshangyin-dropdown-item-disabled") : s.onclick = () => this.selectItem(t), s.textContent = t.title, e.appendChild(s), (this.multiSelect && this.selectedItems.some(e => e.title === t.title) || !this.multiSelect && this.selectedItems && this.selectedItems.title === t.title) && s.classList.add(this.multiSelect ? "zhenshangyin-dropdown-item-selected-multiSelect" : "zhenshangyin-dropdown-item-selected") }) } filterItems(t) { if (this.grouped) { const e = this.items.map(e => { const s = e.children.filter(e => e.title.toLowerCase().includes(t.toLowerCase())); return { ...e, children: s } }).filter(t => t.children.length > 0); this.updateGroupedDropdown(e) } else { const e = this.items.filter(e => e.title.toLowerCase().includes(t.toLowerCase())); this.updateDropdown(e) } } updateGroupedDropdown(t) { this.dropdown.querySelectorAll(".zhenshangyin-dropdown-group").forEach(t => t.remove()), t.forEach(t => this.createGroup(t)) } updateDropdown(t) { this.dropdown.querySelectorAll(".zhenshangyin-dropdown-item").forEach(t => t.remove()), this.createItems(t) } selectItem(t) { if (!t.disabled) { if (this.multiSelect) { this.selectedItems.some(e => e.title === t.title) ? this.selectedItems = this.selectedItems.filter(e => e.title !== t.title) : this.selectedItems.push(t), this.updateInput(); this.dropdown.querySelectorAll(".zhenshangyin-dropdown-item").forEach(t => { this.selectedItems.some(e => e.title === t.textContent) ? t.classList.add("zhenshangyin-dropdown-item-selected-multiSelect") : t.classList.remove("zhenshangyin-dropdown-item-selected-multiSelect") }) } else { this.container.value = t.title; this.dropdown.querySelectorAll(".zhenshangyin-dropdown-item-selected").forEach(t => { t.classList.remove("zhenshangyin-dropdown-item-selected") }); const e = [...this.dropdown.children].find(e => e.textContent === t.title); e && e.classList.add("zhenshangyin-dropdown-item-selected"), this.selectedItems = t, this.dropdown.classList.remove("zhenshangyin-dropdown-show"), this.dropdown.classList.remove("zhenshangyin-dropdown-down"), this.dropdown.classList.remove("zhenshangyin-dropdown-up"), setTimeout(() => { this.dropdown.remove() }, 300) } this.onSelect(t) } } updateInput() { this.inputMultiSelect ? this.container.value = this.selectedItems.map(t => t.title).join(", ") : (this.container.innerHTML = "", this.selectedItems.forEach((t, e) => { const s = t.title, i = this.createRemoveButton(t), n = document.createElement("div"); n.classList.add("zhenshangyin-dropdown-multiSelect"), n.textContent = s, n.appendChild(i), this.container.appendChild(n) })) } createRemoveButton(t) { const e = document.createElement("div"); return e.classList.add("zhenshangyin-dropdown-multiSelect-Button"), e.textContent = " Ã—", e.onclick = e => { e.stopPropagation(), this.removeItem(t) }, e } removeItem(t) { this.selectedItems = this.selectedItems.filter(e => e.title !== t.title), this.updateInput() } } class ZhenshangyinLinkage { constructor(t) { this.inputElements = t.multiInputs ? t.multiInputs.map(t => document.querySelector(t)) : [document.querySelector(t.container)], this.inputElements.length && !this.inputElements.every(t => !t) && (this.data = t.data, this.callback = t.callback || function () { }, this.onFinish = t.onFinish || function () { }, this.separator = t.separator || " / ", this.language = t.language || "zh", this.menu = null, this.isMultiInputMode = t.multiInputs && t.multiInputs.length > 1, this.selectedValues = [], this.uniqueClassName = `zhenshangyin-linkage-${Math.random().toString(36).substring(2, 15)}`, this.currentLevel = 0, this.navigationHistory = [], this.isMobile = window.innerWidth <= 768, this.translations = { zh: { backText: "è¿”å›žä¸Šä¸€çº§" }, en: { backText: "Return to previous" } }, this.init()) } init() { this.inputElements.length && !this.inputElements.every(t => !t) && (window.addEventListener("resize", () => { this.isMobile = window.innerWidth <= 768 }), this.inputElements.forEach((t, e) => { t && "input" === t.tagName.toLowerCase() && this.bindEvents(t, e) })) } createDropdownMenu() { this.menu || (this.menu = document.createElement("div"), this.menu.className = `zhenshangyin-dropdown-menu ${this.uniqueClassName}`, document.body.appendChild(this.menu)) } adjustMenuPosition() { if (!this.menu) return; const t = (() => { const t = document.createElement("div"); t.style.visibility = "hidden", t.style.overflow = "scroll", document.body.appendChild(t); const e = document.createElement("div"); t.appendChild(e); const s = t.offsetWidth - e.offsetWidth; return t.parentNode.removeChild(t), s })(), e = this.menu.getBoundingClientRect().width, s = window.innerWidth - t - 20; if (e > s) { this.menu.style.maxWidth = `${s}px`, this.menu.classList.add("zhenshangyin-dropdown-wrap"); this.menu.querySelectorAll(".zhenshangyin-dropdown-list").forEach(t => { t.style.maxHeight = "200px", t.style.minWidth = "150px", t.style.flexGrow = "1" }) } else this.menu.classList.remove("zhenshangyin-dropdown-wrap"); const i = this.menu.getBoundingClientRect(); if (i.right > window.innerWidth - t) { const e = Math.max(5, window.innerWidth - t - i.width - 10); this.menu.style.left = `${e}px` } i.left < 0 && (this.menu.style.left = "5px") } bindEvents(t, e) { t.addEventListener("click", s => { s.stopPropagation(); let i; if (document.querySelectorAll(".zhenshangyin-dropdown-menu").forEach(t => { t.classList.remove("zhenshangyin-dropdown-show"), t.classList.remove("zhenshangyin-dropdown-down"), t.classList.remove("zhenshangyin-dropdown-up"), setTimeout(() => { t && t.parentNode && t.parentNode.removeChild(t) }, 300) }), this.menu = null, this.createDropdownMenu(), this.currentLevel = this.isMultiInputMode ? e : 0, this.navigationHistory = [], this.isMultiInputMode) if (0 === e) i = this.data; else { let t = this.data; for (let s = 0; s < e; s++) { const e = this.selectedValues[s], i = t.find(t => t.name === e); if (!i || !i.children) { t = []; break } t = i.children } i = t } else i = 0 === e ? this.data : this.getSubData(e); this.showDropdown(t, i, e) }), document.addEventListener("click", e => { if (this.menu && !this.menu.contains(e.target)) { !this.inputElements.some(s => s && s.contains(e.target) && s !== t) && this.inputElements.some(t => t && t.contains(e.target)) || this.closeDropdown() } }) } showDropdown(t, e, s) { if (this.menu.innerHTML = "", this.isMobile) { const i = document.createElement("ul"); if (i.className = "zhenshangyin-dropdown-list", i.style.maxHeight = "300px", i.style.overflow = "auto", this.navigationHistory.length > 0) { const e = document.createElement("div"); e.className = "zhenshangyin-dropdown-back", e.textContent = this.translations[this.language]?.backText || "è¿”å›žä¸Šä¸€çº§", e.style.cursor = "pointer", e.style.position = "sticky", e.style.top = "0", e.style.zIndex = "20", e.style.backgroundColor = "#fff", i.appendChild(e), e.onclick = e => { e.stopPropagation(); const s = this.navigationHistory.pop(); this.navigateToLevel(t, s.level, s.data) } } this.menu.appendChild(i), this.populateList(e, i, s), this.bindListEvents(i, s, t), this.menu.scrollTop = 0, i.scrollTop = 0 } else { const i = document.createElement("ul"); if (i.className = "zhenshangyin-dropdown-list", this.menu.appendChild(i), this.isMultiInputMode) this.populateList(e, i, s), this.bindListEvents(i, s, t); else if (this.populateList(this.data, i, 0), this.bindListEvents(i, 0, t), this.selectedValues.length > 0) { let e = this.data; for (let s = 0; s < this.selectedValues.length; s++) { const i = this.selectedValues[s], n = e.find(t => t.name === i); if (!(n && n.children && n.children.length > 0)) break; { e = n.children; const i = document.createElement("ul"); i.className = "zhenshangyin-dropdown-list", this.menu.appendChild(i), this.populateList(e, i, s + 1), this.bindListEvents(i, s + 1, t) } } } } requestAnimationFrame(() => { const e = () => { if (!this.menu) return; const e = (() => { const t = document.createElement("div"); t.style.visibility = "hidden", t.style.overflow = "scroll", document.body.appendChild(t); const e = document.createElement("div"); t.appendChild(e); const s = t.offsetWidth - e.offsetWidth; return t.parentNode.removeChild(t), s })(), s = t.getBoundingClientRect(), i = t.offsetHeight, n = window.innerHeight - s.bottom, a = s.top + window.scrollY, o = this.menu.offsetHeight, r = this.menu.offsetWidth, h = window.innerWidth - e - s.left; this.menu.classList.add("zhenshangyin-dropdown-show"), this.menu.style.left = h < r ? `${Math.max(5, window.innerWidth - e - r - 10)}px` : `${s.left + window.scrollX}px`, n < o && a < o ? (this.menu.style.top = `${a + i}px`, this.menu.classList.add("zhenshangyin-dropdown-down"), this.menu.classList.remove("zhenshangyin-dropdown-up"), s.bottom + o > window.innerHeight && (this.menu.style.maxHeight = window.innerHeight - s.bottom - 10 + "px")) : n < o ? (this.menu.style.top = a - o + "px", this.menu.classList.add("zhenshangyin-dropdown-up"), this.menu.classList.remove("zhenshangyin-dropdown-down"), a - o < 0 && (this.menu.style.top = "5px", this.menu.style.maxHeight = s.top - 10 + "px")) : (this.menu.style.top = `${a + i}px`, this.menu.classList.add("zhenshangyin-dropdown-down"), this.menu.classList.remove("zhenshangyin-dropdown-up"), s.bottom + o > window.innerHeight && (this.menu.style.maxHeight = window.innerHeight - s.bottom - 10 + "px")), this.adjustMenuPosition() }; window.addEventListener("scroll", e), window.addEventListener("resize", e), e() }) } navigateToLevel(t, e, s) { this.currentLevel = e; const i = this.menu.querySelector(".zhenshangyin-dropdown-list"); if (i.innerHTML = "", this.navigationHistory.length > 0) { const e = document.createElement("div"); e.className = "zhenshangyin-dropdown-back", e.textContent = this.translations[this.language]?.backText || "è¿”å›žä¸Šä¸€çº§", e.style.cursor = "pointer", i.appendChild(e), e.onclick = e => { e.stopPropagation(); const s = this.navigationHistory.pop(); this.navigateToLevel(t, s.level, s.data) } } this.populateList(s, i, e), this.bindListEvents(i, e, t), this.menu && (this.menu.scrollTop = 0), i && (i.scrollTop = 0) } bindListEvents(t, e, s) { const i = t.querySelectorAll("li:not(.zhenshangyin-dropdown-back)"); i.forEach(t => { t.addEventListener("click", n => { n.stopPropagation(), i.forEach(t => t.classList.remove("zhenshangyin-dropdown-selected")), t.classList.add("zhenshangyin-dropdown-selected"); const a = t.textContent, o = t.dataset.children ? JSON.parse(t.dataset.children) : []; if (this.updateSelection(e, a), 0 === o.length || this.isMultiInputMode) return 0 === o.length && this.onFinish(this.getFullSelection()), void this.closeDropdown(); if (this.isMobile) this.navigationHistory.push({ level: e, data: 0 === e ? this.data : this.getSubData(e) }), this.menu && (this.menu.scrollTop = 0), this.navigateToLevel(s, e + 1, o); else { this.clearLowerLevelMenus(e + 1); const t = document.createElement("ul"); t.className = "zhenshangyin-dropdown-list", this.menu.appendChild(t), this.populateList(o, t, e + 1), this.bindListEvents(t, e + 1, s), requestAnimationFrame(() => { this.adjustMenuPosition() }) } }) }) } populateList(t, e, s) { const i = t.map(t => { const e = this.selectedValues[s] === t.name; return `<li data-children='${t.children ? JSON.stringify(t.children) : "[]"}' class="${e ? "zhenshangyin-dropdown-selected" : ""}">${t.name}</li>` }).join(""), n = e.querySelector(".zhenshangyin-dropdown-back"); if (n) { const t = n.outerHTML; e.innerHTML = "", e.innerHTML = t + i; const s = e.querySelector(".zhenshangyin-dropdown-back"); s && (s.onclick = n.onclick) } else e.innerHTML = i } updateSelection(t, e) { this.selectedValues[t] = e; for (let e = t + 1; e < this.selectedValues.length; e++)this.selectedValues[e] = null; if (this.isMultiInputMode) { const s = this.inputElements[t]; s && (s.value = e); for (let e = t + 1; e < this.inputElements.length; e++)this.inputElements[e].value = "" } else { this.inputElements[0].value = this.selectedValues.filter(Boolean).join(this.separator) } this.callback(this.getFullSelection()) } getSubData(t) { let e = this.data; for (let s = 0; s < t; s++) { const t = this.selectedValues[s], i = e.find(e => e.name === t); e = i && i.children ? i.children : [] } return e } getFullSelection() { return this.selectedValues.filter(Boolean).join(this.separator) } clearLowerLevelMenus(t) { const e = this.menu.querySelectorAll(".zhenshangyin-dropdown-list"); for (let s = t; s < e.length; s++)e[s].parentNode.removeChild(e[s]) } closeDropdown() { this.menu && (this.menu.classList.remove("zhenshangyin-dropdown-show"), this.menu.classList.remove("zhenshangyin-dropdown-down"), this.menu.classList.remove("zhenshangyin-dropdown-up"), setTimeout(() => { this.menu && this.menu.parentNode && (this.menu.parentNode.removeChild(this.menu), this.menu = null) }, 300)) } } class ZhenshangyinInfiniteScroll { constructor(t, e = {}) { const s = "string" == typeof t ? document.querySelector(t) : t; s && s instanceof HTMLElement && (this.container = s, this.direction = e.direction || "left", ["up", "down", "left", "right"].includes(this.direction) && (this.hoverPause = !1 !== e.hoverPause, this.isRunning = !1, this.isPaused = !1, this.animationFrame = null, this.lastTimestamp = 0, this.scrollPosition = 0, this.originalCount = 0, this.segmentSize = 0, this.baseOffset = 0, this.init())) } init() { this.container.style.overflow = "hidden", this.container.style.display = "flex", this.container.style.flexDirection = this.isVertical ? "column" : "row", this.container.style.flexWrap = "nowrap"; const t = Array.from(this.container.children); if (this.originalCount = t.length, 0 === this.originalCount) return; const e = this.calculateRequiredClones(); this.container.innerHTML = "", t.forEach(t => { this.container.appendChild(t.cloneNode(!0)) }); for (let s = 0; s < e; s++)t.forEach(t => { this.container.appendChild(t.cloneNode(!0)) }); this.applyFixedChildFlex(), this.hoverPause && this.bindHoverEvents(), window.addEventListener("resize", () => { this.remeasureAndReset() }), this.remeasureAndReset(), this.start() } applyFixedChildFlex() { Array.from(this.container.children).forEach(t => { t.style.flex = "0 0 auto" }) } calculateRequiredClones() { if (0 === this.originalCount) return 0; const t = this.isVertical ? this.container.offsetHeight : this.container.offsetWidth; let e = 0; const s = this.container.cloneNode(!1); s.style.position = "absolute", s.style.visibility = "hidden", s.style.display = "flex", s.style.flexDirection = this.isVertical ? "column" : "row", s.style.flexWrap = "nowrap"; Array.from(this.container.children).forEach(t => { s.appendChild(t.cloneNode(!0)) }), document.body.appendChild(s); Array.from(s.children).forEach(t => { e += this.isVertical ? t.offsetHeight : t.offsetWidth }), document.body.removeChild(s); if (0 === e) return 2; const i = Math.ceil(2 * t / e); return Math.max(2, i) } get isVertical() { return "up" === this.direction || "down" === this.direction } get isReverse() { return "down" === this.direction || "right" === this.direction } remeasureAndReset() { this.segmentSize = this.measureSegmentSize(), this.baseOffset = this.segmentSize, this.scrollPosition = 0, this.applyFixedChildFlex(), this.applyScroll() } bindHoverEvents() { this.container.addEventListener("mouseenter", () => { this.isPaused = !0, this.animationFrame && (cancelAnimationFrame(this.animationFrame), this.animationFrame = null) }), this.container.addEventListener("mouseleave", () => { this.isPaused = !1, this.isRunning && (this.lastTimestamp = performance.now(), this.animate()) }) } applyScroll() { const t = this.isReverse ? -this.scrollPosition : this.scrollPosition, e = this.baseOffset + t; this.isVertical ? this.container.scrollTop = e : this.container.scrollLeft = e } measureSegmentSize() { const t = Array.from(this.container.children); let e = 0; for (let s = 0; s < this.originalCount; s++) { const i = t[s]; e += this.isVertical ? i.offsetHeight : i.offsetWidth } return e } start() { this.isRunning || (this.isRunning = !0, this.lastTimestamp = performance.now(), this.animate()) } animate() { const t = performance.now(), e = t - this.lastTimestamp; this.lastTimestamp = t; const s = 50 * e / 1e3; this.scrollPosition += s, this.scrollPosition >= this.segmentSize && (this.scrollPosition -= this.segmentSize), this.applyScroll(), this.isRunning && !this.isPaused && (this.animationFrame = requestAnimationFrame(() => this.animate())) } } class ZhenshangyinNumberScroll { constructor(t = {}) { this.className = t.className, this.duration = t.duration || 2e3, this.elements = [], this.init() } init() { const t = document.getElementsByClassName(this.className); t && 0 !== t.length && (this.elements = Array.prototype.slice.call(t), this.bindScrollEvent()) } bindScrollEvent() { const t = new IntersectionObserver(e => { e.forEach(e => { e.isIntersecting && (this.scrollNumber(e.target), t.unobserve(e.target)) }) }, { threshold: .1 }); this.elements.forEach(e => { const s = parseInt(e.textContent.trim()) || 0; e.setAttribute("data-target", s), e.textContent = "0", e && !isNaN(s) && t.observe(e) }) } scrollNumber(t) { const e = parseInt(t.getAttribute("data-target")), s = this.duration, i = performance.now(), n = a => { const o = a - i, r = Math.min(o / s, 1), h = 1 - Math.pow(1 - r, 3), l = Math.round(e * h); t.textContent = l, r < 1 ? requestAnimationFrame(n) : t.textContent = e }; requestAnimationFrame(n) } } class ZhenshangyinImageViewer { constructor(t, e = {}) { this.options = { zoomRatio: .1, minZoom: .1, maxZoom: 5, showThumbnails: !0, autoplayInterval: 3e3, imageSelector: "img", triggerSelector: null, ...e }, this.rootContainers = this._getContainers(t), this.rootContainers.length && (this.state = { containerImages: new Map, currentContainer: null, currentIndex: 0, scale: 1, moveX: 0, moveY: 0, rotation: 0, isMoving: !1, isPinching: !1, isAutoPlaying: !1, autoplayTimer: null, viewer: null, startX: 0, startY: 0, initialDistance: 0, initialPinchScale: 1, moveRAF: null, switchTimer: null }, this._init()) } _getContainers(t) { return "string" == typeof t ? Array.from(document.querySelectorAll(t)) : t instanceof Element ? [t] : Array.isArray(t) ? t : [] } _init() { this.rootContainers.forEach(t => { t.addEventListener("click", e => { const s = e.target.closest(this.options.imageSelector); if (s) { this.state.currentContainer = t; const e = Array.from(t.querySelectorAll(this.options.imageSelector)).indexOf(s); this.show(e) } }), this._updateContainerImages(t) }) } _updateContainerImages(t) { const e = Array.from(t.querySelectorAll(this.options.imageSelector)); this.state.containerImages.set(t, e) } createViewer() { const t = "M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z", e = "M7.11 8.53L5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z", s = "M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z", i = "M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z", n = "M8 5v14l11-7z", a = "M6 19h4V5H6v14zm8-14v14h4V5h-4z", o = "M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z", r = "M19 13H5v-2h14v2z", h = "M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z", l = "M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z", c = (t, e, s = "") => `<button class="${t}"><svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="${e}"/></svg>${s}</button>`; this.state.viewer = document.createElement("div"), this.state.viewer.className = "zhenshangyin-image-viewer", this.state.viewer.innerHTML = `\n            <div class="zhenshangyin-viewer-mask"></div>\n            <div class="zhenshangyin-viewer-container">\n                <div class="zhenshangyin-viewer-canvas"></div>\n                <div class="zhenshangyin-viewer-footer">\n                    <div class="zhenshangyin-viewer-thumbnails"></div>\n                    <div class="zhenshangyin-viewer-toolbar">\n                        ${c("zhenshangyin-viewer-prev", t)}\n                        ${c("zhenshangyin-viewer-rotate-left", e)}\n                        ${c("zhenshangyin-viewer-rotate-right", s)}\n                        ${c("zhenshangyin-viewer-reset", i)}\n                        ${c("zhenshangyin-viewer-autoplay", n, `<svg viewBox="0 0 24 24" width="20" height="20" class="pause-icon" style="display:none"><path fill="currentColor" d="${a}"/></svg>`)}\n                        ${c("zhenshangyin-viewer-zoom-in", o)}\n                        ${c("zhenshangyin-viewer-zoom-out", r)}\n                        ${c("zhenshangyin-viewer-close", h)}\n                        ${c("zhenshangyin-viewer-next", l)}\n                    </div>\n                </div>\n            </div>\n        `, document.body.appendChild(this.state.viewer), this._cacheElements(), this.options.showThumbnails ? this.createThumbnails() : this.state.thumbnailsContainer.style.display = "none" } _cacheElements() { Object.entries({ mask: ".zhenshangyin-viewer-mask", container: ".zhenshangyin-viewer-container", canvas: ".zhenshangyin-viewer-canvas", toolbar: ".zhenshangyin-viewer-toolbar", thumbnailsContainer: ".zhenshangyin-viewer-thumbnails" }).forEach(([t, e]) => { this.state[t] = this.state.viewer.querySelector(e) }) } createThumbnails() { if (!this.state.thumbnailsContainer) return; const t = this.state.containerImages.get(this.state.currentContainer); if (!t || !t.length) return; const e = new Map; t.forEach((t, s) => { e.has(t.src) ? e.get(t.src).push(s) : e.set(t.src, [s]) }), this.state.thumbnailsContainer.innerHTML = "", e.forEach((e, s) => { const i = document.createElement("img"); i.className = "zhenshangyin-viewer-thumbnail", e.includes(this.state.currentIndex) && i.classList.add("active"), i.src = s, i.alt = t[e[0]].alt, i.addEventListener("click", () => this._handleThumbnailClick(e)), this.state.thumbnailsContainer.appendChild(i) }) } _handleThumbnailClick(t) { const e = this.state.currentIndex, s = this.state.containerImages.get(this.state.currentContainer); if (!s) return; let i = t[0]; const n = t.indexOf(e); if (-1 !== n && n < t.length - 1 && (i = t[n + 1]), i !== e) { this.state.thumbnailsContainer.querySelectorAll(".zhenshangyin-viewer-thumbnail").forEach(t => t.classList.remove("active")); const t = this.state.thumbnailsContainer.querySelectorAll(".zhenshangyin-viewer-thumbnail"), e = Array.from(t).findIndex(t => t.src === s[i].src); -1 !== e && t[e].classList.add("active"), this.show(i) } } bindEvents() { const t = { "zhenshangyin-viewer-zoom-in": () => this.zoom(this.state.scale + this.options.zoomRatio), "zhenshangyin-viewer-zoom-out": () => this.zoom(this.state.scale - this.options.zoomRatio), "zhenshangyin-viewer-rotate-left": () => this.rotate(-90), "zhenshangyin-viewer-rotate-right": () => this.rotate(90), "zhenshangyin-viewer-close": () => this.hide(), "zhenshangyin-viewer-autoplay": () => this.toggleAutoplay(), "zhenshangyin-viewer-reset": () => this.resetCurrentImage() }; this.state.toolbar && this.state.toolbar.addEventListener("click", e => { const s = e.target.closest("button"); s && Object.entries(t).forEach(([t, e]) => { s.classList.contains(t) && e() }) }), ["prev", "next"].forEach(t => { const e = this.state.viewer.querySelector(`.zhenshangyin-viewer-${t}`); e && e.addEventListener("click", () => this[t]()) }), this.state.mask && this.state.mask.addEventListener("click", () => this.hide()), this.state.canvas && this.state.canvas.addEventListener("click", t => t.target === this.state.canvas && this.hide()), this.state.canvas && (this.state.canvas.addEventListener("mousedown", this.onMouseDown.bind(this)), document.addEventListener("mousemove", this.onMouseMove.bind(this)), document.addEventListener("mouseup", this.onMouseUp.bind(this)), this.state.canvas.addEventListener("mouseleave", this.onMouseUp.bind(this))), this.state.canvas && ["touchstart", "touchmove", "touchend", "touchcancel"].forEach(t => { const e = `onTouch${t.slice(5)}`; this[e] && this.state.canvas.addEventListener(t, this[e].bind(this), { passive: !1 }) }), document.addEventListener("keydown", t => { const e = { Escape: () => this.hide(), ArrowLeft: () => this.prev(), ArrowRight: () => this.next() }; e[t.key]?.() }), this.state.canvas && this.state.canvas.addEventListener("wheel", t => { t.preventDefault(); const e = t.deltaY > 0 ? -1 : 1; this.zoom(this.state.scale + e * this.options.zoomRatio) }), document.addEventListener("fullscreenchange", () => { document.fullscreenElement || this.stopAutoplay() }) } show(t) { this.state.currentIndex = t, this.state.viewer || (this.createViewer(), this.bindEvents()), this._updateContainerImages(this.state.currentContainer); const e = this.state.containerImages.get(this.state.currentContainer); this.state.isAutoPlaying && (clearInterval(this.state.autoplayTimer), this.state.autoplayTimer = setInterval(() => { this.state.currentIndex < e.length - 1 ? this.next() : this.show(0) }, this.options.autoplayInterval)), this.state.viewer.style.display = "block", this.state.viewer.offsetHeight, this.state.viewer.classList.add("show"), this.loadImage(e[t].src), this.options.showThumbnails && this.createThumbnails() } _updateThumbnails(t) { if (!this.options.showThumbnails) return; this.state.thumbnailsContainer.querySelectorAll(".zhenshangyin-viewer-thumbnail").forEach(e => { e.src === t ? (e.classList.add("active"), e.scrollIntoView({ behavior: "smooth", block: "nearest", inline: "center" })) : e.classList.remove("active") }) } hide() { this.state.viewer && (this.state.viewer.classList.remove("show"), setTimeout(() => { this.state.isAutoPlaying && this.stopAutoplay(), this.reset(), this.state.viewer.remove(), this.state.viewer = null }, 300)) } reset() { Object.assign(this.state, { scale: 1, moveX: 0, moveY: 0, rotation: 0 }) } loadImage(t) { this.state.switchTimer && (clearTimeout(this.state.switchTimer), this.state.switchTimer = null), this.reset(), this.state.canvas.querySelectorAll("img.slide-exit, img.slide-exit-active, img.slide-enter, img.slide-enter-active").forEach(t => t.remove()); const e = new Image; e.src = t, e.onload = () => { for (; this.state.canvas.firstChild;)this.state.canvas.firstChild.remove(); e.classList.add("slide-enter"), e.style.cursor = "grab", this.state.canvas.appendChild(e), e.offsetHeight, e.classList.add("slide-enter-active"), this.state.switchTimer = setTimeout(() => e.classList.remove("slide-enter", "slide-enter-active"), 300), this.updateImageTransform() } } updateImageTransform() { const t = this.state.canvas.querySelector("img"); t && (t.style.transition = this.state.isMoving || this.state.isPinching ? "none" : "transform 0.3s ease", t.style.transform = `translate3d(-50%, -50%, 0) translate3d(${this.state.moveX}px, ${this.state.moveY}px, 0) scale(${this.state.scale}) rotate(${this.state.rotation || 0}deg)`) } zoom(t) { this.state.scale = Math.min(Math.max(t, this.options.minZoom), this.options.maxZoom), this.updateImageTransform() } rotate(t) { this.state.rotation = (this.state.rotation || 0) + t, this.updateImageTransform() } prev() { const t = this.state.containerImages.get(this.state.currentContainer); this.show(this.state.currentIndex > 0 ? this.state.currentIndex - 1 : t.length - 1) } next() { const t = this.state.containerImages.get(this.state.currentContainer); this.show(this.state.currentIndex < t.length - 1 ? this.state.currentIndex + 1 : 0) } onMouseDown(t) { const e = t.target.closest("img") || t.target; "img" === e.tagName.toLowerCase() && (t.preventDefault(), this.state.isMoving = !0, this.state.startX = t.clientX - this.state.moveX, this.state.startY = t.clientY - this.state.moveY, e.style.cursor = "grabbing") } onMouseMove(t) { this.state.isMoving && (this.state.moveRAF && cancelAnimationFrame(this.state.moveRAF), this.state.moveRAF = requestAnimationFrame(() => { this.state.moveX = t.clientX - this.state.startX, this.state.moveY = t.clientY - this.state.startY, this.updateImageTransform() })) } onMouseUp() { if (!this.state.isMoving) return; this.state.isMoving = !1; const t = this.state.canvas.querySelector("img"); t && (t.style.cursor = "grab"), this.state.moveRAF && (cancelAnimationFrame(this.state.moveRAF), this.state.moveRAF = null) } toggleAutoplay() { const t = this.state.toolbar.querySelector(".zhenshangyin-viewer-autoplay"), [e, s] = t.querySelectorAll("svg"); this.state.isAutoPlaying ? (this.stopAutoplay(), [e.style.display, s.style.display] = ["", "none"]) : (this.startAutoplay(), [e.style.display, s.style.display] = ["none", ""]) } startAutoplay() { this.state.isAutoPlaying || (this.state.isAutoPlaying = !0, this.resetCurrentImage(), this.state.viewer && document.fullscreenEnabled && !document.fullscreenElement && this.state.viewer.classList.add("fullscreen"), this.state.autoplayTimer = setInterval(() => { const t = this.state.containerImages.get(this.state.currentContainer); this.state.currentIndex < t.length - 1 ? this.next() : this.show(0) }, this.options.autoplayInterval)) } stopAutoplay() { if (this.state.isAutoPlaying && (this.state.isAutoPlaying = !1, clearInterval(this.state.autoplayTimer), this.state.autoplayTimer = null, this.state.viewer)) { const t = this.state.viewer.querySelector(".zhenshangyin-viewer-autoplay"), [e, s] = t.querySelectorAll("svg");[e.style.display, s.style.display] = ["", "none"], this.state.viewer.classList.remove("fullscreen") } } resetCurrentImage() { this.reset(), this.updateImageTransform() } getDistance(t) { const [e, s] = t; return Math.sqrt(Math.pow(s.clientX - e.clientX, 2) + Math.pow(s.clientY - e.clientY, 2)) } onTouchStart(t) { const e = t.target.closest("img") || t.target; if ("img" !== e.tagName.toLowerCase()) return; t.preventDefault(); const s = t.touches; 1 === s.length ? (this.state.isMoving = !0, this.state.startX = s[0].clientX - this.state.moveX, this.state.startY = s[0].clientY - this.state.moveY, e.style.transition = "none") : 2 === s.length && (this.state.isMoving = !1, this.state.isPinching = !0, this.state.initialDistance = this.getDistance(s), this.state.initialPinchScale = this.state.scale) } onTouchMove(t) { (this.state.isMoving || this.state.isPinching) && (t.preventDefault(), this.state.moveRAF && cancelAnimationFrame(this.state.moveRAF), this.state.moveRAF = requestAnimationFrame(() => { const e = t.touches; if (this.state.isPinching && 2 === e.length) { const t = this.getDistance(e) / this.state.initialDistance; this.zoom(this.state.initialPinchScale * t) } else this.state.isMoving && 1 === e.length && (this.state.moveX = e[0].clientX - this.state.startX, this.state.moveY = e[0].clientY - this.state.startY, this.updateImageTransform()) })) } onTouchEnd(t) { if (0 === t.touches.length) { this.state.isMoving = !1, this.state.isPinching = !1; const t = this.state.canvas.querySelector("img"); t && (t.style.transition = "transform 0.3s ease") } else 1 === t.touches.length && this.state.isPinching && (this.state.isPinching = !1, this.state.isMoving = !0, this.state.startX = t.touches[0].clientX - this.state.moveX, this.state.startY = t.touches[0].clientY - this.state.moveY) } } class ZhenshangyinAnimate { static instances = new WeakMap; constructor(t, e = null) { return t ? this instanceof ZhenshangyinAnimate ? (this.element = t, this.selector = e, this.isAnimating = !1, this.animationDirection = null, this.targetHeight = null, this.lastHeight = null, this.originalStyles = null, void (this.currentFrame = null)) : ZhenshangyinAnimate.getInstance(t) : { fadeIn: () => this, fadeOut: () => this, fadeToggle: () => this, slideDown: () => this, slideUp: () => this, slideToggle: () => this } } static getInstance(t) { if ("string" == typeof t) { const e = t; if (!(t = document.querySelector(e))) return new ZhenshangyinAnimate(null); if (!this.instances.has(t)) { const s = new ZhenshangyinAnimate(t, e); this.instances.set(t, s) } return this.instances.get(t) } if (!t) return new ZhenshangyinAnimate(null); if (!this.instances.has(t)) { const e = new ZhenshangyinAnimate(t); this.instances.set(t, e) } return this.instances.get(t) } animate(t, e = 300, s) { if (!this.element) return this; this.stop(), this.isAnimating = !0; const i = performance.now(), n = {}, a = {}; for (const e in t) { const s = window.getComputedStyle(this.element); n[e] = parseFloat(s[e]) || 0, a[e] = parseFloat(t[e]) } const o = t => { const r = Math.min((t - i) / e, 1); for (const t in a) { const e = n[t], s = e + (a[t] - e) * r; this.element.style[t] = "opacity" === t ? s.toFixed(3) : `${Math.round(s)}px` } r < 1 ? this.currentFrame = requestAnimationFrame(o) : (this.isAnimating = !1, this.animationDirection = null, s && s.call(this.element)) }; return this.currentFrame = requestAnimationFrame(o), this } stop() { return this.currentFrame && (cancelAnimationFrame(this.currentFrame), this.currentFrame = null), this.isAnimating = !1, this } fadeIn(t = 300, e) { const s = this.element, i = window.getComputedStyle(s); return "none" !== i.display && 1 === parseFloat(i.opacity) ? (e && e.call(s), this) : (this.animationDirection = "in", s.style.opacity = "0", s.style.display = "block", this.animate({ opacity: 1 }, t, () => { s.style.removeProperty("opacity"), e && e.call(s) })) } fadeOut(t = 300, e) { const s = this.element; return "none" === window.getComputedStyle(s).display ? (e && e.call(s), this) : (this.animationDirection = "out", this.animate({ opacity: 0 }, t, () => { s.style.display = "none", s.style.removeProperty("opacity"), e && e.call(s) })) } fadeToggle(t = 300, e) { const s = window.getComputedStyle(this.element), i = "none" === s.display, n = 0 === parseFloat(s.opacity); if (this.isAnimating) { if ("in" === this.animationDirection) return this.fadeOut(t, e); if ("out" === this.animationDirection) return this.fadeIn(t, e) } return i || n ? this.fadeIn(t, e) : this.fadeOut(t, e) } slideDown(t = 300, e) { const s = this.element; if (!s) return this; const i = window.getComputedStyle(s), n = i.boxSizing; if ("none" !== i.display && !this.isAnimating && !this.lastHeight) return e && e.call(s), this; if (this.animationDirection = "down", this.originalStyles || (this.originalStyles = { paddingTop: parseFloat(i.paddingTop) || 0, paddingBottom: parseFloat(i.paddingBottom) || 0, marginTop: parseFloat(i.marginTop) || 0, marginBottom: parseFloat(i.marginBottom) || 0, borderTopWidth: parseFloat(i.borderTopWidth) || 0, borderBottomWidth: parseFloat(i.borderBottomWidth) || 0, opacity: parseFloat(i.opacity) || 1 }), !this.targetHeight) if (this.lastHeight) this.targetHeight = this.lastHeight; else { const t = s.style.display, e = s.style.height, i = s.style.visibility, a = s.style.padding, o = s.style.margin, r = s.style.border; s.style.display = "block", s.style.height = "", s.style.visibility = "hidden", s.style.padding = "0px", s.style.margin = "0px", s.style.border = "none"; const h = s.offsetHeight; s.style.display = t, s.style.height = e, s.style.visibility = i, s.style.padding = a, s.style.margin = o, s.style.border = r, this.targetHeight = "border-box" === n ? h + this.originalStyles.paddingTop + this.originalStyles.paddingBottom + this.originalStyles.borderTopWidth + this.originalStyles.borderBottomWidth : h } return s.style.display = "block", s.style.height = "0", s.style.paddingTop = "0", s.style.paddingBottom = "0", s.style.marginTop = "0", s.style.marginBottom = "0", s.style.overflow = "hidden", s.style.boxSizing = n, this.animate({ height: this.targetHeight, paddingTop: this.originalStyles.paddingTop, paddingBottom: this.originalStyles.paddingBottom, marginTop: this.originalStyles.marginTop, marginBottom: this.originalStyles.marginBottom, opacity: this.originalStyles.opacity }, t, () => { s.style.removeProperty("height"), s.style.removeProperty("padding-top"), s.style.removeProperty("padding-bottom"), s.style.removeProperty("margin-top"), s.style.removeProperty("margin-bottom"), s.style.removeProperty("overflow"), s.style.removeProperty("opacity"), s.style.removeProperty("box-sizing"), this.targetHeight = null, e && e.call(s) }) } slideUp(t = 300, e) { const s = this.element; if (!s) return this; const i = window.getComputedStyle(s), n = i.boxSizing; if ("none" === i.display && !this.isAnimating && !this.lastHeight) return e && e.call(s), this; if (this.animationDirection = "up", !this.lastHeight && !this.isAnimating) { const t = parseFloat(i.paddingTop) || 0, e = parseFloat(i.paddingBottom) || 0, a = parseFloat(i.borderTopWidth) || 0, o = parseFloat(i.borderBottomWidth) || 0; this.lastHeight = "border-box" === n ? s.offsetHeight : s.offsetHeight - t - e - a - o } const a = s.offsetHeight; return s.style.height = `${a}px`, s.style.overflow = "hidden", s.style.boxSizing = n, this.animate({ height: 0, paddingTop: 0, paddingBottom: 0, marginTop: 0, marginBottom: 0 }, t, () => { s.style.display = "none", s.style.removeProperty("height"), s.style.removeProperty("padding-top"), s.style.removeProperty("padding-bottom"), s.style.removeProperty("margin-top"), s.style.removeProperty("margin-bottom"), s.style.removeProperty("overflow"), s.style.removeProperty("box-sizing"), e && e.call(s) }) } slideToggle(t = 300, e) { if (!this.element) return this; const s = "none" === window.getComputedStyle(this.element).display; if (this.isAnimating) { if ("down" === this.animationDirection) return this.slideUp(t, e); if ("up" === this.animationDirection) return this.slideDown(t, e) } return this.lastHeight && s || s ? this.slideDown(t, e) : this.slideUp(t, e) } isVisible() { if (!this.element) return !1; const t = window.getComputedStyle(this.element), e = "none" === t.display, s = parseFloat(t.opacity) || 1, i = parseFloat(t.height) || this.element.offsetHeight; return !e && s > 0 && i > 0 } } class ZhenshangyinTextEffect { constructor(t, e = {}) { this.element = "string" == typeof t ? document.querySelector(t) : t, this.element && (this.threshold = e.threshold || 50, this.repeat = e.repeat || !1, this.mobile = e.mobile || !1, this.overlap = void 0 !== e.overlap ? Math.max(0, Math.min(1, e.overlap)) : .1, this.duration = e.duration || 500, this.random = e.random || !1, this.effects = e.effects ? Array.isArray(e.effects) ? e.effects : [e.effects] : null, this.isMobile() && !this.mobile || (this.animated = !1, this.entrySide = null, this._rafId = null, this._scrolling = !1, this._scrollStopTimer = null, this._onScroll = this.onScroll.bind(this), this._effectsActive = !1, this._fromTransform = null, this._toTransform = null, this._fromStyles = {}, this._toStyles = {}, this._seqT = {}, this._seqS = {}, this.charSpans = [], this.element.style.overflow = "hidden", this.initEffects(), this.splitText(), this.initObserver(), window.addEventListener("scroll", this._onScroll, { passive: !0 }))) } isMobile() { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768 && "ontouchstart" in window } initEffects() { if (!this.effects || 0 === this.effects.length) return this._effectsActive = !1, this._fromTransform = null, this._toTransform = null, this._fromStyles = {}, void (this._toStyles = {}); const t = ["translateX", "translateY", "skewX", "skewY", "scale", "rotate"], e = { translateX: null, translateY: null, skewX: null, skewY: null, scale: null, rotate: null }, s = { translateX: null, translateY: null, skewX: null, skewY: null, scale: null, rotate: null }, i = {}, n = {}; this._seqT = {}, this._seqS = {}, this.effects.forEach(t => { if (t && "object" == typeof t) { if (t.translateX && Array.isArray(t.translateX) && t.translateX.length >= 2) { const i = t.translateX.map(t => this.normalizeTranslate(t)); e.translateX = i[0], s.translateX = i[i.length - 1], i.length > 2 && (this._seqT.translateX = i) } if (t.translateY && Array.isArray(t.translateY) && t.translateY.length >= 2) { const i = t.translateY.map(t => this.normalizeTranslate(t)); e.translateY = i[0], s.translateY = i[i.length - 1], i.length > 2 && (this._seqT.translateY = i) } if (t.skewX && Array.isArray(t.skewX) && t.skewX.length >= 2) { const i = t.skewX.map(t => this.normalizeSkew(t)); e.skewX = i[0], s.skewX = i[i.length - 1], i.length > 2 && (this._seqT.skewX = i) } if (t.skewY && Array.isArray(t.skewY) && t.skewY.length >= 2) { const i = t.skewY.map(t => this.normalizeSkew(t)); e.skewY = i[0], s.skewY = i[i.length - 1], i.length > 2 && (this._seqT.skewY = i) } if (t.scale && Array.isArray(t.scale) && t.scale.length >= 2) { const i = t.scale.map(t => this.normalizeScale(t)); e.scale = i[0], s.scale = i[i.length - 1], i.length > 2 && (this._seqT.scale = i) } if (t.rotate && Array.isArray(t.rotate) && t.rotate.length >= 2) { const i = t.rotate.map(t => this.normalizeRotate(t)); e.rotate = i[0], s.rotate = i[i.length - 1], i.length > 2 && (this._seqT.rotate = i) } if (t.opacity && Array.isArray(t.opacity) && t.opacity.length >= 2) { const e = t.opacity.map(t => this.normalizeOpacity(t)); i.opacity = e[0], n.opacity = e[e.length - 1], e.length > 2 && (this._seqS.opacity = e) } if (t.color && Array.isArray(t.color) && t.color.length >= 2) { const e = t.color.map(t => String(t)); i.color = e[0], n.color = e[e.length - 1], e.length > 2 && (this._seqS.color = e) } if (t.fontSize && Array.isArray(t.fontSize) && t.fontSize.length >= 2) { const e = t.fontSize.map(t => this.normalizePx(t)); i.fontSize = e[0], n.fontSize = e[e.length - 1], e.length > 2 && (this._seqS.fontSize = e) } if (t.letterSpacing && Array.isArray(t.letterSpacing) && t.letterSpacing.length >= 2) { const e = t.letterSpacing.map(t => this.normalizePx(t)); i.letterSpacing = e[0], n.letterSpacing = e[e.length - 1], e.length > 2 && (this._seqS.letterSpacing = e) } } }); const a = [], o = []; t.forEach(t => { null !== e[t] && ("translateX" === t && a.push(`translateX(${e[t]})`), "translateY" === t && a.push(`translateY(${e[t]})`), "skewX" === t && a.push(`skewX(${e[t]})`), "skewY" === t && a.push(`skewY(${e[t]})`), "scale" === t && a.push(`scale(${e[t]})`), "rotate" === t && a.push(`rotate(${e[t]})`)), null !== s[t] && ("translateX" === t && o.push(`translateX(${s[t]})`), "translateY" === t && o.push(`translateY(${s[t]})`), "skewX" === t && o.push(`skewX(${s[t]})`), "skewY" === t && o.push(`skewY(${s[t]})`), "scale" === t && o.push(`scale(${s[t]})`), "rotate" === t && o.push(`rotate(${s[t]})`)) }), this._fromTransform = a.length ? a.join(" ") : null, this._toTransform = o.length ? o.join(" ") : null, this._fromStyles = i, this._toStyles = n, this._effectsActive = Boolean(this._fromTransform || this._toTransform || Object.keys(i).length || Object.keys(n).length), this._order = t } normalizeTranslate(t) { if (null == t) return null; if ("number" == typeof t) return `${t}px`; return String(t).trim() } normalizePx(t) { if (null == t) return null; if ("number" == typeof t) return `${t}px`; return String(t).trim() } normalizeScale(t) { if (null == t) return null; if ("number" == typeof t) return String(t); return String(t).trim() } normalizeRotate(t) { if (null == t) return null; if ("number" == typeof t) return `${t}deg`; return String(t).trim() } normalizeSkew(t) { if (null == t) return null; if ("number" == typeof t) return `${t}deg`; return String(t).trim() } normalizeOpacity(t) { if (null == t) return; const e = "number" == typeof t ? t : parseFloat(t); if (isNaN(e)) return; return Math.max(0, Math.min(1, e)) } splitText() { this.processNode(this.element) } processNode(t) { Array.from(t.childNodes).forEach(e => { if (e.nodeType === Node.TEXT_NODE) { const s = e.textContent; if (!s) return; const i = s.split(""), n = document.createDocumentFragment(); i.forEach(t => { const e = document.createElement("span"); " " === t ? e.textContent = " " : "\n" === t || "\r" === t || "\t" === t ? (e.textContent = "\t" === t ? "    " : " ", e.style.whiteSpace = "pre") : e.textContent = t, e.style.display = "inline-block", e.style.position = "relative", e.className = "text-effect-char", this.setInitialState(e), n.appendChild(e), this.charSpans.push(e) }), t.replaceChild(n, e) } else if (e.nodeType === Node.ELEMENT_NODE) { const t = e.tagName ? e.tagName.toLowerCase() : ""; if ("br" === t || "hr" === t || "img" === t || "input" === t || "button" === t || "wbr" === t) return; this.processNode(e) } }) } setInitialState(t) { this._effectsActive ? (null !== this._fromTransform && (t.style.transform = this._fromTransform), void 0 !== this._fromStyles.opacity && (t.style.opacity = String(this._fromStyles.opacity)), void 0 !== this._fromStyles.color && (t.style.color = this._fromStyles.color), void 0 !== this._fromStyles.fontSize && (t.style.fontSize = this._fromStyles.fontSize), void 0 !== this._fromStyles.letterSpacing && (t.style.letterSpacing = this._fromStyles.letterSpacing), t.style.transition = `all ${this.duration}ms ease-out`) : (t.style.opacity = "0", t.style.transform = "translateY(30px)", t.style.transition = `all ${this.duration}ms ease-out`) } animate() { const t = this.duration * this.overlap; let e = []; if (this.random) { e = Array.from({ length: this.charSpans.length }, (t, e) => e); for (let t = e.length - 1; t > 0; t--) { const s = Math.floor(Math.random() * (t + 1));[e[t], e[s]] = [e[s], e[t]] } } else e = Array.from({ length: this.charSpans.length }, (t, e) => e); e.forEach((e, s) => { setTimeout(() => { this.executeAnimation(this.charSpans[e]) }, s * t) }) } resetAnimation() { this.animated = !1, this.entrySide = null, this.charSpans.forEach(t => { this.setInitialState(t) }) } executeAnimation(t) { if (this._effectsActive) { void 0 !== this._toStyles.opacity ? t.style.opacity = String(this._toStyles.opacity) : t.style.opacity = "1", null !== this._toTransform ? t.style.transform = this._toTransform : t.style.transform = "translate(0, 0) scale(1) rotate(0deg)", void 0 !== this._toStyles.color && (t.style.color = this._toStyles.color), void 0 !== this._toStyles.fontSize && (t.style.fontSize = this._toStyles.fontSize), void 0 !== this._toStyles.letterSpacing && (t.style.letterSpacing = this._toStyles.letterSpacing); const e = [], s = (t, s) => { if (!Array.isArray(s) || s.length <= 2) return; const i = Math.max(1, Math.floor(this.duration / (s.length - 1))); for (let n = 1; n < s.length; n++)e.push({ delay: (n - 1) * i, dur: i, val: s[n], applyFn: t }) }, i = (t, e) => { this._order.forEach(s => { let i = null; s === t ? i = e : (this._toTransform && this._toTransform.includes(s), i = null, i = s in this._seqT && Array.isArray(this._seqT[s]) && this._seqT[s].length > 0 ? this._seqT[s][this._seqT[s].length - 1] : this._toStyles && null) }); const s = this._toTransform || "", i = { translateX: null, translateY: null, skewX: null, skewY: null, scale: null, rotate: null }; s.split(" ").forEach(t => { t && (t.startsWith("translateX(") ? i.translateX = t.slice(11, -1) : t.startsWith("translateY(") ? i.translateY = t.slice(11, -1) : t.startsWith("skewX(") ? i.skewX = t.slice(6, -1) : t.startsWith("skewY(") ? i.skewY = t.slice(6, -1) : t.startsWith("scale(") ? i.scale = t.slice(6, -1) : t.startsWith("rotate(") && (i.rotate = t.slice(7, -1))) }), t && (i[t] = e); const n = []; return this._order.forEach(t => { null !== i[t] && ("translateX" === t && n.push(`translateX(${i[t]})`), "translateY" === t && n.push(`translateY(${i[t]})`), "skewX" === t && n.push(`skewX(${i[t]})`), "skewY" === t && n.push(`skewY(${i[t]})`), "scale" === t && n.push(`scale(${i[t]})`), "rotate" === t && n.push(`rotate(${i[t]})`)) }), n.join(" ") }; Object.keys(this._seqT).forEach(e => { s(s => { t.style.transition = `all ${Math.max(1, Math.floor(this.duration / (this._seqT[e].length - 1)))}ms ease-out`, t.style.transform = i(e, s) }, this._seqT[e]) }), Object.keys(this._seqS).forEach(e => { s(s => { t.style.transition = `all ${Math.max(1, Math.floor(this.duration / (this._seqS[e].length - 1)))}ms ease-out`, "opacity" === e ? t.style.opacity = String(s) : "color" === e ? t.style.color = s : "fontSize" === e ? t.style.fontSize = s : "letterSpacing" === e && (t.style.letterSpacing = s) }, this._seqS[e]) }), e.forEach(t => { setTimeout(() => { t.applyFn(t.val) }, t.delay) }) } else t.style.opacity = "1", t.style.transform = "translate(0, 0) scale(1) rotate(0deg)" } startMonitoring() { if (this._rafId || this.animated || null === this.entrySide) return; const t = () => { if (this.animated || !this.element || !this._scrolling) return void (this._rafId = null); const e = this.element.getBoundingClientRect(), s = window.innerHeight; if (this.checkAndTriggerContinuous(e, s)) return this.animated = !0, this.animate(), this._rafId = null, window.removeEventListener("scroll", this._onScroll, { passive: !0 }), void (this._scrollStopTimer && (clearTimeout(this._scrollStopTimer), this._scrollStopTimer = null)); this._rafId = requestAnimationFrame(t) }; this._rafId = requestAnimationFrame(t) } stopMonitoringSoon() { this._scrollStopTimer && clearTimeout(this._scrollStopTimer), this._scrollStopTimer = setTimeout(() => { this._scrolling = !1, this._rafId && (cancelAnimationFrame(this._rafId), this._rafId = null) }, 120) } onScroll() { this.animated || (this._scrolling = !0, this.startMonitoring(), this.stopMonitoringSoon()) } checkAndTriggerContinuous(t, e) { if (null === this.entrySide) return !1; let s = 0; return "top" === this.entrySide ? s = Math.max(0, t.top) : "bottom" === this.entrySide && (s = Math.max(0, e - t.bottom)), s >= this.threshold } initObserver() { if ("undefined" == typeof IntersectionObserver) return void this.animate(); const t = (t, e) => { if (null === this.entrySide) return; let s = !1, i = 0; return "top" === this.entrySide ? (i = Math.max(0, t.top), s = i >= this.threshold) : "bottom" === this.entrySide && (i = Math.max(0, e - t.bottom), s = i >= this.threshold), s }, e = new IntersectionObserver(s => { s.forEach(s => { const i = s.boundingClientRect, n = s.rootBounds && s.rootBounds.height || window.innerHeight, a = s.isIntersecting, o = s.rootBounds || { top: 0, bottom: window.innerHeight, height: window.innerHeight }; if (a) { if (!this.animated) { if (null === this.entrySide) { const t = s.intersectionRect, e = 2; if (Math.abs(t.top - o.top) <= e) this.entrySide = "top"; else if (Math.abs(t.bottom - o.bottom) <= e) this.entrySide = "bottom"; else { const t = Math.abs(i.top - o.top), e = Math.abs(o.bottom - i.bottom); this.entrySide = t <= e ? "top" : "bottom" } } null !== this.entrySide && t(i, n) && (this.animated = !0, this.animate(), this.repeat ? (this._rafId && (cancelAnimationFrame(this._rafId), this._rafId = null), this._scrollStopTimer && (clearTimeout(this._scrollStopTimer), this._scrollStopTimer = null)) : (e.unobserve(this.element), this._rafId && (cancelAnimationFrame(this._rafId), this._rafId = null), window.removeEventListener("scroll", this._onScroll, { passive: !0 }), this._scrollStopTimer && (clearTimeout(this._scrollStopTimer), this._scrollStopTimer = null))) } } else this.repeat && this.animated && (this.resetAnimation(), window.addEventListener("scroll", this._onScroll, { passive: !0 })) }) }, { root: null, rootMargin: "0px", threshold: [0] }), s = this.element.getBoundingClientRect(), i = window.innerHeight; if (s.bottom > 0 && s.top < i) { if (s.top <= 0) this.entrySide = "top"; else if (s.bottom >= i) this.entrySide = "bottom"; else { const t = s.top, e = i - s.bottom; this.entrySide = t <= e ? "top" : "bottom" } t(s, i) ? (this.animated = !0, this.animate()) : e.observe(this.element) } else e.observe(this.element) } } class ZhenshangyinBoxReveal { constructor(t = {}) { this.config = { threshold: t.threshold || 100, duration: t.duration || 800, delay: t.delay || 0, repeat: t.repeat || !1, easing: t.easing || "cubic-bezier(0.25, 0.1, 0.25, 1)", boxBackground: t.boxBackground || "#000000", boxDirection: t.boxDirection || "left", mobile: t.mobile || !1 }, this.elements = [], this.animatedElements = new WeakSet, this.elementInitialPositions = new WeakMap, this.groupParents = new WeakMap, this.groupElements = new WeakMap, this.elementOriginalStyles = new WeakMap, this.elementRows = new WeakMap, this.isInitializing = !0, this.pendingGroupAnimations = new WeakMap, "loading" === document.readyState ? window.addEventListener("load", () => this.init()) : this.init() } init() { if (!this.config.mobile && this.isMobile()) return; this.elements = Array.from(document.querySelectorAll('[data-zhenshangyin="boxReveal"]')), this.elements.forEach(t => { const e = t.getAttribute("data-box-background") || this.config.boxBackground; t.style.setProperty("--box-background", e) }); this.elements.filter(t => t.hasAttribute("data-group")).forEach(t => { const e = t.getAttribute("data-group"), s = Array.from(t.querySelectorAll(e)); if (s.length) { this.groupParents.set(t, !0), this.storeOriginalStyles(t), s.forEach(t => { this.storeOriginalStyles(t) }), this.storeInitialPosition(t), s.forEach(t => { this.storeInitialPosition(t) }); let e = [...s]; t.hasAttribute("data-random") && (e = this.shuffleArray([...s])), this.groupElements.set(t, e), this.pendingGroupAnimations.set(t, new Set(e)), this.setupGroupElements(t, e) } }), this.elements.forEach(t => { this.groupParents.has(t) || (this.storeOriginalStyles(t), this.storeInitialPosition(t), this.setInitialStyles(t)) }), this.scrollHandler = this.handleScroll.bind(this), window.addEventListener("scroll", this.scrollHandler, { passive: !0 }), window.addEventListener("resize", this.scrollHandler, { passive: !0 }), requestAnimationFrame(() => { this.handleInitialAnimation(), this.isInitializing = !1, this.handleScroll() }) } setupGroupElements(t, e) { const s = t.hasAttribute("data-random-direction"), i = ["left", "right", "top", "bottom"]; e.forEach(e => { if (e.classList.add("zhengshangyin-box-reveal-item"), !e.querySelector(".zhengshangyin-box-reveal-content")) { const t = document.createElement("div"); for (t.className = "zhengshangyin-box-reveal-content"; e.firstChild;)t.appendChild(e.firstChild); e.appendChild(t) } if (s) { const t = i[Math.floor(Math.random() * i.length)]; e.setAttribute("data-box-direction", t), e._boxDirection = t } else { const s = t.getAttribute("data-box-direction") || this.config.boxDirection; e.setAttribute("data-box-direction", s), e._boxDirection = s } const n = e.getBoundingClientRect(), a = Math.round(n.top); this.elementRows.has(t) || this.elementRows.set(t, new Map); const o = this.elementRows.get(t); o.has(a) || o.set(a, []), o.get(a).push(e) }); const n = Array.from(this.elementRows.get(t).entries()).sort(([t], [e]) => t - e).map(([t, e]) => e); this.elementRows.set(t, n) } setInitialStyles(t) { if (!t.querySelector(".zhengshangyin-box-reveal-content")) { const e = document.createElement("div"); for (e.className = "zhengshangyin-box-reveal-content"; t.firstChild;)e.appendChild(t.firstChild); t.appendChild(e) } const e = t.getAttribute("data-box-direction") || this.config.boxDirection, s = parseInt(t.getAttribute("data-duration") || this.config.duration); t.style.setProperty("--duration", `${s}ms`), t.style.position = "relative", t.style.overflow = "hidden", t.setAttribute("data-box-direction", e), t._boxDirection = e } animateElement(t) { t.classList.add("active"); parseInt(t.getAttribute("data-duration") || this.config.duration); this.animatedElements.add(t) } resetElement(t) { t.classList.add("disable-transitions"), t.classList.remove("active"), t.offsetHeight, t.classList.remove("disable-transitions"), this.animatedElements.delete(t) } storeOriginalStyles(t) { this.elementOriginalStyles.set(t, { position: window.getComputedStyle(t).position, overflow: window.getComputedStyle(t).overflow }) } storeInitialPosition(t) { const e = t.getBoundingClientRect(), s = window.pageYOffset || document.documentElement.scrollTop; this.elementInitialPositions.set(t, { top: e.top + s, bottom: e.bottom + s }) } isElementInView(t) { const e = this.elementInitialPositions.get(t); if (!e) return !1; const s = window.pageYOffset || document.documentElement.scrollTop, i = window.innerHeight || document.documentElement.clientHeight, n = s + this.config.threshold, a = s + i - this.config.threshold; return e.top <= a && e.bottom >= n } isElementCompletelyOutOfView(t) { const e = this.elementInitialPositions.get(t); if (!e) return !0; const s = window.pageYOffset || document.documentElement.scrollTop, i = window.innerHeight || document.documentElement.clientHeight; return e.bottom < s || e.top > s + i } handleScroll() { this.isInitializing || (this.config.repeat && (this.elements.forEach(t => { !this.groupParents.has(t) && this.animatedElements.has(t) && this.isElementCompletelyOutOfView(t) && this.resetElement(t) }), this.elements.forEach(t => { if (this.groupParents.has(t) && this.animatedElements.has(t)) { const e = this.groupElements.get(t); if (!e || !e.length) return; e.every(t => this.isElementCompletelyOutOfView(t)) && (e.forEach(t => { this.animatedElements.has(t) && this.resetElement(t) }), this.animatedElements.delete(t)) } })), this.elements.forEach(t => { if (!this.groupParents.has(t) && this.isElementInView(t) && !this.animatedElements.has(t)) { const e = parseInt(t.getAttribute("data-delay") || this.config.delay); setTimeout(() => { this.animateElement(t) }, e) } }), this.elements.forEach(t => { if (this.groupParents.has(t) && this.isElementInView(t) && !this.animatedElements.has(t)) { const e = this.groupElements.get(t); if (!e || !e.length) return; const s = parseFloat(t.getAttribute("data-next-trigger") || .2), i = parseInt(t.getAttribute("data-delay") || this.config.delay); e.forEach((t, e) => { setTimeout(() => { this.animateElement(t) }, i + e * s * 1e3) }), this.animatedElements.add(t) } })) } handleInitialAnimation() { this.elements.forEach(t => { if (this.isElementInView(t)) if (this.groupParents.has(t)) { const e = this.groupElements.get(t); if (!e || !e.length) return; const s = parseFloat(t.getAttribute("data-next-trigger") || .2), i = parseInt(t.getAttribute("data-delay") || this.config.delay); e.forEach((t, e) => { setTimeout(() => { this.animateElement(t) }, i + e * s * 1e3) }), this.animatedElements.add(t) } else { const e = parseInt(t.getAttribute("data-delay") || this.config.delay); setTimeout(() => { this.animateElement(t) }, e) } }) } shuffleArray(t) { const e = [...t]; for (let t = e.length - 1; t > 0; t--) { const s = Math.floor(Math.random() * (t + 1));[e[t], e[s]] = [e[s], e[t]] } return e } destroy() { window.removeEventListener("scroll", this.scrollHandler), window.removeEventListener("resize", this.scrollHandler), this.elements.forEach(t => { const e = this.elementOriginalStyles.get(t); e && (t.style.position = e.position || "", t.style.overflow = e.overflow || ""), t.classList.remove("active") }), this.elements = [], this.animatedElements = new WeakSet, this.elementInitialPositions = new WeakMap, this.groupParents = new WeakMap, this.groupElements = new WeakMap, this.elementOriginalStyles = new WeakMap, this.elementRows = new WeakMap } isMobile() { return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) } } class ZhenshangyinSlider { constructor(t, e = {}) { this.container = document.querySelector(t), this.container && (this.min = e.min || 0, this.max = e.max || 100, this.step = e.step || 1, this.height = e.height || 6, this.buttonSize = e.buttonSize || 20, this.primaryColor = e.primaryColor || "#000000", this.backgroundColor = e.backgroundColor || "#00000020", this.range = e.range || !1, this.value = this.range ? e.value || [this.min, this.max] : e.value || this.min, this.showInput = e.showInput || !1, this.showStops = e.showStops || !1, this.showTooltip = e.showTooltip || !1, this.tooltipFormatter = e.tooltipFormatter || (t => t), this.onChange = e.onChange || (() => { }), this.disabled = e.disabled || !1, this.vertical = e.vertical || !1, this.setCSSVariables(), this.init()) } setCSSVariables() { this.container.style.setProperty("--slider-height", `${this.height}px`), this.container.style.setProperty("--slider-button-size", `${this.buttonSize}px`), this.container.style.setProperty("--slider-primary-color", this.primaryColor), this.container.style.setProperty("--slider-background", this.backgroundColor) } init() { this.createSlider(), this.bindEvents(), this.updateSliderPosition() } createSlider() { this.container.innerHTML = `\n                <div class="zhenshangyin-slider${this.vertical ? " vertical" : ""}${this.disabled ? " disabled" : ""}">\n                    <div class="zhenshangyin-slider-runway">\n                        <div class="zhenshangyin-slider-bar"></div>\n                        ${this.showStops ? this.createStops() : ""}\n                        ${this.range ? `\n                            <div class="zhenshangyin-slider-button-wrapper start">\n                                <div class="zhenshangyin-slider-button">\n                                    ${this.showTooltip ? '<div class="zhenshangyin-slider-tooltip"></div>' : ""}\n                                </div>\n                            </div>\n                            <div class="zhenshangyin-slider-button-wrapper end">\n                                <div class="zhenshangyin-slider-button">\n                                    ${this.showTooltip ? '<div class="zhenshangyin-slider-tooltip"></div>' : ""}\n                                </div>\n                            </div>\n                        ` : `\n                            <div class="zhenshangyin-slider-button-wrapper">\n                                <div class="zhenshangyin-slider-button">\n                                    ${this.showTooltip ? '<div class="zhenshangyin-slider-tooltip"></div>' : ""}\n                                </div>\n                            </div>\n                        `}\n                    </div>\n                    ${this.showInput ? `\n                        <div class="zhenshangyin-slider-input">\n                            ${this.range ? `\n                                <input type="number" class="start" min="${this.min}" max="${this.max}" step="${this.step}" value="${this.value[0]}">\n                                <span>-</span>\n                                <input type="number" class="end" min="${this.min}" max="${this.max}" step="${this.step}" value="${this.value[1]}">\n                            ` : `\n                                <input type="number" min="${this.min}" max="${this.max}" step="${this.step}" value="${this.value}">\n                            `}\n                        </div>\n                    ` : ""}\n                </div>\n            `, this.runway = this.container.querySelector(".zhenshangyin-slider-runway"), this.bar = this.container.querySelector(".zhenshangyin-slider-bar"), this.range ? (this.startButton = this.container.querySelector(".zhenshangyin-slider-button-wrapper.start"), this.endButton = this.container.querySelector(".zhenshangyin-slider-button-wrapper.end"), this.startInput = this.container.querySelector("input.start"), this.endInput = this.container.querySelector("input.end"), this.startInput && this.endInput && (this.startInput.addEventListener("change", t => this.onRangeInputChange(t, "start")), this.endInput.addEventListener("change", t => this.onRangeInputChange(t, "end")))) : (this.button = this.container.querySelector(".zhenshangyin-slider-button-wrapper"), this.input = this.container.querySelector("input"), this.tooltip = this.button.querySelector(".zhenshangyin-slider-tooltip"), this.input && this.input.addEventListener("change", this.onInputChange.bind(this))) } createStops() { const t = [], e = (this.max - this.min) / this.step; for (let s = 1; s < e; s++) { const e = s * this.step / (this.max - this.min) * 100; t.push(`<div class="zhenshangyin-slider-stop" style="${this.vertical ? "bottom" : "left"}: ${e}%"></div>`) } return t.join("") } bindEvents() { this.disabled || (this.range ? (this.startButton.addEventListener("mousedown", t => { this.startDragging(t, "start") }), this.endButton.addEventListener("mousedown", t => { this.startDragging(t, "end") }), this.startButton.addEventListener("touchstart", t => { t.preventDefault(); const e = t.touches[0]; this.startDragging({ clientX: e.clientX, clientY: e.clientY, preventDefault: () => { } }, "start") }), this.endButton.addEventListener("touchstart", t => { t.preventDefault(); const e = t.touches[0]; this.startDragging({ clientX: e.clientX, clientY: e.clientY, preventDefault: () => { } }, "end") })) : (this.button.addEventListener("mousedown", t => { this.startDragging(t) }), this.button.addEventListener("touchstart", t => { t.preventDefault(); const e = t.touches[0]; this.startDragging({ clientX: e.clientX, clientY: e.clientY, preventDefault: () => { } }) })), document.addEventListener("touchmove", t => { if (this.isDragging) { t.preventDefault(); const e = t.touches[0]; this.onDragging({ clientX: e.clientX, clientY: e.clientY }) } }, { passive: !1 }), document.addEventListener("touchend", t => { this.isDragging && (t.preventDefault(), this.stopDragging()) }), document.addEventListener("mousemove", this.onDragging.bind(this)), document.addEventListener("mouseup", this.stopDragging.bind(this)), this.runway.addEventListener("click", this.onRunwayClick.bind(this))) } startDragging(t, e = null) { if (!this.disabled) if (t.preventDefault(), this.isDragging = !0, this.dragType = e, this.startX = t.clientX || t.pageX, this.startY = t.clientY || t.pageY, this.startValue = this.range ? [...this.value] : this.value, this.range) { ("start" === e ? this.startButton : this.endButton).classList.add("dragging") } else this.button.classList.add("dragging") } stopDragging() { this.isDragging && (this.isDragging = !1, this.range ? (this.startButton.classList.remove("dragging"), this.endButton.classList.remove("dragging")) : this.button.classList.remove("dragging"), this.onChange(this.value)) } onDragging(t) { if (!this.isDragging) return; const e = t.clientX, s = t.clientY, i = (this.vertical ? this.startY - s : e - this.startX) / (this.vertical ? this.runway.offsetHeight : this.runway.offsetWidth) * 100 * (this.max - this.min) / 100; if (this.range) { let t = [...this.value]; "start" === this.dragType ? (t[0] = this.normalizeValue(this.startValue[0] + i), t[0] = Math.min(t[0], t[1] - this.step)) : "end" === this.dragType && (t[1] = this.normalizeValue(this.startValue[1] + i), t[1] = Math.max(t[1], t[0] + this.step)), JSON.stringify(t) !== JSON.stringify(this.value) && (this.isValueChanged = !0, this.setValue(t, !1)) } else { let t = this.normalizeValue(this.startValue + i); t !== this.value && (this.isValueChanged = !0, this.setValue(t, !1)) } } onRangeInputChange(t, e) { const s = parseFloat(t.target.value); if (!isNaN(s)) { const t = [...this.value]; "start" === e ? t[0] = Math.min(s, t[1] - this.step) : t[1] = Math.max(s, t[0] + this.step), this.setValue(t) } } updateSliderPosition() { if (this.range) { const t = (this.value[0] - this.min) / (this.max - this.min) * 100, e = (this.value[1] - this.min) / (this.max - this.min) * 100; this.vertical ? (this.bar.style.bottom = `${t}%`, this.bar.style.height = e - t + "%", this.startButton.style.bottom = `${t}%`, this.endButton.style.bottom = `${e}%`) : (this.bar.style.left = `${t}%`, this.bar.style.width = e - t + "%", this.startButton.style.left = `${t}%`, this.endButton.style.left = `${e}%`), this.showTooltip && (this.startButton.querySelector(".zhenshangyin-slider-tooltip").textContent = this.tooltipFormatter(this.value[0]), this.endButton.querySelector(".zhenshangyin-slider-tooltip").textContent = this.tooltipFormatter(this.value[1])), this.startInput && this.endInput && (this.startInput.value = this.value[0], this.endInput.value = this.value[1]) } else { const t = (this.value - this.min) / (this.max - this.min) * 100; this.vertical ? (this.bar.style.height = `${t}%`, this.button.style.bottom = `${t}%`) : (this.bar.style.width = `${t}%`, this.button.style.left = `${t}%`), this.tooltip && (this.tooltip.textContent = this.tooltipFormatter(this.value)), this.input && (this.input.value = this.value) } } getValue() { return this.value } setDisabled(t) { this.disabled = t, this.container.querySelector(".zhenshangyin-slider").classList.toggle("disabled", t) } normalizeValue(t) { return t = Math.min(Math.max(t, this.min), this.max), t = Math.round((t - this.min) / this.step) * this.step + this.min, Number(t.toFixed(10)) } setValue(t, e = !0) { const s = this.range ? [this.normalizeValue(t[0]), this.normalizeValue(t[1])] : this.normalizeValue(t); JSON.stringify(s) !== JSON.stringify(this.value) && (this.value = s, this.updateSliderPosition(), e && this.onChange(this.value)) } onRunwayClick(t) { const e = this.runway.getBoundingClientRect(), s = this.vertical ? (e.bottom - t.clientY) / e.height : (t.clientX - e.left) / e.width; if (this.range) { const t = this.min + s * (this.max - this.min); Math.abs(t - this.value[0]) <= Math.abs(t - this.value[1]) ? this.setValue([this.normalizeValue(t), this.value[1]], !0) : this.setValue([this.value[0], this.normalizeValue(t)], !0) } else { const t = this.min + s * (this.max - this.min); this.setValue(this.normalizeValue(t), !0) } } onInputChange(t) { const e = parseFloat(t.target.value); isNaN(e) || this.setValue(e) } }